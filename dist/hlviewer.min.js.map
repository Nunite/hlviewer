{"version":3,"file":"hlviewer.min.js","sources":["../node_modules/nanoevents/index.js","../src/Time.ts","../src/SoundSystem.ts","../src/Sound.ts","../src/Util.ts","../src/Reader.ts","../src/Parsers/Tga.ts","../src/Parsers/Util.ts","../src/Parsers/Wad.ts","../src/Replay/ReplayMap.ts","../src/Replay/ReplayChunk.ts","../src/Replay/ReplayState.ts","../src/Replay/readCoord.ts","../src/Replay/DeltaType.ts","../src/Replay/readDelta.ts","../src/BitReader.ts","../src/Replay/FrameDataReader.ts","../src/Replay/Replay.ts","../src/Parsers/Sprite.ts","../src/Xhr.ts","../node_modules/gl-matrix/esm/common.js","../node_modules/gl-matrix/esm/mat4.js","../node_modules/gl-matrix/esm/vec3.js","../node_modules/gl-matrix/esm/vec2.js","../src/Parsers/Vdf.ts","../src/Bsp.ts","../src/Parsers/BspLightmapParser.ts","../src/Parsers/BspParser.ts","../src/Loader.ts","../src/Input/Mouse.ts","../src/Input/Touch.ts","../src/Graphics/Camera.ts","../src/Input/Keyboard.ts","../src/Graphics/Context.ts","../src/ReplayPlayer.ts","../src/Graphics/Renderer.ts","../src/Graphics/SkyShader/SkyShader.ts","../src/Graphics/SkyScene.ts","../src/Graphics/WorldShader/WorldShader.ts","../src/Parsers/BspEntityParser.ts","../src/Graphics/Util.ts","../src/Graphics/WorldScene.ts","../src/Game.ts","../src/Config.ts","../node_modules/solid-js/dist/solid.js","../node_modules/solid-js/web/dist/web.js","../node_modules/solid-js/store/dist/store.js","../src/PlayerInterface/Loading/index.tsx","../src/PlayerInterface/Buttons/SettingsButton/index.tsx","../src/Fullscreen.ts","../src/PlayerInterface/Buttons/FullscreenButton/index.tsx","../src/PlayerInterface/FreeMode/index.tsx","../src/PlayerInterface/GameState.tsx","../src/PlayerInterface/Time/index.tsx","../src/PlayerInterface/Timeline/index.tsx","../src/PlayerInterface/VolumeControl/index.tsx","../src/PlayerInterface/Buttons/PlayButton/index.tsx","../src/PlayerInterface/Buttons/PauseButton/index.tsx","../src/PlayerInterface/Buttons/VolumeButton/VolumeFull.tsx","../src/PlayerInterface/Buttons/VolumeButton/VolumeHalf.tsx","../src/PlayerInterface/Buttons/VolumeButton/VolumeMute.tsx","../src/PlayerInterface/Buttons/VolumeButton/index.tsx","../src/PlayerInterface/Buttons/SpeedUpButton/index.tsx","../src/PlayerInterface/Buttons/SpeedDownButton/index.tsx","../src/PlayerInterface/ReplayMode/index.tsx","../src/PlayerInterface/App/index.tsx","../src/PlayerInterface/index.tsx","../src/index.ts"],"sourcesContent":["export let createNanoEvents = () => ({\n  emit(event, ...args) {\n    for (\n      let i = 0,\n        callbacks = this.events[event] || [],\n        length = callbacks.length;\n      i < length;\n      i++\n    ) {\n      callbacks[i](...args)\n    }\n  },\n  events: {},\n  on(event, cb) {\n    ;(this.events[event] ||= []).push(cb)\n    return () => {\n      this.events[event] = this.events[event]?.filter(i => cb !== i)\n    }\n  }\n})\n","export const now = performance.now.bind(performance)\r\n\r\nexport const formatTime = (seconds: number) => {\r\n  const m = Math.floor(seconds / 60)\r\n  const s = Math.floor(seconds - m * 60)\r\n  const mm = m < 10 ? `0${m}` : m.toString()\r\n  const ss = s < 10 ? `0${s}` : s.toString()\r\n  return `${mm}:${ss}`\r\n}\r\n","import { createNanoEvents, type Emitter as EventEmitter } from 'nanoevents'\r\nimport type { Sound } from './Sound'\r\n\r\nconst audioContext = new AudioContext()\r\n\r\nexport class SoundSystem {\r\n  context: AudioContext\r\n  channels: {\r\n    source: AudioBufferSourceNode | null\r\n    gain: GainNode\r\n  }[]\r\n  masterGain: GainNode\r\n  preMuteVolume: number\r\n  events: EventEmitter\r\n\r\n  constructor() {\r\n    this.context = audioContext\r\n\r\n    this.events = createNanoEvents()\r\n\r\n    const volume = Number.parseFloat(localStorage.getItem('volume') || '0.3')\r\n    localStorage.setItem('volume', volume.toString())\r\n\r\n    this.channels = []\r\n\r\n    this.preMuteVolume = 1\r\n    this.masterGain = this.context.createGain()\r\n    this.masterGain.gain.value = volume\r\n    this.masterGain.connect(this.context.destination)\r\n\r\n    for (let i = 0; i < 8; ++i) {\r\n      this.channels.push({\r\n        source: null,\r\n        gain: this.context.createGain()\r\n      })\r\n      this.channels[i].gain.connect(this.masterGain)\r\n    }\r\n  }\r\n\r\n  static getContext() {\r\n    return audioContext\r\n  }\r\n\r\n  play(sound: Sound, channel: number, volume: number) {\r\n    this.stop(channel)\r\n\r\n    const gain = this.channels[channel].gain\r\n    gain.gain.value = Math.max(0, Math.min(1, volume))\r\n\r\n    const source = this.context.createBufferSource()\r\n    source.buffer = sound.buffer\r\n    source.connect(gain)\r\n    source.start(0)\r\n\r\n    this.channels[channel].source = source\r\n  }\r\n\r\n  stop(channel: number) {\r\n    const source = this.channels[channel].source\r\n    if (source) {\r\n      source.stop(0)\r\n    }\r\n  }\r\n\r\n  getVolume() {\r\n    return this.masterGain.gain.value\r\n  }\r\n\r\n  setVolume(value: number) {\r\n    const current = this.masterGain.gain.value\r\n    if (current > 0 && value === 0) {\r\n      this.preMuteVolume = current\r\n    }\r\n\r\n    this.masterGain.gain.value = value\r\n\r\n    localStorage.setItem('volume', value.toString())\r\n    this.events.emit('volumeChange', value)\r\n  }\r\n\r\n  toggleMute() {\r\n    if (this.getVolume() === 0) {\r\n      this.setVolume(this.preMuteVolume)\r\n    } else {\r\n      this.setVolume(0)\r\n    }\r\n  }\r\n}\r\n","import { SoundSystem } from './SoundSystem'\r\n\r\nexport class Sound {\r\n  index: number\r\n  name: string\r\n  buffer: AudioBuffer\r\n\r\n  constructor(buffer: AudioBuffer) {\r\n    this.index = -1\r\n    this.name = ''\r\n    this.buffer = buffer\r\n  }\r\n\r\n  static create(buffer: ArrayBuffer): Promise<Sound> {\r\n    return new Promise<Sound>((resolve, reject) => {\r\n      SoundSystem.getContext().decodeAudioData(\r\n        buffer,\r\n        (buffer: AudioBuffer) => {\r\n          resolve(new Sound(buffer))\r\n        },\r\n        (err) => {\r\n          reject(err)\r\n        }\r\n      )\r\n    })\r\n  }\r\n}\r\n","export function basename(path: string, extension?: string) {\r\n  return path.slice(path.lastIndexOf('/') + 1).replace(extension || '', '')\r\n}\r\n\r\nexport function extname(path: string) {\r\n  const slashPos = path.lastIndexOf('/')\r\n  const dotPos = path.lastIndexOf('.')\r\n  if (slashPos < dotPos) {\r\n    return path.slice(dotPos)\r\n  }\r\n  return ''\r\n}\r\n","export enum ReaderDataType {\r\n  UByte = 0,\r\n  Byte = 1,\r\n  UShort = 2,\r\n  Short = 3,\r\n  UInt = 4,\r\n  Int = 5,\r\n  Float = 6,\r\n  Double = 7,\r\n  NString = 8,\r\n  String = 9\r\n}\r\n\r\nexport class Reader {\r\n  data: DataView\r\n  offset: number\r\n\r\n  constructor(data: ArrayBuffer) {\r\n    this.data = new DataView(data)\r\n    this.offset = 0\r\n  }\r\n\r\n  length() {\r\n    return this.data.byteLength\r\n  }\r\n\r\n  tell() {\r\n    return this.offset\r\n  }\r\n\r\n  seek(offset: number) {\r\n    this.offset = Math.max(0, offset)\r\n  }\r\n\r\n  skip(offset: number) {\r\n    this.seek(this.tell() + offset)\r\n  }\r\n\r\n  b() {\r\n    const r = this.data.getInt8(this.offset)\r\n    this.skip(1)\r\n    return r\r\n  }\r\n\r\n  ub() {\r\n    const r = this.data.getUint8(this.offset)\r\n    this.skip(1)\r\n    return r\r\n  }\r\n\r\n  s(isLittleEndian = true) {\r\n    const r = this.data.getInt16(this.offset, isLittleEndian)\r\n    this.skip(2)\r\n    return r\r\n  }\r\n\r\n  us(isLittleEndian = true) {\r\n    const r = this.data.getUint16(this.offset, isLittleEndian)\r\n    this.skip(2)\r\n    return r\r\n  }\r\n\r\n  i(isLittleEndian = true) {\r\n    const r = this.data.getInt32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  ui(isLittleEndian = true) {\r\n    const r = this.data.getUint32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  f(isLittleEndian = true) {\r\n    const r = this.data.getFloat32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  lf(isLittleEndian = true) {\r\n    const r = this.data.getFloat64(this.tell(), isLittleEndian)\r\n    this.skip(8)\r\n    return r\r\n  }\r\n\r\n  str() {\r\n    let t = this.ub()\r\n    let r = ''\r\n    while (t !== 0) {\r\n      r += String.fromCharCode(t)\r\n      t = this.ub()\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  nstr(length: number) {\r\n    let n = length\r\n    if (n < 0) {\r\n      return ''\r\n    }\r\n\r\n    let r = ''\r\n    while (n > 0) {\r\n      n -= 1\r\n      const charCode = this.ub()\r\n      if (charCode === 0) {\r\n        break\r\n      }\r\n\r\n      r += String.fromCharCode(charCode)\r\n    }\r\n\r\n    if (n !== 0) {\r\n      this.skip(n)\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  arr(length: number, f: () => any) {\r\n    let n = length\r\n    f.bind(this)\r\n    const r = []\r\n    while (n-- > 0) {\r\n      r.push(f())\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  arrx(length: number, type: ReaderDataType, nstrlen = 0) {\r\n    let n = length\r\n    let r: any\r\n\r\n    switch (type) {\r\n      case ReaderDataType.UByte: {\r\n        r = new Uint8Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n)\r\n        break\r\n      }\r\n\r\n      case ReaderDataType.Byte: {\r\n        r = new Int8Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n)\r\n        break\r\n      }\r\n\r\n      case ReaderDataType.UShort:\r\n        r = new Uint16Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 2)\r\n        break\r\n\r\n      case ReaderDataType.Short:\r\n        r = new Int16Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 2)\r\n        break\r\n\r\n      case ReaderDataType.UInt:\r\n        r = new Uint32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Int:\r\n        r = new Int32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Float:\r\n        r = new Float32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Double:\r\n        r = new Float64Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 8)\r\n        break\r\n\r\n      case ReaderDataType.NString:\r\n        r = []\r\n        while (n-- > 0) {\r\n          r.push(r.nstr(nstrlen))\r\n        }\r\n        break\r\n\r\n      case ReaderDataType.String:\r\n        r = []\r\n        while (n-- > 0) {\r\n          r.push(r.str())\r\n        }\r\n        break\r\n    }\r\n\r\n    return r\r\n  }\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\n\r\nexport class Tga {\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n\r\n  constructor(name: string, width: number, height: number, data: Uint8Array) {\r\n    this.name = name\r\n    this.width = width\r\n    this.height = height\r\n    this.data = data\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer, name: string) {\r\n    const r = new Reader(buffer)\r\n\r\n    const header = {\r\n      idLength: r.ub(),\r\n      colorMapType: r.ub(),\r\n      imageType: r.ub(),\r\n      colorMap: {\r\n        firstEntryIndex: r.us(),\r\n        length: r.us(),\r\n        size: r.ub()\r\n      },\r\n      image: {\r\n        xOrigin: r.us(),\r\n        yOrigin: r.us(),\r\n        width: r.us(),\r\n        height: r.us(),\r\n        depth: r.ub(),\r\n        descriptor: r.ub()\r\n      }\r\n    }\r\n\r\n    // let imageId\r\n    if (header.idLength) {\r\n      // imageId = r.arrx(header.idLength, Reader.Type.UByte)\r\n      r.arrx(header.idLength, ReaderDataType.UByte)\r\n    }\r\n\r\n    if (header.colorMapType) {\r\n      throw new Error('Not implemented')\r\n    }\r\n\r\n    const w = header.image.width\r\n    const h = header.image.height\r\n    const pixelCount = w * h\r\n    let imageData: Uint8Array = new Uint8Array(0)\r\n\r\n    if (header.imageType === 0x02) {\r\n      const byteCount = (pixelCount * header.image.depth) / 8\r\n      imageData = r.arrx(byteCount, ReaderDataType.UByte)\r\n      if (header.image.depth === 24) {\r\n        const temp = new Uint8Array(pixelCount * 4)\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w; ++j) {\r\n            const dst = (h - 1 - i) * w + j\r\n            temp[dst * 4] = imageData[(i * w + j) * 3 + 2]\r\n            temp[dst * 4 + 1] = imageData[(i * w + j) * 3 + 1]\r\n            temp[dst * 4 + 2] = imageData[(i * w + j) * 3]\r\n            temp[dst * 4 + 3] = 255\r\n          }\r\n        }\r\n        imageData = temp\r\n      } else if (header.image.depth === 32) {\r\n        const temp = new Uint8Array(pixelCount * 4)\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w; ++j) {\r\n            const dst = (h - 1 - i) * w + j\r\n            temp[dst * 4] = imageData[(i * w + j) * 4 + 2]\r\n            temp[dst * 4 + 1] = imageData[(i * w + j) * 4 + 1]\r\n            temp[dst * 4 + 2] = imageData[(i * w + j) * 4]\r\n            temp[dst * 4 + 3] = 255\r\n          }\r\n        }\r\n        imageData = temp\r\n      }\r\n    } else if (header.imageType === 0x0a) {\r\n      imageData = new Uint8Array(pixelCount * 4)\r\n      if (header.image.depth === 24) {\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w /*++j*/; ) {\r\n            let repCount = r.ub()\r\n            if (repCount & 0x80) {\r\n              repCount = (repCount & 0x7f) + 1\r\n              const bl = r.ub()\r\n              const gr = r.ub()\r\n              const rd = r.ub()\r\n              while (j < w && repCount) {\r\n                const dst = (h - 1 - i) * w + j\r\n                imageData[dst * 4] = rd\r\n                imageData[dst * 4 + 1] = gr\r\n                imageData[dst * 4 + 2] = bl\r\n                imageData[dst * 4 + 3] = 255\r\n                ++j\r\n                --repCount\r\n              }\r\n            } else {\r\n              repCount = (repCount & 0x7f) + 1\r\n              while (j < w && repCount) {\r\n                const dst = (h - 1 - i) * w + j\r\n                imageData[dst * 4 + 2] = r.ub()\r\n                imageData[dst * 4 + 1] = r.ub()\r\n                imageData[dst * 4] = r.ub()\r\n                imageData[dst * 4 + 3] = 255\r\n                ++j\r\n                --repCount\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return new Tga(name, header.image.width, header.image.height, imageData)\r\n  }\r\n}\r\n","export function paletteToRGBA(\r\n  pixels: Uint8Array,\r\n  palette: Uint8Array\r\n): Uint8Array {\r\n  const rgba = new Uint8Array(pixels.length * 4)\r\n\r\n  const len = pixels.length\r\n  for (let i = 0; i < len; ++i) {\r\n    rgba[i * 4] = palette[pixels[i] * 3]\r\n    rgba[i * 4 + 1] = palette[pixels[i] * 3 + 1]\r\n    rgba[i * 4 + 2] = palette[pixels[i] * 3 + 2]\r\n    rgba[i * 4 + 3] = 255\r\n  }\r\n\r\n  return rgba\r\n}\r\n\r\nexport function paletteWithLastTransToRGBA(\r\n  pixels: Uint8Array,\r\n  palette: Uint8Array\r\n): Uint8Array {\r\n  const rgba = new Uint8Array(pixels.length * 4)\r\n\r\n  const len = pixels.length\r\n  for (let i = 0; i < len; ++i) {\r\n    if (pixels[i] === 255) {\r\n      rgba[i * 4 + 3] = 0\r\n    } else {\r\n      rgba[i * 4] = palette[pixels[i] * 3]\r\n      rgba[i * 4 + 1] = palette[pixels[i] * 3 + 1]\r\n      rgba[i * 4 + 2] = palette[pixels[i] * 3 + 2]\r\n      rgba[i * 4 + 3] = 255\r\n    }\r\n  }\r\n\r\n  return rgba\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\nimport { paletteToRGBA, paletteWithLastTransToRGBA } from './Util'\r\n\r\nfunction parseDecal(r: Reader): WadDecal {\r\n  const name = r.nstr(16)\r\n\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n\r\n  r.skip(4 * 4) // skip mipmap offsets\r\n\r\n  // read largest mipmap data\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  // skip other 3 mipmaps\r\n  r.skip(21 * (pixelCount / 64))\r\n\r\n  r.skip(2) // skip padding bytes\r\n\r\n  const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n  const data =\r\n    name[0] === '{'\r\n      ? paletteWithLastTransToRGBA(pixels, palette)\r\n      : paletteToRGBA(pixels, palette)\r\n\r\n  return {\r\n    type: 'decal',\r\n    name,\r\n    width,\r\n    height,\r\n    data\r\n  }\r\n}\r\n\r\nconst parseCache = (_r: Reader, metadata: WadEntryMetadata): WadCache => ({\r\n  type: 'cache',\r\n  name: metadata.name\r\n})\r\n\r\nfunction parseTexture(r: Reader): WadTexture {\r\n  const name = r.nstr(16)\r\n\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n\r\n  r.skip(4 * 4) // skip mipmap offsets\r\n\r\n  // read largest mipmap data\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  // skip other 3 mipmaps\r\n  r.skip(21 * (pixelCount / 64))\r\n\r\n  r.skip(2) // skip padding bytes\r\n\r\n  const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n  const data =\r\n    name[0] === '{'\r\n      ? paletteWithLastTransToRGBA(pixels, palette)\r\n      : paletteToRGBA(pixels, palette)\r\n\r\n  return {\r\n    type: 'texture',\r\n    name,\r\n    width,\r\n    height,\r\n    data\r\n  }\r\n}\r\n\r\nfunction parseFont(r: Reader, metadata: WadEntryMetadata): WadFont {\r\n  // TODO: figure out why width is incorrect\r\n  const width = r.ui() && 256 // NOTE: fonts are lying about their width\r\n  const height = r.ui()\r\n  const rowCount = r.ui()\r\n  const rowHeight = r.ui()\r\n\r\n  const glyphs = []\r\n  // hardcoded 256 number of glyphs\r\n  for (let i = 0; i < 256; ++i) {\r\n    const glyphOffset = r.us()\r\n    const glyphWidth = r.us()\r\n\r\n    glyphs.push({\r\n      x: glyphOffset % width,\r\n      y: (Math.floor(glyphOffset / width) / rowHeight) * rowHeight,\r\n      width: glyphWidth,\r\n      height: rowHeight\r\n    })\r\n  }\r\n\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  r.skip(2)\r\n\r\n  const palette = r.arrx(256 * 3, ReaderDataType.UByte)\r\n\r\n  return {\r\n    type: 'font',\r\n    name: metadata.name,\r\n    width,\r\n    height,\r\n    rowCount,\r\n    rowHeight,\r\n    glyphs,\r\n    data: paletteWithLastTransToRGBA(pixels, palette)\r\n  }\r\n}\r\n\r\nconst parseUnknown = (r: Reader, metadata: WadEntryMetadata): WadUnknown => ({\r\n  type: 'unknown',\r\n  name: metadata.name,\r\n  data: r.arrx(metadata.length, ReaderDataType.UByte)\r\n})\r\n\r\nfunction parseEntry(r: Reader, metadata: WadEntryMetadata): WadEntry {\r\n  r.seek(metadata.offset)\r\n  switch (metadata.type) {\r\n    case 0x40: {\r\n      return parseDecal(r)\r\n    }\r\n    case 0x42: {\r\n      return parseCache(r, metadata)\r\n    }\r\n    case 0x43: {\r\n      return parseTexture(r)\r\n    }\r\n    case 0x46: {\r\n      return parseFont(r, metadata)\r\n    }\r\n\r\n    default: {\r\n      // unknown data type; return array of bytes\r\n      return parseUnknown(r, metadata)\r\n    }\r\n  }\r\n}\r\n\r\nexport interface WadTexture {\r\n  type: 'texture'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadDecal {\r\n  type: 'decal'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadCache {\r\n  type: 'cache'\r\n  name: string\r\n}\r\n\r\nexport interface WadFont {\r\n  type: 'font'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  rowCount: number\r\n  rowHeight: number\r\n  glyphs: {\r\n    x: number\r\n    y: number\r\n    width: number\r\n    height: number\r\n  }[]\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadUnknown {\r\n  type: 'unknown'\r\n  name: string\r\n  data: Uint8Array\r\n}\r\n\r\nexport type WadEntry = WadTexture | WadDecal | WadCache | WadFont | WadUnknown\r\n\r\ninterface WadEntryMetadata {\r\n  offset: number\r\n  diskLength: number\r\n  length: number\r\n  type: number\r\n  isCompressed: number\r\n  name: string\r\n}\r\n\r\nexport class Wad {\r\n  entries: WadEntry[]\r\n\r\n  constructor(entries: WadEntry[]) {\r\n    this.entries = entries\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n\r\n    const magic = r.nstr(4)\r\n    if (magic !== 'WAD3') {\r\n      throw new Error('Invalid WAD file format')\r\n    }\r\n\r\n    const entryCount = r.ui()\r\n    const directoryOffset = r.ui()\r\n    r.seek(directoryOffset)\r\n    const entriesMetadata: WadEntryMetadata[] = []\r\n    for (let i = 0; i < entryCount; ++i) {\r\n      const entry: WadEntryMetadata = {\r\n        offset: r.ui(),\r\n        diskLength: r.ui(),\r\n        length: r.ui(),\r\n        type: r.b(),\r\n        isCompressed: r.b(),\r\n        name: ''\r\n      }\r\n      r.skip(2)\r\n      entry.name = r.nstr(16)\r\n      entriesMetadata.push(entry)\r\n    }\r\n\r\n    const entries: WadEntry[] = entriesMetadata.map(e => parseEntry(r, e))\r\n\r\n    return new Wad(entries)\r\n  }\r\n}\r\n","import { basename } from '../Util'\r\nimport type { ReplayChunk } from './ReplayChunk'\r\n\r\nexport class ReplayMap {\r\n  name: string\r\n  chunks: ReplayChunk[]\r\n  resources: any\r\n\r\n  constructor(mapFilePath: string) {\r\n    this.name = basename(mapFilePath, '.bsp')\r\n    this.chunks = []\r\n    this.resources = {\r\n      sounds: [],\r\n      skins: [],\r\n      models: [],\r\n      decals: [],\r\n      custom: [],\r\n      events: []\r\n    }\r\n  }\r\n\r\n  setResources(resources: any[]) {\r\n    for (const res of resources) {\r\n      switch (res.type) {\r\n        case 0: {\r\n          res.used = false\r\n          this.resources.sounds.push(res)\r\n          break\r\n        }\r\n        case 1: {\r\n          this.resources.skins.push(res)\r\n          break\r\n        }\r\n        case 2: {\r\n          this.resources.models.push(res)\r\n          break\r\n        }\r\n        case 3: {\r\n          this.resources.decals.push(res)\r\n          break\r\n        }\r\n        case 4: {\r\n          this.resources.custom.push(res)\r\n          break\r\n        }\r\n        case 5: {\r\n          this.resources.events.push(res)\r\n          break\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  addChunk(chunk: ReplayChunk) {\r\n    this.chunks.push(chunk)\r\n  }\r\n}\r\n","import { Reader } from '../Reader'\r\nimport type { ReplayState } from './ReplayState'\r\n\r\nexport class ReplayChunk {\r\n  state: ReplayState\r\n  startTime: number\r\n  timeLength: number\r\n  data: Uint8Array | null\r\n  reader: Reader | null\r\n\r\n  constructor(initialState: ReplayState, startTime: number) {\r\n    this.state = initialState.clone()\r\n    this.startTime = startTime\r\n    this.timeLength = 10\r\n    this.data = null\r\n    this.reader = null\r\n  }\r\n\r\n  setData(data: Uint8Array) {\r\n    this.data = new Uint8Array(data.length)\r\n    for (let i = 0; i < data.length; ++i) {\r\n      this.data[i] = data[i]\r\n    }\r\n\r\n    this.reader = new Reader(this.data.buffer as ArrayBuffer)\r\n  }\r\n}\r\n","export class ReplayState {\r\n  cameraPos: any[]\r\n  cameraRot: any[]\r\n  entities: any[]\r\n\r\n  constructor(obj: any | null = null) {\r\n    if (obj) {\r\n      this.cameraPos = JSON.parse(JSON.stringify(obj.cameraPos))\r\n      this.cameraRot = JSON.parse(JSON.stringify(obj.cameraRot))\r\n      this.entities = JSON.parse(JSON.stringify(obj.entities))\r\n    } else {\r\n      this.cameraPos = [0, 0, 0]\r\n      this.cameraRot = [0, 0, 0]\r\n      this.entities = []\r\n    }\r\n  }\r\n\r\n  feedFrame(frame: any) {\r\n    switch (frame.type) {\r\n      case 0:\r\n      case 1: {\r\n        this.cameraPos[0] = frame.camera.position[0]\r\n        this.cameraPos[1] = frame.camera.position[1]\r\n        this.cameraPos[2] = frame.camera.position[2]\r\n\r\n        this.cameraRot[0] = frame.camera.orientation[0]\r\n        this.cameraRot[1] = frame.camera.orientation[1]\r\n        this.cameraRot[2] = frame.camera.orientation[2]\r\n\r\n        // TODO: handle spawnbaseline, clientdata, and similar messages\r\n\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return new ReplayState(this)\r\n  }\r\n}\r\n","import type { BitStream } from '../BitReader'\r\n\r\nexport function readCoord(bs: BitStream) {\r\n  const intFlag = bs.readBits(1)\r\n  const fractionFlag = bs.readBits(1)\r\n\r\n  if (!intFlag && !fractionFlag) {\r\n    return 0\r\n  }\r\n\r\n  const sign = bs.readBits(1)\r\n  let intValue = 0\r\n  let fractionValue = 0\r\n  if (intFlag) {\r\n    intValue = bs.readBits(12)\r\n  }\r\n  if (fractionFlag) {\r\n    fractionValue = bs.readBits(3)\r\n  }\r\n\r\n  let value = intValue + fractionValue / 32\r\n  if (sign) {\r\n    value = -value\r\n  }\r\n\r\n  return value\r\n}\r\n","export enum DeltaType {\r\n  DT_BYTE = 1,\r\n  DT_SHORT = 1 << 1,\r\n  DT_FLOAT = 1 << 2,\r\n  DT_INTEGER = 1 << 3,\r\n  DT_ANGLE = 1 << 4,\r\n  DT_TIMEWINDOW_8 = 1 << 5,\r\n  DT_TIMEWINDOW_BIG = 1 << 6,\r\n  DT_STRING = 1 << 7,\r\n  DT_SIGNED = 1 << 31\r\n}\r\n","import { DeltaType } from './DeltaType'\r\nimport type { BitStream } from '../BitReader'\r\nimport type { DeltaDecoder } from './DeltaDecoder'\r\n\r\nexport function readDelta(bs: BitStream, dd: DeltaDecoder) {\r\n  const data: { [name: string]: any } = {}\r\n\r\n  const maskBitCount = bs.readBits(3)\r\n  const maskBits = []\r\n  for (let i = 0; i < maskBitCount; ++i) {\r\n    maskBits.push(bs.readBits(8))\r\n  }\r\n\r\n  let brk = false\r\n  for (let i = 0; i < maskBitCount; ++i) {\r\n    for (let j = 0; j < 8; ++j) {\r\n      const index = j + i * 8\r\n      if (index === dd.length) {\r\n        brk = true\r\n        break\r\n      }\r\n\r\n      if (maskBits[i] & (1 << j)) {\r\n        if (dd[index].flags & DeltaType.DT_BYTE) {\r\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\r\n            const sign = bs.readBits(1) ? -1 : 1\r\n            const value = bs.readBits(dd[index].bits - 1)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            const value = bs.readBits(dd[index].bits)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (dd[index].flags & DeltaType.DT_SHORT) {\r\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\r\n            const sign = bs.readBits(1) ? -1 : 1\r\n            const value = bs.readBits(dd[index].bits - 1)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            const value = bs.readBits(dd[index].bits)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (dd[index].flags & DeltaType.DT_INTEGER) {\r\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\r\n            const sign = bs.readBits(1) ? -1 : 1\r\n            const value = bs.readBits(dd[index].bits - 1)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            const value = bs.readBits(dd[index].bits)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (\r\n          dd[index].flags & DeltaType.DT_FLOAT ||\r\n          dd[index].flags & DeltaType.DT_TIMEWINDOW_8 ||\r\n          dd[index].flags & DeltaType.DT_TIMEWINDOW_BIG\r\n        ) {\r\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\r\n            const sign = bs.readBits(1) ? -1 : 1\r\n            const value = bs.readBits(dd[index].bits - 1)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = (sign * value) / divisor\r\n          } else {\r\n            const value = bs.readBits(dd[index].bits)\r\n            const divisor = dd[index].divisor\r\n            data[dd[index].name] = value / divisor\r\n          }\r\n        } else if (dd[index].flags & DeltaType.DT_ANGLE) {\r\n          const value = bs.readBits(dd[index].bits)\r\n          const multiplier = 360 / (1 << dd[index].bits)\r\n          data[dd[index].name] = value * multiplier\r\n        } else if (dd[index].flags & DeltaType.DT_STRING) {\r\n          data[dd[index].name] = bs.readString()\r\n        }\r\n      }\r\n    }\r\n\r\n    if (brk) {\r\n      break\r\n    }\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nconst initialDeltaDecoders = {\r\n  delta_description_t: [\r\n    {\r\n      name: 'flags',\r\n      bits: 32,\r\n      divisor: 1,\r\n      flags: DeltaType.DT_INTEGER\r\n    },\r\n    {\r\n      name: 'name',\r\n      bits: 8,\r\n      divisor: 1,\r\n      flags: DeltaType.DT_STRING\r\n    },\r\n    {\r\n      name: 'offset',\r\n      bits: 16,\r\n      divisor: 1,\r\n      flags: DeltaType.DT_INTEGER\r\n    },\r\n    {\r\n      name: 'size',\r\n      bits: 8,\r\n      divisor: 1,\r\n      flags: DeltaType.DT_INTEGER\r\n    },\r\n    {\r\n      name: 'bits',\r\n      bits: 8,\r\n      divisor: 1,\r\n      flags: DeltaType.DT_INTEGER\r\n    },\r\n    {\r\n      name: 'divisor',\r\n      bits: 32,\r\n      divisor: 4000,\r\n      flags: DeltaType.DT_FLOAT\r\n    },\r\n    {\r\n      name: 'preMultiplier',\r\n      bits: 32,\r\n      divisor: 4000,\r\n      flags: DeltaType.DT_FLOAT\r\n    }\r\n  ]\r\n}\r\n\r\nexport const getInitialDeltaDecoders = (): {\r\n  [name: string]: DeltaDecoder\r\n} => ({ ...initialDeltaDecoders })\r\n","export class BitView {\r\n  static scratch = new DataView(new ArrayBuffer(8))\r\n\r\n  private view: Uint8Array\r\n\r\n  constructor(buffer: ArrayBuffer) {\r\n    this.view = new Uint8Array(buffer, 0, buffer.byteLength)\r\n  }\r\n\r\n  getBits(_offset: number, bits: number, signed = false) {\r\n    let offset = _offset\r\n    const available = this.view.length * 8 - offset\r\n\r\n    if (bits > available) {\r\n      throw new Error('Bits out of bounds')\r\n    }\r\n\r\n    let value = 0\r\n    for (let i = 0; i < bits; ) {\r\n      const remaining = bits - i\r\n      const bitOffset = offset & 7\r\n      const currentByte = this.view[offset >> 3]\r\n\r\n      // the max number of bits we can read from the current byte\r\n      const read = Math.min(remaining, 8 - bitOffset)\r\n\r\n      // create a mask with the correct bit width\r\n      const mask = (1 << read) - 1\r\n      // shift bits we want to the start of the byte and mask of the rest\r\n      const readBits = (currentByte >> bitOffset) & mask\r\n      value |= readBits << i\r\n\r\n      offset += read\r\n      i += read\r\n    }\r\n\r\n    if (signed) {\r\n      // If we're not working with a full 32 bits, check the\r\n      // imaginary MSB for this bit count and convert to a\r\n      // valid 32-bit signed value if set.\r\n      if (bits !== 32 && value & (1 << (bits - 1))) {\r\n        value |= -1 ^ ((1 << bits) - 1)\r\n      }\r\n\r\n      return value\r\n    }\r\n\r\n    return value >>> 0\r\n  }\r\n\r\n  getInt8(offset: number) {\r\n    return this.getBits(offset, 8, true)\r\n  }\r\n\r\n  getUint8(offset: number) {\r\n    return this.getBits(offset, 8, false)\r\n  }\r\n\r\n  getInt16(offset: number) {\r\n    return this.getBits(offset, 16, true)\r\n  }\r\n\r\n  getUint16(offset: number) {\r\n    return this.getBits(offset, 16, false)\r\n  }\r\n\r\n  getInt32(offset: number) {\r\n    return this.getBits(offset, 32, true)\r\n  }\r\n\r\n  getUint32(offset: number) {\r\n    return this.getBits(offset, 32, false)\r\n  }\r\n\r\n  getFloat32(offset: number) {\r\n    BitView.scratch.setUint32(0, this.getUint32(offset))\r\n    return BitView.scratch.getFloat32(0)\r\n  }\r\n\r\n  getFloat64(offset: number) {\r\n    BitView.scratch.setUint32(0, this.getUint32(offset))\r\n    // DataView offset is in bytes.\r\n    BitView.scratch.setUint32(4, this.getUint32(offset + 32))\r\n    return BitView.scratch.getFloat64(0)\r\n  }\r\n}\r\n\r\nexport class BitStream {\r\n  private view: BitView\r\n  index: number\r\n\r\n  constructor(source: ArrayBuffer) {\r\n    this.view = new BitView(source)\r\n    this.index = 0\r\n  }\r\n\r\n  readBits(bits: number, signed = false) {\r\n    const val = this.view.getBits(this.index, bits, signed)\r\n    this.index += bits\r\n    return val\r\n  }\r\n\r\n  readInt8() {\r\n    const val = this.view.getInt8(this.index)\r\n    this.index += 8\r\n    return val\r\n  }\r\n\r\n  readUint8() {\r\n    const val = this.view.getUint8(this.index)\r\n    this.index += 8\r\n    return val\r\n  }\r\n\r\n  readInt16() {\r\n    const val = this.view.getInt16(this.index)\r\n    this.index += 16\r\n    return val\r\n  }\r\n\r\n  readUint16() {\r\n    const val = this.view.getUint16(this.index)\r\n    this.index += 16\r\n    return val\r\n  }\r\n\r\n  readInt32() {\r\n    const val = this.view.getInt32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readUint32() {\r\n    const val = this.view.getUint32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readFloat32() {\r\n    const val = this.view.getFloat32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readFloat64() {\r\n    const val = this.view.getFloat64(this.index)\r\n    this.index += 64\r\n    return val\r\n  }\r\n\r\n  readString(bytes = 0, utf8 = false) {\r\n    let i = 0\r\n    const chars = []\r\n    let append = true\r\n\r\n    // Read while we still have space available, or until we've\r\n    // hit the fixed byte length passed in.\r\n    while (!bytes || (bytes && i < bytes)) {\r\n      const c = this.readUint8()\r\n\r\n      // Stop appending chars once we hit 0x00\r\n      if (c === 0x00) {\r\n        append = false\r\n\r\n        // If we don't have a fixed length to read, break out now.\r\n        if (!bytes) {\r\n          break\r\n        }\r\n      }\r\n      if (append) {\r\n        chars.push(c)\r\n      }\r\n\r\n      i++\r\n    }\r\n\r\n    const string = String.fromCharCode.apply(null, chars)\r\n    if (utf8) {\r\n      try {\r\n        // https://stackoverflow.com/a/17192845\r\n        return decodeURIComponent(string)\r\n      } catch (e) {\r\n        return string\r\n      }\r\n    } else {\r\n      return string\r\n    }\r\n  }\r\n}\r\n\r\n","import { readCoord } from './readCoord'\r\nimport { readDelta } from './readDelta'\r\nimport { BitStream } from '../BitReader'\r\nimport type { DeltaDecoderTable } from './DeltaDecoder'\r\nimport { type Reader, ReaderDataType } from '../Reader'\r\n\r\ntype FrameDataHandler = (r: Reader, deltaDecoder: DeltaDecoderTable) => any\r\n\r\nexport const frameReaders = {\r\n  bad() {\r\n    throw new Error('Invalid message type')\r\n  },\r\n  nop(): null {\r\n    return null\r\n  },\r\n  disconnect(r: Reader) {\r\n    return {\r\n      reason: r.str()\r\n    }\r\n  },\r\n  event(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    type Event = {\r\n      index: number\r\n      packetIndex?: number\r\n      fireTime?: number\r\n      delta?: { [name: string]: any }\r\n    }\r\n\r\n    const events: Event[] = []\r\n    const eventCount = bs.readBits(5)\r\n    for (let i = 0; i < eventCount; ++i) {\r\n      const event: Event = {\r\n        index: bs.readBits(10)\r\n      }\r\n      const packetIndexBit = bs.readBits(1)\r\n      if (packetIndexBit) {\r\n        event.packetIndex = bs.readBits(11)\r\n        const deltaBit = bs.readBits(1)\r\n        if (deltaBit) {\r\n          event.delta = readDelta(bs, deltaDecoders.event_t)\r\n        }\r\n      }\r\n      const fireTimeBit = bs.readBits(1)\r\n      if (fireTimeBit) {\r\n        event.fireTime = bs.readBits(16)\r\n      }\r\n\r\n      events.push(event)\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return { events }\r\n  },\r\n  version(r: Reader) {\r\n    return {\r\n      version: r.ui()\r\n    }\r\n  },\r\n  setView(r: Reader) {\r\n    return {\r\n      entityIndex: r.s()\r\n    }\r\n  },\r\n  sound(r: Reader) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    const flags = bs.readBits(9)\r\n\r\n    let volume = 1\r\n    if ((flags & 1) !== 0) {\r\n      volume = bs.readBits(8) / 255\r\n    }\r\n\r\n    let attenuation = 1\r\n    if ((flags & 2) !== 0) {\r\n      attenuation = bs.readBits(8) / 64\r\n    }\r\n\r\n    const channel = bs.readBits(3)\r\n    const entityIndex = bs.readBits(11)\r\n\r\n    let soundIndex: number\r\n    if ((flags & 4) !== 0) {\r\n      soundIndex = bs.readBits(16)\r\n    } else {\r\n      soundIndex = bs.readBits(8)\r\n    }\r\n\r\n    const xFlag = bs.readBits(1)\r\n    const yFlag = bs.readBits(1)\r\n    const zFlag = bs.readBits(1)\r\n    let xPosition = 0\r\n    let yPosition = 0\r\n    let zPosition = 0\r\n    if (xFlag) {\r\n      xPosition = readCoord(bs)\r\n    }\r\n    if (yFlag) {\r\n      yPosition = readCoord(bs)\r\n    }\r\n    if (zFlag) {\r\n      zPosition = readCoord(bs)\r\n    }\r\n\r\n    let pitch = 1\r\n    if ((flags & 8) !== 0) {\r\n      pitch = bs.readBits(8)\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      flags,\r\n      volume,\r\n      attenuation,\r\n      channel,\r\n      entityIndex,\r\n      soundIndex,\r\n      xPosition,\r\n      yPosition,\r\n      zPosition,\r\n      pitch\r\n    }\r\n  },\r\n  time(r: Reader) {\r\n    return {\r\n      time: r.f()\r\n    }\r\n  },\r\n  print(r: Reader) {\r\n    return {\r\n      message: r.str()\r\n    }\r\n  },\r\n  stuffText(r: Reader) {\r\n    const message = r.str()\r\n    const commands = message.split(';').map((command) => {\r\n      const args = command\r\n        .split(/\\s*(\"[^\"]+\"|[^\\s\"]+)/)\r\n        .map((arg) => arg.replace(/^\"(.*)\"$/, '$1').trim())\r\n        .filter((arg) => arg)\r\n\r\n      const func = args[0]\r\n      const params = args.slice(1)\r\n\r\n      return { func, params }\r\n    })\r\n\r\n    return { commands }\r\n  },\r\n  setAngle(r: Reader) {\r\n    return {\r\n      pitch: r.s(),\r\n      yaw: r.s(),\r\n      roll: r.s()\r\n    }\r\n  },\r\n  serverInfo(r: Reader) {\r\n    const info = {\r\n      protocol: r.i(),\r\n      spawnCount: r.i(), // map change count\r\n      mapCrc: r.i(),\r\n      clientDllHash: r.arrx(16, ReaderDataType.UByte),\r\n      maxPlayers: r.ub(),\r\n      playerIndex: r.ub(),\r\n      isDeathmatch: r.ub(),\r\n      gameDir: r.str(),\r\n      hostName: r.str(),\r\n      mapFileName: r.str(), // path to map relative in mod directory\r\n      mapCycle: r.str()\r\n    }\r\n    r.skip(1) // skip padding\r\n\r\n    return info\r\n  },\r\n  lightStyle(r: Reader) {\r\n    return {\r\n      index: r.ub(),\r\n      lightInfo: r.str()\r\n    }\r\n  },\r\n  updateUserInfo(r: Reader) {\r\n    return {\r\n      clientIndex: r.ub(),\r\n      clientUserId: r.ui(),\r\n      clientUserInfo: r.str(),\r\n      clientCdKeyHash: r.arrx(16, ReaderDataType.UByte)\r\n    }\r\n  },\r\n  deltaDescription(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const data: {\r\n      name: string\r\n      fields: { [name: string]: any }[]\r\n    } = {\r\n      name: r.str(),\r\n      fields: []\r\n    }\r\n\r\n    const bs = new BitStream(r.data.buffer)\r\n    const fieldCount = r.us()\r\n    bs.index = r.tell() * 8\r\n    for (let i = 0; i < fieldCount; ++i) {\r\n      data.fields.push(readDelta(bs, deltaDecoders.delta_description_t))\r\n    }\r\n    deltaDecoders[data.name] = data.fields as any\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return data\r\n  },\r\n  clientData(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    const deltaSequence = bs.readBits(1)\r\n    if (deltaSequence) {\r\n      // delta update mask\r\n      bs.index += 8\r\n    }\r\n\r\n    const clientDataDecoder = deltaDecoders.clientdata_t\r\n    const clientData = readDelta(bs, clientDataDecoder)\r\n\r\n    // TODO: weapon data\r\n    const weaponDataDecoder = deltaDecoders.weapon_data_t\r\n    while (bs.readBits(1)) {\r\n      bs.index += 6 // weapon index\r\n      readDelta(bs, weaponDataDecoder) // weapon data\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      clientData\r\n    }\r\n  },\r\n  stopSound(r: Reader) {\r\n    return {\r\n      entityIndex: r.s()\r\n    }\r\n  },\r\n  pings(r: Reader) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    const pings = []\r\n    while (bs.readBits(1)) {\r\n      pings.push({\r\n        slot: bs.readBits(8),\r\n        ping: bs.readBits(8),\r\n        loss: bs.readBits(8)\r\n      })\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return pings\r\n  },\r\n  particle(r: Reader) {\r\n    return {\r\n      position: [r.s() / 8, r.s() / 8, r.s() / 8],\r\n      direction: [r.b(), r.b(), r.b()],\r\n      count: r.ub(),\r\n      color: r.ub()\r\n    }\r\n  },\r\n  damage(): null {\r\n    // unused\r\n    return null\r\n  },\r\n  spawnStatic(r: Reader) {\r\n    const data: any = {\r\n      modelIndex: r.s(),\r\n      sequence: r.b(),\r\n      frame: r.b(),\r\n      colorMap: r.s(),\r\n      skin: r.b(),\r\n      position: [],\r\n      rotation: []\r\n    }\r\n    data.position[0] = r.s() / 8\r\n    data.rotation[0] = r.b() * (360 / 256)\r\n    data.position[1] = r.s() / 8\r\n    data.rotation[1] = r.b() * (360 / 256)\r\n    data.position[2] = r.s() / 8\r\n    data.rotation[2] = r.b() * (360 / 256)\r\n    data.renderMode = r.b()\r\n    if (data.renderMode) {\r\n      data.renderAmt = r.b()\r\n      data.renderColor = [r.ub(), r.ub(), r.ub()]\r\n      data.renderFx = r.b()\r\n    }\r\n\r\n    return data\r\n  },\r\n  eventReliable(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    const eventIndex = bs.readBits(10)\r\n    const eventData = readDelta(bs, deltaDecoders['event_t'])\r\n    const delayBit = bs.readBits(1)\r\n    let delay = 0\r\n    if (delayBit) {\r\n      delay = bs.readBits(16)\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      eventIndex,\r\n      eventData,\r\n      delayBit,\r\n      delay\r\n    }\r\n  },\r\n  spawnBaseLine(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    const entities = []\r\n    while (true) {\r\n      const entityIdx = bs.readBits(11)\r\n      if (entityIdx === (1 << 11) - 1) {\r\n        break\r\n      }\r\n\r\n      const entityType = bs.readBits(2)\r\n      let entityTypeString: string\r\n      if (entityType & 1) {\r\n        if (entityIdx > 0 && entityIdx <= 32) {\r\n          entityTypeString = 'entity_state_player_t'\r\n        } else {\r\n          entityTypeString = 'entity_state_t'\r\n        }\r\n      } else {\r\n        entityTypeString = 'custom_entity_state_t'\r\n      }\r\n\r\n      entities[entityIdx] = readDelta(bs, deltaDecoders[entityTypeString])\r\n    }\r\n\r\n    const footer = bs.readBits(5)\r\n    if (footer !== (1 << 5) - 1) {\r\n      throw new Error('Bad spawnbaseline')\r\n    }\r\n\r\n    const nExtraData = bs.readBits(6)\r\n    const extraData = []\r\n    for (let i = 0; i < nExtraData; ++i) {\r\n      extraData.push(readDelta(bs, deltaDecoders.entity_state_t))\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return {\r\n      entities,\r\n      extraData\r\n    }\r\n  },\r\n  tempEntity(r: Reader) {\r\n    const TE_BEAMPOINTS = 0 // Beam effect between two points\r\n    const TE_BEAMENTPOINT = 1 // Beam effect between point and entity\r\n    const TE_GUNSHOT = 2 // Particle effect plus ricochet sound\r\n    const TE_EXPLOSION = 3 // Additive sprite, 2 dynamic lights, flickering particles, explosion sound, move vertically 8 pps\r\n    const TE_TAREXPLOSION = 4 // Quake1 \"tarbaby\" explosion with sound\r\n    const TE_SMOKE = 5 // Alphablend sprite, move vertically 30 pps\r\n    const TE_TRACER = 6 // Tracer effect from point to point\r\n    const TE_LIGHTNING = 7 // TE_BEAMPOINTS with simplified parameters\r\n    const TE_BEAMENTS = 8\r\n    const TE_SPARKS = 9 // 8 random tracers with gravity, ricochet sprite\r\n    const TE_LAVASPLASH = 10 // Quake1 lava splash\r\n    const TE_TELEPORT = 11 // Quake1 teleport splash\r\n    const TE_EXPLOSION2 = 12 // Quake1 colormaped (base palette) particle explosion with sound\r\n    const TE_BSPDECAL = 13 // Decal from the .BSP file\r\n    const TE_IMPLOSION = 14 // Tracers moving toward a point\r\n    const TE_SPRITETRAIL = 15 // Line of moving glow sprites with gravity, fadeout, and collisions\r\n    const TE_SPRITE = 17 // Additive sprite, plays 1 cycle\r\n    const TE_BEAMSPRITE = 18 // A beam with a sprite at the end\r\n    const TE_BEAMTORUS = 19 // Screen aligned beam ring, expands to max radius over lifetime\r\n    const TE_BEAMDISK = 20 // Disk that expands to max radius over lifetime\r\n    const TE_BEAMCYLINDER = 21 // Cylinder that expands to max radius over lifetime\r\n    const TE_BEAMFOLLOW = 22 // Create a line of decaying beam segments until entity stops moving\r\n    const TE_GLOWSPRITE = 23\r\n    const TE_BEAMRING = 24 // Connect a beam ring to two entities\r\n    const TE_STREAK_SPLASH = 25 // Oriented shower of tracers\r\n    const TE_DLIGHT = 27 // Dynamic light, effect world, minor entity effect\r\n    const TE_ELIGHT = 28 // Point entity light, no world effect\r\n    const TE_TEXTMESSAGE = 29\r\n    const TE_LINE = 30\r\n    const TE_BOX = 31\r\n    const TE_KILLBEAM = 99 // Kill all beams attached to entity\r\n    const TE_LARGEFUNNEL = 100\r\n    const TE_BLOODSTREAM = 101 // Particle spray\r\n    const TE_SHOWLINE = 102 // Line of particles every 5 units, dies in 30 seconds\r\n    const TE_BLOOD = 103 // Particle spray\r\n    const TE_DECAL = 104 // Decal applied to a brush entity (not the world)\r\n    const TE_FIZZ = 105 // Create alpha sprites inside of entity, float upwards\r\n    const TE_MODEL = 106 // Create a moving model that bounces and makes a sound when it hits\r\n    const TE_EXPLODEMODEL = 107 // Spherical shower of models, picks from set\r\n    const TE_BREAKMODEL = 108 // Box of models or sprites\r\n    const TE_GUNSHOTDECAL = 109 // Decal and ricochet sound\r\n    const TE_SPRITE_SPRAY = 110 // Spray of alpha sprites\r\n    const TE_ARMOR_RICOCHET = 111 // Quick spark sprite, client ricochet sound.\r\n    const TE_PLAYERDECAL = 112\r\n    const TE_BUBBLES = 113 // Create alpha sprites inside of box, float upwards\r\n    const TE_BUBBLETRAIL = 114 // Create alpha sprites along a line, float upwards\r\n    const TE_BLOODSPRITE = 115 // Spray of opaque sprite1's that fall, single sprite2 for 1..2 secs (this is a high-priority tent)\r\n    const TE_WORLDDECAL = 116 // Decal applied to the world brush\r\n    const TE_WORLDDECALHIGH = 117 // Decal (with texture index > 256) applied to world brush\r\n    const TE_DECALHIGH = 118 // Same as TE_DECAL, but the texture index was greater than 256\r\n    const TE_PROJECTILE = 119 // Makes a projectile (like a nail) (this is a high-priority tent)\r\n    const TE_SPRAY = 120 // Throws a shower of sprites or models\r\n    const TE_PLAYERSPRITES = 121 // Sprites emit from a player's bounding box (ONLY use for players!)\r\n    const TE_PARTICLEBURST = 122 // Very similar to lavasplash\r\n    const TE_FIREFIELD = 123 // Makes a field of fire\r\n    const TE_PLAYERATTACHMENT = 124 // Attaches a TENT to a player (this is a high-priority tent)\r\n    const TE_KILLPLAYERATTACHMENTS = 125 // Will expire all TENTS attached to a player.\r\n    const TE_MULTIGUNSHOT = 126 // Much more compact shotgun message\r\n    const TE_USERTRACER = 127 // Larger message than the standard tracer, but allows some customization.\r\n\r\n    const type = r.ub()\r\n    const data: any = {}\r\n    switch (type) {\r\n      case TE_BEAMPOINTS: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMENTPOINT: {\r\n        r.skip(20)\r\n        break\r\n      }\r\n\r\n      case TE_GUNSHOT: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_EXPLOSION: {\r\n        r.skip(11)\r\n        break\r\n      }\r\n\r\n      case TE_TAREXPLOSION: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_SMOKE: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_TRACER: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_LIGHTNING: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMENTS: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_SPARKS: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_LAVASPLASH: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_TELEPORT: {\r\n        r.skip(6)\r\n        break\r\n      }\r\n\r\n      case TE_EXPLOSION2: {\r\n        r.skip(8)\r\n        break\r\n      }\r\n\r\n      case TE_BSPDECAL: {\r\n        r.skip(8)\r\n        const entityIndex = r.s()\r\n        if (entityIndex) {\r\n          r.skip(2)\r\n        }\r\n        break\r\n      }\r\n\r\n      case TE_IMPLOSION: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_SPRITETRAIL: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_SPRITE: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMSPRITE: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMTORUS: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMDISK: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMCYLINDER: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMFOLLOW: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_GLOWSPRITE: {\r\n        r.skip(11)\r\n        break\r\n      }\r\n\r\n      case TE_BEAMRING: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_STREAK_SPLASH: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_DLIGHT: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_ELIGHT: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_TEXTMESSAGE: {\r\n        data.channel = r.b()\r\n        data.x = r.s()\r\n        data.y = r.s()\r\n        data.effect = r.b()\r\n        data.textColor = [r.ub(), r.ub(), r.ub(), r.ub()]\r\n        data.effectColor = [r.ub(), r.ub(), r.ub(), r.ub()]\r\n        data.fadeInTime = r.s()\r\n        data.fadeOutTime = r.s()\r\n        data.holdTime = r.s()\r\n        if (data.effect) {\r\n          data.effectTime = r.s()\r\n        }\r\n        data.message = r.str()\r\n        break\r\n      }\r\n\r\n      case TE_LINE: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_BOX: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_KILLBEAM: {\r\n        r.skip(2)\r\n        break\r\n      }\r\n\r\n      case TE_LARGEFUNNEL: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_BLOODSTREAM: {\r\n        r.skip(14)\r\n        break\r\n      }\r\n\r\n      case TE_SHOWLINE: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_BLOOD: {\r\n        r.skip(14)\r\n        break\r\n      }\r\n\r\n      case TE_DECAL: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_FIZZ: {\r\n        r.skip(5)\r\n        break\r\n      }\r\n\r\n      case TE_MODEL: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_EXPLODEMODEL: {\r\n        r.skip(13)\r\n        break\r\n      }\r\n\r\n      case TE_BREAKMODEL: {\r\n        r.skip(24)\r\n        break\r\n      }\r\n\r\n      case TE_GUNSHOTDECAL: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_SPRITE_SPRAY: {\r\n        r.skip(17)\r\n        break\r\n      }\r\n\r\n      case TE_ARMOR_RICOCHET: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_PLAYERDECAL: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_BUBBLES: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_BUBBLETRAIL: {\r\n        r.skip(19)\r\n        break\r\n      }\r\n\r\n      case TE_BLOODSPRITE: {\r\n        r.skip(12)\r\n        break\r\n      }\r\n\r\n      case TE_WORLDDECAL: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_WORLDDECALHIGH: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_DECALHIGH: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_PROJECTILE: {\r\n        r.skip(16)\r\n        break\r\n      }\r\n\r\n      case TE_SPRAY: {\r\n        r.skip(18)\r\n        break\r\n      }\r\n\r\n      case TE_PLAYERSPRITES: {\r\n        r.skip(5)\r\n        break\r\n      }\r\n\r\n      case TE_PARTICLEBURST: {\r\n        r.skip(10)\r\n        break\r\n      }\r\n\r\n      case TE_FIREFIELD: {\r\n        r.skip(9)\r\n        break\r\n      }\r\n\r\n      case TE_PLAYERATTACHMENT: {\r\n        r.skip(7)\r\n        break\r\n      }\r\n\r\n      case TE_KILLPLAYERATTACHMENTS: {\r\n        r.skip(1)\r\n        break\r\n      }\r\n\r\n      case TE_MULTIGUNSHOT: {\r\n        r.skip(18)\r\n        break\r\n      }\r\n\r\n      case TE_USERTRACER: {\r\n        r.skip(15)\r\n        break\r\n      }\r\n\r\n      default: {\r\n        throw new Error('Unknown temp entity type')\r\n      }\r\n    }\r\n\r\n    return data\r\n  },\r\n  setPause(r: Reader) {\r\n    return {\r\n      isPaused: r.b()\r\n    }\r\n  },\r\n  signOnNum(r: Reader) {\r\n    return {\r\n      sign: r.b()\r\n    }\r\n  },\r\n  centerPrint(r: Reader) {\r\n    return {\r\n      message: r.str()\r\n    }\r\n  },\r\n  killedMonster(): null {\r\n    // unused\r\n    return null\r\n  },\r\n  foundSecret(): null {\r\n    // unused\r\n    return null\r\n  },\r\n  spawnStaticSound(r: Reader) {\r\n    return {\r\n      position: [r.s() / 8, r.s() / 8, r.s() / 8],\r\n      soundIndex: r.us(),\r\n      volume: r.ub() / 255,\r\n      attenuation: r.ub() / 64,\r\n      entityIndex: r.us(),\r\n      pitch: r.ub(),\r\n      flags: r.ub()\r\n    }\r\n  },\r\n  intermission(): null {\r\n    // has no arguments\r\n    return null\r\n  },\r\n  finale(r: Reader) {\r\n    return {\r\n      text: r.str()\r\n    }\r\n  },\r\n  cdTrack(r: Reader) {\r\n    return {\r\n      track: r.b(),\r\n      loopTrack: r.b()\r\n    }\r\n  },\r\n  restore(r: Reader) {\r\n    const saveName = r.str()\r\n    const mapCount = r.ub()\r\n    const maps = []\r\n    for (let i = 0; i < mapCount; ++i) {\r\n      maps.push(r.str())\r\n    }\r\n\r\n    return { saveName, maps }\r\n  },\r\n  cutscene(r: Reader) {\r\n    return {\r\n      text: r.str()\r\n    }\r\n  },\r\n  weaponAnim(r: Reader) {\r\n    return {\r\n      sequenceNumber: r.b(),\r\n      weaponModelBodyGroup: r.b()\r\n    }\r\n  },\r\n  decalName(r: Reader) {\r\n    return {\r\n      positionIndex: r.ub(),\r\n      decalName: r.str()\r\n    }\r\n  },\r\n  roomType(r: Reader) {\r\n    return {\r\n      type: r.us()\r\n    }\r\n  },\r\n  addAngle(r: Reader) {\r\n    // NOTE: not sure if (360/65536) or (65536/360)\r\n    return {\r\n      angleToAdd: r.s() / (360 / 65536)\r\n    }\r\n  },\r\n  newUserMsg(r: Reader) {\r\n    return {\r\n      index: r.ub(),\r\n      size: r.b(),\r\n      name: r.nstr(16)\r\n    }\r\n  },\r\n  packetEntities(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    const entityStates = []\r\n    bs.readBits(16) // skip entity count (unreliable)\r\n    let entityNumber = 0\r\n    while (true) {\r\n      const footer = bs.readBits(16)\r\n      if (footer === 0) {\r\n        break\r\n      }\r\n\r\n      bs.index -= 16\r\n\r\n      const entityNumberIncrement = bs.readBits(1)\r\n      if (!entityNumberIncrement) {\r\n        const absoluteEntityNumber = bs.readBits(1)\r\n        if (absoluteEntityNumber) {\r\n          entityNumber = bs.readBits(11)\r\n        } else {\r\n          entityNumber += bs.readBits(6)\r\n        }\r\n      } else {\r\n        entityNumber++\r\n      }\r\n\r\n      const custom = bs.readBits(1)\r\n      const useBaseline = bs.readBits(1)\r\n      if (useBaseline) {\r\n        bs.index += 6 // baseline index\r\n      }\r\n\r\n      let entityType = 'entity_state_t'\r\n      if (entityNumber > 0 && entityNumber <= 32) {\r\n        entityType = 'entity_state_player_t'\r\n      } else if (custom) {\r\n        entityType = 'custom_entity_state_t'\r\n      }\r\n\r\n      entityStates.push(readDelta(bs, deltaDecoders[entityType]))\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return { entityStates }\r\n  },\r\n  deltaPacketEntities(r: Reader, deltaDecoders: DeltaDecoderTable) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    bs.readBits(16) // skip entity count (unreliable)\r\n    bs.index += 8 // either updatemask or delta sequence number\r\n\r\n    const entityStates = []\r\n    let entityIdx = 0\r\n    while (true) {\r\n      const footer = bs.readBits(16)\r\n      if (footer === 0) {\r\n        break\r\n      }\r\n\r\n      bs.index -= 16\r\n\r\n      const removeEntity = bs.readBits(1)\r\n      const absoluteEntityNumber = bs.readBits(1)\r\n      if (absoluteEntityNumber) {\r\n        entityIdx = bs.readBits(11)\r\n      } else {\r\n        entityIdx += bs.readBits(6)\r\n      }\r\n\r\n      if (removeEntity) {\r\n        continue\r\n      }\r\n\r\n      const custom = bs.readBits(1)\r\n      let entityType = 'entity_state_t'\r\n      if (entityIdx > 0 && entityIdx < 32) {\r\n        entityType = 'entity_state_player_t'\r\n      } else if (custom) {\r\n        entityType = 'custom_entity_state_t'\r\n      }\r\n\r\n      entityStates[entityIdx] = readDelta(bs, deltaDecoders[entityType])\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return { entityStates }\r\n  },\r\n  choke(): null {\r\n    // no arguments\r\n    return null\r\n  },\r\n  resourceList(r: Reader) {\r\n    const bs = new BitStream(r.data.buffer)\r\n    bs.index = r.tell() * 8\r\n\r\n    // TODO: extract more data???\r\n\r\n    const entries = []\r\n    const entryCount = bs.readBits(12)\r\n    for (let i = 0; i < entryCount; ++i) {\r\n      const entry = {\r\n        type: bs.readBits(4),\r\n        name: bs.readString(),\r\n        index: bs.readBits(12),\r\n        size: bs.readBits(24)\r\n      }\r\n\r\n      const flags = bs.readBits(3)\r\n      if (flags & 4) {\r\n        // TODO: entry.md5hash = read 128 bits\r\n        bs.index += 128\r\n      }\r\n\r\n      // 1 bit = boolean hasExtraInfo\r\n      if (bs.readBits(1)) {\r\n        // 32 bytes extraInfo\r\n        bs.index += 256\r\n      }\r\n\r\n      entries.push(entry)\r\n    }\r\n\r\n    if (bs.readBits(1)) {\r\n      while (bs.readBits(1)) {\r\n        const nBits = bs.readBits(1) ? 5 : 10\r\n        bs.index += nBits\r\n      }\r\n    }\r\n\r\n    if (bs.index % 8 > 0) {\r\n      r.seek(Math.floor(bs.index / 8) + 1)\r\n    } else {\r\n      r.seek(bs.index / 8)\r\n    }\r\n\r\n    return entries\r\n  },\r\n  newMoveVars(r: Reader) {\r\n    return {\r\n      gravity: r.f(),\r\n      stopSpeed: r.f(),\r\n      maxSpeed: r.f(),\r\n      spectatorMaxSpeed: r.f(),\r\n      acceleration: r.f(),\r\n      airAcceleration: r.f(),\r\n      waterAcceleration: r.f(),\r\n      friction: r.f(),\r\n      edgeFriction: r.f(),\r\n      waterFriction: r.f(),\r\n      entityGravity: r.f(),\r\n      bounce: r.f(),\r\n      stepSize: r.f(),\r\n      maxVelocity: r.f(),\r\n      zMax: r.f(),\r\n      waveHeight: r.f(),\r\n      footsteps: r.b(),\r\n      rollAngle: r.f(),\r\n      rollSpeed: r.f(),\r\n      skyColor: [r.f(), r.f(), r.f()],\r\n      skyVec: [r.f(), r.f(), r.f()],\r\n      skyName: r.str()\r\n    }\r\n  },\r\n  resourceRequest(r: Reader) {\r\n    const data = {\r\n      spawnCount: r.i()\r\n    }\r\n    r.skip(4) // unknown (always 0)\r\n\r\n    return data\r\n  },\r\n  customization(r: Reader) {\r\n    const playerIndex = r.ub()\r\n    const type = r.ub()\r\n    const name = r.str()\r\n    const index = r.us()\r\n    const downloadSize = r.ui()\r\n    const flags = r.ub()\r\n    let md5hash: number[] | null = null\r\n    if (flags & 4) {\r\n      md5hash = [r.i(), r.i(), r.i(), r.i()]\r\n    }\r\n\r\n    return {\r\n      playerIndex,\r\n      type,\r\n      name,\r\n      index,\r\n      downloadSize,\r\n      flags,\r\n      md5hash\r\n    }\r\n  },\r\n  crosshairAngle(r: Reader) {\r\n    return {\r\n      pitch: r.b(),\r\n      yaw: r.b()\r\n    }\r\n  },\r\n  soundFade(r: Reader) {\r\n    return {\r\n      initialPercent: r.ub(),\r\n      holdTime: r.ub(),\r\n      fadeOutTime: r.ub(),\r\n      fadeInTime: r.ub()\r\n    }\r\n  },\r\n  fileTxferFailed(r: Reader) {\r\n    return {\r\n      filename: r.str()\r\n    }\r\n  },\r\n  hltv(r: Reader) {\r\n    return {\r\n      mode: r.ub()\r\n    }\r\n  },\r\n  director(r: Reader) {\r\n    const length = r.ub()\r\n    return {\r\n      flag: r.ub(),\r\n      message: r.nstr(length - 1)\r\n    }\r\n  },\r\n  voiceInit(r: Reader) {\r\n    return {\r\n      codecName: r.str(),\r\n      quality: r.b()\r\n    }\r\n  },\r\n  voiceData(r: Reader) {\r\n    const playerIndex = r.ub()\r\n    const size = r.us()\r\n    const data = r.arrx(size, ReaderDataType.UByte)\r\n    return { playerIndex, data }\r\n  },\r\n  sendExtraInfo(r: Reader) {\r\n    return {\r\n      fallbackDir: r.str(),\r\n      canCheat: r.ub()\r\n    }\r\n  },\r\n  timeScale(r: Reader) {\r\n    return {\r\n      timeScale: r.f()\r\n    }\r\n  },\r\n  resourceLocation(r: Reader) {\r\n    return {\r\n      url: r.str()\r\n    }\r\n  },\r\n  sendCvarValue(r: Reader) {\r\n    // deprecated\r\n    return {\r\n      name: r.str()\r\n    }\r\n  },\r\n  sendCvarValue2(r: Reader) {\r\n    return {\r\n      requestId: r.ui(),\r\n      name: r.str()\r\n    }\r\n  }\r\n}\r\n\r\n// prettier-ignore\r\nconst frameReadHandlers = [\r\n  frameReaders.bad,                 // SVC_BAD                      0\r\n  frameReaders.nop,                 // SVC_NOP                      1\r\n  frameReaders.disconnect,          // SVC_DISCONNECT               2\r\n  frameReaders.event,               // SVC_EVENT                    3\r\n  frameReaders.version,             // SVC_VERSION                  4\r\n  frameReaders.setView,             // SVC_SETVIEW                  5\r\n  frameReaders.sound,               // SVC_SOUND                    6\r\n  frameReaders.time,                // SVC_TIME                     7\r\n  frameReaders.print,               // SVC_PRINT                    8\r\n  frameReaders.stuffText,           // SVC_STUFFTEXT                9\r\n  frameReaders.setAngle,            // SVC_SETANGLE                10\r\n  frameReaders.serverInfo,          // SVC_SERVERINFO              11\r\n  frameReaders.lightStyle,          // SVC_LIGHTSTYLE              12\r\n  frameReaders.updateUserInfo,      // SVC_UPDATEUSERINFO          13\r\n  frameReaders.deltaDescription,    // SVC_DELTADESCRIPTION        14\r\n  frameReaders.clientData,          // SVC_CLIENTDATA              15\r\n  frameReaders.stopSound,           // SVC_STOPSOUND               16\r\n  frameReaders.pings,               // SVC_PINGS                   17\r\n  frameReaders.particle,            // SVC_PARTICLE                18\r\n  frameReaders.damage,              // SVC_DAMAGE                  19\r\n  frameReaders.spawnStatic,         // SVC_SPAWN            20\r\n  frameReaders.eventReliable,       // SVC_EVENT_RELIABLE          21\r\n  frameReaders.spawnBaseLine,       // SVC_SPAWNBASELINE           22\r\n  frameReaders.tempEntity,          // SVC_TEMPENTITY              23\r\n  frameReaders.setPause,            // SVC_SETPAUSE                24\r\n  frameReaders.signOnNum,           // SVC_SIGNONNUM               25\r\n  frameReaders.centerPrint,         // SVC_CENTERPRINT             26\r\n  frameReaders.killedMonster,       // SVC_KILLEDMONSTER           27\r\n  frameReaders.foundSecret,         // SVC_FOUNDSECRET             28\r\n  frameReaders.spawnStaticSound,    // SVC_SPAWNSTATICSOUND        29\r\n  frameReaders.intermission,        // SVC_INTERMISSION            30\r\n  frameReaders.finale,              // SVC_FINALE                  31\r\n  frameReaders.cdTrack,             // SVC_CDTRACK                 32\r\n  frameReaders.restore,             // SVC_RESTORE                 33\r\n  frameReaders.cutscene,            // SVC_CUTSCENE                34\r\n  frameReaders.weaponAnim,          // SVC_WEAPONANIM              35\r\n  frameReaders.decalName,           // SVC_DECALNAME               36\r\n  frameReaders.roomType,            // SVC_ROOMTYPE                37\r\n  frameReaders.addAngle,            // SVC_ADDANGLE                38\r\n  frameReaders.newUserMsg,          // SVC_NEWUSERMSG              39\r\n  frameReaders.packetEntities,      // SVC_PACKETENTITIES          40\r\n  frameReaders.deltaPacketEntities, // SVC_DELTAPACKETENTITIES     41\r\n  frameReaders.choke,               // SVC_CHOKE                   42\r\n  frameReaders.resourceList,        // SVC_RESOURCELIST            43\r\n  frameReaders.newMoveVars,         // SVC_NEWMOVEVARS             44\r\n  frameReaders.resourceRequest,     // SVC_RESOURCEREQUEST         45\r\n  frameReaders.customization,       // SVC_CUSTOMIZATION           46\r\n  frameReaders.crosshairAngle,      // SVC_CROSSHAIRANGLE          47\r\n  frameReaders.soundFade,           // SVC_SOUNDFADE               48\r\n  frameReaders.fileTxferFailed,     // SVC_FILETXFERFAILED         49\r\n  frameReaders.hltv,                // SVC_HLTV                    50\r\n  frameReaders.director,            // SVC_DIRECTOR                51\r\n  frameReaders.voiceInit,           // SVC_VOICEINIT               52\r\n  frameReaders.voiceData,           // SVC_VOICEDATA               53\r\n  frameReaders.sendExtraInfo,       // SVC_SENDEXTRAINFO           54\r\n  frameReaders.timeScale,           // SVC_TIMESCALE               55\r\n  frameReaders.resourceLocation,    // SVC_RESOURCELOCATION        56\r\n  frameReaders.sendCvarValue,       // SVC_SENDCVARVALUE           57\r\n  frameReaders.sendCvarValue2       // SVC_SENDCVARVALUE2          58\r\n] as FrameDataHandler[]\r\n\r\nexport function readFrame(r: Reader, type: number, deltaDecoders: DeltaDecoderTable) {\r\n  if (type === 0) {\r\n    // SVC_BAD shouldn't happen\r\n    return null\r\n  }\r\n\r\n  const handler = frameReadHandlers[type]\r\n  if (handler) {\r\n    return handler(r, deltaDecoders)\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nexport enum SVC {\r\n  BAD = 0,\r\n  NOP = 1,\r\n  DISCONNECT = 2,\r\n  EVENT = 3,\r\n  VERSION = 4,\r\n  SETVIEW = 5,\r\n  SOUND = 6,\r\n  TIME = 7,\r\n  PRINT = 8,\r\n  STUFFTEXT = 9,\r\n  SETANGLE = 10,\r\n  SERVERINFO = 11,\r\n  LIGHTSTYLE = 12,\r\n  UPDATEUSERINFO = 13,\r\n  DELTADESCRIPTION = 14,\r\n  CLIENTDATA = 15,\r\n  STOPSOUND = 16,\r\n  PINGS = 17,\r\n  PARTICLE = 18,\r\n  DAMAGE = 19,\r\n  SPAWN = 20,\r\n  EVENT_RELIABLE = 21,\r\n  SPAWNBASELINE = 22,\r\n  TEMPENTITY = 23,\r\n  SETPAUSE = 24,\r\n  SIGNONNUM = 25,\r\n  CENTERPRINT = 26,\r\n  KILLEDMONSTER = 27,\r\n  FOUNDSECRET = 28,\r\n  SPAWNSTATICSOUND = 29,\r\n  INTERMISSION = 30,\r\n  FINALE = 31,\r\n  CDTRACK = 32,\r\n  RESTORE = 33,\r\n  CUTSCENE = 34,\r\n  WEAPONANIM = 35,\r\n  DECALNAME = 36,\r\n  ROOMTYPE = 37,\r\n  ADDANGLE = 38,\r\n  NEWUSERMSG = 39,\r\n  PACKETENTITIES = 40,\r\n  DELTAPACKETENTITIES = 41,\r\n  CHOKE = 42,\r\n  RESOURCELIST = 43,\r\n  NEWMOVEVARS = 44,\r\n  RESOURCEREQUEST = 45,\r\n  CUSTOMIZATION = 46,\r\n  CROSSHAIRANGLE = 47,\r\n  SOUNDFADE = 48,\r\n  FILETXFERFAILED = 49,\r\n  HLTV = 50,\r\n  DIRECTOR = 51,\r\n  VOICEINIT = 52,\r\n  VOICEDATA = 53,\r\n  SENDEXTRAINFO = 54,\r\n  TIMESCALE = 55,\r\n  RESOURCELOCATION = 56,\r\n  SENDCVARVALUE = 57,\r\n  SENDCVARVALUE2 = 58\r\n}\r\n","import { ReplayMap } from './ReplayMap'\r\nimport { ReplayChunk } from './ReplayChunk'\r\nimport { ReplayState } from './ReplayState'\r\nimport * as FrameData from './FrameDataReader'\r\nimport { Reader, ReaderDataType } from '../Reader'\r\nimport { getInitialDeltaDecoders } from './readDelta'\r\n\r\nconst checkType = (r: Reader) => {\r\n  const magic = r.nstr(8)\r\n  return magic === 'HLDEMO'\r\n}\r\n\r\nconst readHeader = (r: Reader) => ({\r\n  demoProtocol: r.ui(),\r\n  netProtocol: r.ui(),\r\n  mapName: r.nstr(260),\r\n  modName: r.nstr(260),\r\n  mapCrc: r.i(),\r\n  dirOffset: r.ui()\r\n})\r\n\r\nconst readDirectories = (r: Reader, offset: number) => {\r\n  r.seek(offset)\r\n\r\n  const count = r.ui()\r\n  const directories = []\r\n  for (let i = 0; i < count; ++i) {\r\n    directories.push({\r\n      id: r.ui(),\r\n      name: r.nstr(64),\r\n      flags: r.ui(),\r\n      cdTrack: r.i(),\r\n      time: r.f(),\r\n      frames: r.ui(),\r\n      offset: r.ui(),\r\n      length: r.ui()\r\n    })\r\n  }\r\n\r\n  return directories\r\n}\r\n\r\nconst readFrameData = (r: Reader, deltaDecoders: any, customMessages: any) => {\r\n  const length = r.ui()\r\n  const limit = r.tell() + length\r\n  const data = []\r\n  while (r.tell() < limit) {\r\n    const type = r.ub()\r\n    if (type === 1) {\r\n      continue\r\n    }\r\n\r\n    if (type >= 64) {\r\n      if (customMessages[type] && customMessages[type].size > -1) {\r\n        r.skip(customMessages[type].size)\r\n      } else {\r\n        r.skip(r.ub())\r\n      }\r\n\r\n      continue\r\n    }\r\n\r\n    const message = FrameData.readFrame(r, type, deltaDecoders)\r\n    if (message) {\r\n      if (type === 39) {\r\n        customMessages[message.index] = message\r\n      }\r\n      data.push({\r\n        type,\r\n        data: message\r\n      })\r\n    } else {\r\n      r.seek(limit)\r\n    }\r\n  }\r\n\r\n  // just in case\r\n  r.seek(limit)\r\n\r\n  return data\r\n}\r\n\r\nconst readFrame = (r: Reader, deltaDecoders: any, customMessages: any) => {\r\n  const frame: any = {\r\n    type: r.ub(),\r\n    time: r.f(),\r\n    tick: r.ui()\r\n  }\r\n\r\n  switch (frame.type) {\r\n    case 0:\r\n    case 1: {\r\n      r.skip(4)\r\n      frame.camera = {\r\n        position: [r.f(), r.f(), r.f()],\r\n        orientation: [r.f(), r.f(), r.f()]\r\n      }\r\n      r.skip(436)\r\n      frame.data = readFrameData(r, deltaDecoders, customMessages)\r\n      break\r\n    }\r\n    case 2: {\r\n      break\r\n    }\r\n    case 3: {\r\n      frame.command = r.nstr(64)\r\n      break\r\n    }\r\n    case 4: {\r\n      r.skip(32)\r\n      break\r\n    }\r\n    case 5: {\r\n      break\r\n    }\r\n    case 6: {\r\n      r.skip(84)\r\n      break\r\n    }\r\n    case 7: {\r\n      r.skip(8)\r\n      break\r\n    }\r\n    case 8: {\r\n      frame.sound = {\r\n        channel: r.i(),\r\n        sample: r.nstr(r.ui()),\r\n        attenuation: r.f(),\r\n        volume: r.f(),\r\n        flags: r.ui(),\r\n        pitch: r.i()\r\n      }\r\n      break\r\n    }\r\n    case 9: {\r\n      r.skip(r.ui())\r\n      break\r\n    }\r\n    default: {\r\n      frame.error = true\r\n      break\r\n    }\r\n  }\r\n\r\n  return frame\r\n}\r\n\r\nexport class Replay {\r\n  header: any\r\n  mapName: string\r\n  directories: any\r\n\r\n  constructor(header: any, directories: any) {\r\n    this.header = header\r\n    this.mapName = this.header.mapName\r\n    this.directories = directories\r\n  }\r\n\r\n  static parseFromArrayBuffer(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n    const magic = r.nstr(8)\r\n    if (magic !== 'HLDEMO') {\r\n      throw new Error('Invalid replay format')\r\n    }\r\n\r\n    const header: any = {}\r\n    header.demoProtocol = r.ui()\r\n    header.netProtocol = r.ui()\r\n    header.mapName = r.nstr(260)\r\n    header.modName = r.nstr(260)\r\n    header.mapCrc = r.i()\r\n    header.dirOffset = r.ui()\r\n\r\n    r.seek(header.dirOffset)\r\n    const directoryCount = r.ui()\r\n    const directories: any[] = []\r\n    for (let i = 0; i < directoryCount; ++i) {\r\n      directories.push({\r\n        id: r.ui(),\r\n        name: r.nstr(64),\r\n        flags: r.ui(),\r\n        cdTrack: r.i(),\r\n        time: r.f(),\r\n        frames: r.ui(),\r\n        offset: r.ui(),\r\n        length: r.ui(),\r\n        macros: []\r\n      })\r\n    }\r\n\r\n    for (let i = 0; i < directories.length; ++i) {\r\n      r.seek(directories[i].offset)\r\n\r\n      let isFinalMacroReached = false\r\n      while (!isFinalMacroReached) {\r\n        const macro: any = {\r\n          type: r.b(),\r\n          time: r.f(),\r\n          frame: r.ui()\r\n        }\r\n\r\n        switch (macro.type) {\r\n          case 0:\r\n          case 1: {\r\n            r.skip(4)\r\n            macro.camera = {\r\n              position: [r.f(), r.f(), r.f()],\r\n              orientation: [r.f(), r.f(), r.f()]\r\n            }\r\n            r.skip(436)\r\n            r.skip(r.ui())\r\n            break\r\n          }\r\n\r\n          case 2: {\r\n            // empty macro\r\n            // signals the beginning of directory entry\r\n            break\r\n          }\r\n\r\n          case 3: {\r\n            macro.command = r.nstr(64)\r\n            break\r\n          }\r\n\r\n          case 4: {\r\n            r.skip(32)\r\n            break\r\n          }\r\n\r\n          case 5: {\r\n            // empty macro that signals end of directory entry\r\n            isFinalMacroReached = true\r\n            break\r\n          }\r\n\r\n          case 6: {\r\n            r.skip(84)\r\n            break\r\n          }\r\n\r\n          case 7: {\r\n            r.skip(8)\r\n            break\r\n          }\r\n\r\n          case 8: {\r\n            r.skip(4)\r\n            r.skip(r.ui() + 16)\r\n            break\r\n          }\r\n\r\n          case 9: {\r\n            r.skip(r.ui())\r\n            break\r\n          }\r\n\r\n          default: {\r\n            const offset = Number(r.tell() - 9).toString(16)\r\n            const msg = [`Unexpected macro (${macro.type})`, ` at offset = ${offset}.`].join('')\r\n            throw new Error(msg)\r\n          }\r\n        }\r\n\r\n        directories[i].macros.push(macro)\r\n      }\r\n    }\r\n\r\n    return new Replay(header, directories)\r\n  }\r\n\r\n  static parseFullFromArrayBuffer(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n    const magic = r.nstr(8)\r\n    if (magic !== 'HLDEMO') {\r\n      throw new Error('Invalid replay format')\r\n    }\r\n\r\n    const header: any = {}\r\n    header.demoProtocol = r.ui()\r\n    header.netProtocol = r.ui()\r\n    header.mapName = r.nstr(260)\r\n    header.modName = r.nstr(260)\r\n    header.mapCrc = r.i()\r\n    header.dirOffset = r.ui()\r\n\r\n    r.seek(header.dirOffset)\r\n    const directoryCount = r.ui()\r\n    const directories: any[] = []\r\n    for (let i = 0; i < directoryCount; ++i) {\r\n      directories.push({\r\n        id: r.ui(),\r\n        name: r.nstr(64),\r\n        flags: r.ui(),\r\n        cdTrack: r.i(),\r\n        time: r.f(),\r\n        frames: r.ui(),\r\n        offset: r.ui(),\r\n        length: r.ui(),\r\n        macros: []\r\n      })\r\n    }\r\n\r\n    const deltaDecoders = getInitialDeltaDecoders()\r\n\r\n    const customMessages = []\r\n\r\n    for (let i = 0; i < directories.length; ++i) {\r\n      r.seek(directories[i].offset)\r\n\r\n      let isFinalMacroReached = false\r\n      while (!isFinalMacroReached) {\r\n        const macro: any = {\r\n          type: r.b(),\r\n          time: r.f(),\r\n          frame: r.ui()\r\n        }\r\n        switch (macro.type) {\r\n          case 0:\r\n          case 1: {\r\n            r.skip(4)\r\n            macro.camera = {\r\n              position: [r.f(), r.f(), r.f()],\r\n              orientation: [r.f(), r.f(), r.f()],\r\n              forward: [r.f(), r.f(), r.f()],\r\n              right: [r.f(), r.f(), r.f()],\r\n              up: [r.f(), r.f(), r.f()]\r\n            }\r\n\r\n            macro.RefParams = {\r\n              frametime: r.f(),\r\n              time: r.f(),\r\n              intermission: r.i(),\r\n              paused: r.i(),\r\n              spectator: r.i(),\r\n              onground: r.i(),\r\n              waterlevel: r.i(),\r\n              velocity: [r.f(), r.f(), r.f()],\r\n              origin: [r.f(), r.f(), r.f()],\r\n              viewHeight: [r.f(), r.f(), r.f()],\r\n              idealPitch: r.f(),\r\n              viewAngles: [r.f(), r.f(), r.f()],\r\n              health: r.i(),\r\n              crosshairAngle: [r.f(), r.f(), r.f()],\r\n              viewSize: r.f(),\r\n              punchAngle: [r.f(), r.f(), r.f()],\r\n              maxClients: r.i(),\r\n              viewEntity: r.i(),\r\n              playerCount: r.i(),\r\n              maxEntities: r.i(),\r\n              demoPlayback: r.i(),\r\n              hardware: r.i(),\r\n              smoothing: r.i(),\r\n              ptr_cmd: r.i(),\r\n              ptr_movevars: r.i(),\r\n              viewport: [r.i(), r.i(), r.i(), r.i()],\r\n              nextView: r.i(),\r\n              onlyClientDraw: r.i()\r\n            }\r\n\r\n            macro.UserCmd = {\r\n              lerp_msec: r.s(),\r\n              msec: r.ub(),\r\n              UNUSED1: r.ub(),\r\n              viewAngles: [r.f(), r.f(), r.f()],\r\n              forwardMove: r.f(),\r\n              sideMove: r.f(),\r\n              upMove: r.f(),\r\n              lightLevel: r.b(),\r\n              UNUSED2: r.ub(),\r\n              buttons: r.us(),\r\n              impulse: r.b(),\r\n              weaponSelect: r.b(),\r\n              UNUSED: r.s(),\r\n              impactIndex: r.i(),\r\n              impactPosition: [r.f(), r.f(), r.f()]\r\n            }\r\n\r\n            macro.MoveVars = {\r\n              gravity: r.f(),\r\n              stopSpeed: r.f(),\r\n              maxSpeed: r.f(),\r\n              spectatorMaxSpeed: r.f(),\r\n              acceleration: r.f(),\r\n              airAcceleration: r.f(),\r\n              waterAcceleration: r.f(),\r\n              friction: r.f(),\r\n              edgeFriction: r.f(),\r\n              waterFriction: r.f(),\r\n              entityGravity: r.f(),\r\n              bounce: r.f(),\r\n              stepSize: r.f(),\r\n              maxVelocity: r.f(),\r\n              zMax: r.f(),\r\n              waveHeight: r.f(),\r\n              footsteps: r.i(),\r\n              skyName: r.nstr(32),\r\n              rollAngle: r.f(),\r\n              rollSpeed: r.f(),\r\n              skyColor: [r.f(), r.f(), r.f()],\r\n              skyVec: [r.f(), r.f(), r.f()]\r\n            }\r\n\r\n            macro.view = [r.f(), r.f(), r.f()]\r\n            macro.viewModel = r.i()\r\n\r\n            macro.incoming_sequence = r.i()\r\n            macro.incoming_acknowledged = r.i()\r\n            macro.incoming_reliable_acknowledged = r.i()\r\n            macro.incoming_reliable_sequence = r.i()\r\n            macro.outgoing_sequence = r.i()\r\n            macro.reliable_sequence = r.i()\r\n            macro.last_reliable_sequence = r.i()\r\n\r\n            const frameDataLength = r.ui()\r\n            const frameDataEnd = frameDataLength + r.tell()\r\n            macro.frameData = []\r\n            while (r.tell() < frameDataEnd) {\r\n              const type = r.ub()\r\n              if (type === 1) {\r\n                continue // skip SVC_NOP\r\n              }\r\n\r\n              if (type >= 64) {\r\n                // TODO: parse custom message\r\n                if (customMessages[type] && customMessages[type].size > -1) {\r\n                  r.skip(customMessages[type].size)\r\n                } else {\r\n                  r.skip(r.ub())\r\n                }\r\n\r\n                continue\r\n              }\r\n\r\n              const frameData = FrameData.readFrame(r, type, deltaDecoders)\r\n              if (frameData) {\r\n                if (type === 39) {\r\n                  customMessages[frameData.index] = frameData\r\n                }\r\n                macro.frameData.push({ type, frameData })\r\n              } else {\r\n                r.seek(frameDataEnd)\r\n              }\r\n            }\r\n\r\n            // if r.tell() > frameDataEnd something wrong happened\r\n            r.seek(frameDataEnd)\r\n            break\r\n          }\r\n\r\n          case 2: {\r\n            // empty macro\r\n            // signals the beginning of directory entry\r\n            break\r\n          }\r\n\r\n          case 3: {\r\n            macro.command = r.nstr(64)\r\n            break\r\n          }\r\n\r\n          case 4: {\r\n            macro.clientData = {\r\n              position: [r.f(), r.f(), r.f()],\r\n              rotation: [r.f(), r.f(), r.f()],\r\n              weaponFlags: r.ui(),\r\n              fov: r.f()\r\n            }\r\n            break\r\n          }\r\n\r\n          case 5: {\r\n            // empty macro that signals end of directory entry\r\n            isFinalMacroReached = true\r\n            break\r\n          }\r\n\r\n          case 6: {\r\n            macro.event = {\r\n              flags: r.ui(),\r\n              index: r.ui(),\r\n              delay: r.f(),\r\n              args: {\r\n                flags: r.ui(),\r\n                entityIndex: r.ui(),\r\n                position: [r.f(), r.f(), r.f()],\r\n                rotation: [r.f(), r.f(), r.f()],\r\n                velocity: [r.f(), r.f(), r.f()],\r\n                ducking: r.ui(),\r\n                fparam1: r.f(),\r\n                fparam2: r.f(),\r\n                iparam1: r.i(),\r\n                iparam2: r.i(),\r\n                bparam1: r.i(),\r\n                bparam2: r.i()\r\n              }\r\n            }\r\n            break\r\n          }\r\n\r\n          case 7: {\r\n            macro.weaponAnimation = {\r\n              animation: r.i(),\r\n              body: r.i()\r\n            }\r\n            break\r\n          }\r\n\r\n          case 8: {\r\n            macro.sound = {\r\n              channel: r.i(),\r\n              sample: r.nstr(r.ui()),\r\n              attenuation: r.f(),\r\n              volume: r.f(),\r\n              flags: r.ui(),\r\n              pitch: r.i()\r\n            }\r\n            break\r\n          }\r\n\r\n          case 9: {\r\n            r.skip(r.ui())\r\n            break\r\n          }\r\n\r\n          default: {\r\n            const offset = Number(r.tell() - 9).toString(16)\r\n            const msg = `Unexpected macro (${macro.type}) at offset = ${offset}`\r\n\r\n            throw new Error(msg)\r\n          }\r\n        }\r\n\r\n        directories[i].macros.push(macro)\r\n      }\r\n    }\r\n\r\n    return new Replay(header, directories)\r\n  }\r\n\r\n  static parseIntoChunks(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n\r\n    if (!checkType(r)) {\r\n      throw new Error('Invalid replay file format')\r\n    }\r\n\r\n    const maps = []\r\n    const deltaDecoders = getInitialDeltaDecoders()\r\n    const customMessages: any[] = []\r\n\r\n    const header = readHeader(r)\r\n    const directories = readDirectories(r, header.dirOffset)\r\n\r\n    let currentMap: ReplayMap | undefined\r\n    let currentChunk: ReplayChunk\r\n    let lastFrame: any\r\n    let lastFrameOffset: number\r\n    const state = new ReplayState()\r\n\r\n    // read loading segment\r\n    let directoryEndOffset = directories[0].offset + directories[0].length\r\n    r.seek(directories[0].offset)\r\n    while (r.tell() < directoryEndOffset) {\r\n      const frame = readFrame(r, deltaDecoders, customMessages)\r\n      state.feedFrame(frame)\r\n\r\n      if (frame.error) {\r\n        throw new Error('Encountered error while reading replay')\r\n      }\r\n\r\n      if (frame.type < 2 /* 0 or 1 */) {\r\n        const serverInfo = frame.data.find((msg: any) => msg.type === FrameData.SVC.SERVERINFO)\r\n        if (serverInfo) {\r\n          currentMap = new ReplayMap(serverInfo.data.mapFileName)\r\n          maps.push(currentMap)\r\n        }\r\n\r\n        const resourceList = frame.data.find((msg: any) => msg.type === FrameData.SVC.RESOURCELIST)\r\n        if (resourceList && currentMap) {\r\n          currentMap.setResources(resourceList.data)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!(currentMap instanceof ReplayMap)) {\r\n      throw new Error('Error while parsing replay.')\r\n    }\r\n\r\n    lastFrameOffset = r.tell()\r\n    currentChunk = new ReplayChunk(state, 0)\r\n    currentMap.addChunk(currentChunk)\r\n\r\n    // read playback segment\r\n    directoryEndOffset = directories[1].offset + directories[1].length\r\n    r.seek(directories[1].offset)\r\n    while (true) {\r\n      const offset = r.tell()\r\n      if (offset >= directoryEndOffset) {\r\n        // set last and final chunks data\r\n        const timeLength = lastFrame.time - currentChunk.startTime\r\n        currentChunk.timeLength = timeLength\r\n        const lastFrameLength = offset - lastFrameOffset\r\n        r.seek(lastFrameOffset)\r\n        currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\r\n        r.seek(offset)\r\n\r\n        break\r\n      }\r\n\r\n      const frame = readFrame(r, deltaDecoders, customMessages)\r\n      state.feedFrame(frame)\r\n      lastFrame = frame\r\n\r\n      if (frame.error) {\r\n        throw new Error('Encountered error while reading replay')\r\n      }\r\n\r\n      if (frame.type < 2) {\r\n        const serverInfo = frame.data.find((msg: any) => msg.type === FrameData.SVC.SERVERINFO)\r\n        if (serverInfo) {\r\n          // create new map\r\n          currentMap = new ReplayMap(serverInfo.data.mapFileName)\r\n          maps.push(currentMap)\r\n\r\n          // set last chunks data\r\n          const timeLength = lastFrame.time - currentChunk.startTime\r\n          currentChunk.timeLength = timeLength\r\n          const lastFrameLength = offset - lastFrameOffset\r\n          const tempOffset = r.tell()\r\n          r.seek(lastFrameOffset)\r\n          currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\r\n          r.seek(tempOffset)\r\n\r\n          // create new chunk\r\n          lastFrameOffset = offset\r\n          currentChunk = new ReplayChunk(state, frame.time)\r\n          currentMap.addChunk(currentChunk)\r\n        }\r\n\r\n        const resourceList = frame.data.find((msg: any) => msg.type === FrameData.SVC.RESOURCELIST)\r\n        if (resourceList) {\r\n          currentMap.setResources(resourceList.data)\r\n        }\r\n\r\n        if (serverInfo) {\r\n          continue\r\n        }\r\n\r\n        for (let i = 0; i < frame.data.length; ++i) {\r\n          const message = frame.data[i]\r\n          if (message.type === FrameData.SVC.SOUND || message.type === FrameData.SVC.SPAWNSTATICSOUND) {\r\n            const sound = currentMap.resources.sounds.find((s: any) => s.index === message.data.soundIndex)\r\n            if (sound) {\r\n              sound.used = true\r\n            }\r\n          } else if (message.type === FrameData.SVC.STUFFTEXT) {\r\n            const sounds = currentMap.resources.sounds\r\n            const commands = message.data.commands\r\n\r\n            for (let i = 0; i < commands.length; ++i) {\r\n              const command = commands[i]\r\n\r\n              const func = command.func\r\n              if ((func === 'speak' || func === 'spk') && command.params.length === 1) {\r\n                const soundName = `${command.params[0]}.wav`\r\n                const sound = sounds.find((s: any) => s.name === soundName)\r\n                if (sound) {\r\n                  sound.used = true\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else if (frame.type === 8) {\r\n        const sound = currentMap.resources.sounds.find((s: any) => s.name === frame.sound.sample)\r\n        if (sound) {\r\n          sound.used = true\r\n        }\r\n      }\r\n\r\n      if (currentChunk.startTime + 10 < frame.time) {\r\n        // set last chunks data\r\n        const lastFrameLength = offset - lastFrameOffset\r\n        const tempOffset = r.tell()\r\n        r.seek(lastFrameOffset)\r\n        currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\r\n        r.seek(tempOffset)\r\n\r\n        // create new chunk\r\n        lastFrameOffset = offset\r\n        currentChunk = new ReplayChunk(state, frame.time)\r\n        currentMap.addChunk(currentChunk)\r\n      }\r\n    }\r\n\r\n    return {\r\n      length: directories[1].time,\r\n      maps,\r\n      deltaDecoders,\r\n      customMessages\r\n    }\r\n  }\r\n\r\n  static readHeader(r: Reader) {\r\n    return readHeader(r)\r\n  }\r\n\r\n  static readDirectories(r: Reader, offset: number) {\r\n    return readDirectories(r, offset)\r\n  }\r\n\r\n  static readFrame(r: Reader, deltaDecoders: any, customMessages: any) {\r\n    return readFrame(r, deltaDecoders, customMessages)\r\n  }\r\n\r\n  static readFrameData(r: Reader, deltaDecoders: any, customMessages: any) {\r\n    return readFrame(r, deltaDecoders, customMessages)\r\n  }\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\nimport { paletteWithLastTransToRGBA, paletteToRGBA } from './Util'\r\n\r\ninterface SpriteHeader {\r\n  version: number\r\n  type: SpriteType\r\n  alphaType: SpriteAlphaType\r\n  radius: number\r\n  width: number\r\n  height: number\r\n  frameCount: number\r\n  beamLength: number\r\n  syncType: SpriteSyncType\r\n}\r\n\r\ninterface SpriteFrame {\r\n  group: number\r\n  position: number[]\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport enum SpriteType {\r\n  VP_PARALLEL_UPRIGHT = 0,\r\n  FACING_UPRIGHT = 1,\r\n  VP_PARALLEL = 2,\r\n  ORIENTED = 3,\r\n  VP_PARALLEL_ORIENTED = 4\r\n}\r\n\r\nexport enum SpriteAlphaType {\r\n  SPR_NORMAL = 0,\r\n  SPR_ADDITIVE = 1,\r\n  SPR_INDEXALPHA = 2,\r\n  SPR_ALPHTEST = 3\r\n}\r\n\r\nexport enum SpriteSyncType {\r\n  SYNCHRONIZED = 0,\r\n  RANDOM = 1\r\n}\r\n\r\nexport class Sprite {\r\n  header: SpriteHeader\r\n  frames: SpriteFrame[]\r\n\r\n  constructor(header: SpriteHeader, frames: SpriteFrame[]) {\r\n    this.header = header\r\n    this.frames = frames\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n\r\n    const magic = r.nstr(4)\r\n    if (magic !== 'IDSP') {\r\n      throw new Error('Invalid sprite file format')\r\n    }\r\n\r\n    const header: SpriteHeader = {\r\n      version: r.i(), // must be 2 (1 = Quake, 2 = Half-Life)\r\n      type: r.i(),\r\n      alphaType: r.i(),\r\n      radius: r.f(),\r\n      width: r.i(),\r\n      height: r.i(),\r\n      frameCount: r.i(),\r\n      beamLength: r.f(),\r\n      syncType: r.i()\r\n    }\r\n\r\n    const paletteSize = r.s()\r\n    const palette = r.arrx(paletteSize * 3, ReaderDataType.UByte)\r\n\r\n    const frames: SpriteFrame[] = []\r\n    for (let i = 0; i < header.frameCount; ++i) {\r\n      const frame = {\r\n        group: r.i(),\r\n        position: [r.i(), r.i()],\r\n        width: r.i(),\r\n        height: r.i(),\r\n        data: new Uint8Array(header.width * header.height * 4)\r\n      }\r\n\r\n      const pixels = r.arrx(header.width * header.height, ReaderDataType.UByte)\r\n\r\n      if (header.alphaType === SpriteAlphaType.SPR_ALPHTEST) {\r\n        frame.data = paletteWithLastTransToRGBA(pixels, palette)\r\n      } else {\r\n        frame.data = paletteToRGBA(pixels, palette)\r\n      }\r\n\r\n      frames.push(frame)\r\n    }\r\n\r\n    return new Sprite(header, frames)\r\n  }\r\n}\r\n","export type ProgressCallback = (request: XMLHttpRequest, progress: number) => void\r\n\r\nexport interface XhrParams {\r\n  method: string\r\n  isBinary: boolean\r\n  progressCallback: ProgressCallback\r\n}\r\n\r\nexport function xhr(url: string, params: XhrParams) {\r\n  const method = params.method || 'GET'\r\n  const isBinary = params.isBinary\r\n  const progressCallback = params.progressCallback\r\n\r\n  if (!url) {\r\n    throw new Error('Url parameter missing')\r\n  }\r\n\r\n  return new Promise<any>((resolve, reject) => {\r\n    const request = new XMLHttpRequest()\r\n\r\n    if (isBinary) {\r\n      request.responseType = 'arraybuffer'\r\n    }\r\n\r\n    if (isBinary && progressCallback) {\r\n      request.addEventListener('progress', (event) => {\r\n        if (event.lengthComputable) {\r\n          progressCallback(request, event.loaded / event.total)\r\n        } else {\r\n          // HACK!\r\n          const totalStr = request.getResponseHeader('content-length')\r\n          let total = 0\r\n          if (totalStr) {\r\n            total = Number.parseFloat(totalStr)\r\n          }\r\n          const encoding = request.getResponseHeader('content-encoding')\r\n          if (total && encoding && encoding.indexOf('gzip') > -1) {\r\n            // assuming average gzip compression ratio to be 25%\r\n            total *= 4\r\n            const loadedPercent = Math.min(0.99, event.loaded / total)\r\n            progressCallback(request, loadedPercent)\r\n            // END OF HACK\r\n          } else {\r\n            progressCallback(request, 0)\r\n          }\r\n        }\r\n      })\r\n    }\r\n\r\n    request.addEventListener('readystatechange', () => {\r\n      if (request.readyState !== 4) {\r\n        return\r\n      }\r\n\r\n      if (request.status === 200) {\r\n        if (progressCallback) {\r\n          progressCallback(request, 1)\r\n        }\r\n\r\n        resolve(request.response)\r\n      } else {\r\n        reject({\r\n          status: request.status\r\n        })\r\n      }\r\n    })\r\n\r\n    request.open(method, url, true)\r\n    request.send()\r\n  })\r\n}\r\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\n\nexport var perspective = perspectiveNO;\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\n\nexport var ortho = orthoNO;\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 2 Dimensional Vector\n * @module vec2\n */\n\n/**\n * Creates a new, empty vec2\n *\n * @returns {vec2} a new 2D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec2 initialized with values from an existing vector\n *\n * @param {ReadonlyVec2} a vector to clone\n * @returns {vec2} a new 2D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\n * Creates a new vec2 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} a new 2D vector\n */\n\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\n * Copy the values from one vec2 to another\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the source vector\n * @returns {vec2} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\n * Set the components of a vec2 to the given values\n *\n * @param {vec2} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} out\n */\n\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\n * Adds two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n/**\n * Multiplies two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n/**\n * Divides two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n/**\n * Math.ceil the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to ceil\n * @returns {vec2} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n/**\n * Math.floor the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to floor\n * @returns {vec2} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n/**\n * Returns the minimum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n/**\n * Returns the maximum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n/**\n * Math.round the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to round\n * @returns {vec2} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  return out;\n}\n/**\n * Scales a vec2 by a scalar number\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec2} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n/**\n * Adds two vec2's after scaling the second operand by a scalar value\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec2} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return Math.hypot(x, y);\n}\n/**\n * Calculates the squared euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return x * x + y * y;\n}\n/**\n * Calculates the length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0],\n      y = a[1];\n  return Math.hypot(x, y);\n}\n/**\n * Calculates the squared length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0],\n      y = a[1];\n  return x * x + y * y;\n}\n/**\n * Negates the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to negate\n * @returns {vec2} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to invert\n * @returns {vec2} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n/**\n * Normalize a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to normalize\n * @returns {vec2} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0],\n      y = a[1];\n  var len = x * x + y * y;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n/**\n * Computes the cross product of two vec2's\n * Note that the cross product must by definition produce a 3D vector\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec2} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n      ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec2} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec2} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n/**\n * Transforms the vec2 with a mat2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n/**\n * Transforms the vec2 with a mat2d\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2d} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n/**\n * Transforms the vec2 with a mat3\n * 3rd vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat3} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n/**\n * Transforms the vec2 with a mat4\n * 3rd vector component is implicitly '0'\n * 4th vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n/**\n * Rotate a 2D vector\n * @param {vec2} out The receiving vec2\n * @param {ReadonlyVec2} a The vec2 point to rotate\n * @param {ReadonlyVec2} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec2} out\n */\n\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n      p1 = a[1] - b[1],\n      sinC = Math.sin(rad),\n      cosC = Math.cos(rad); //perform rotation and translate to correct position\n\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n/**\n * Get the angle between two 2D vectors\n * @param {ReadonlyVec2} a The first operand\n * @param {ReadonlyVec2} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var x1 = a[0],\n      y1 = a[1],\n      x2 = b[0],\n      y2 = b[1],\n      // mag is the product of the magnitudes of a and b\n  mag = Math.sqrt(x1 * x1 + y1 * y1) * Math.sqrt(x2 * x2 + y2 * y2),\n      // mag &&.. short circuits if mag == 0\n  cosine = mag && (x1 * x2 + y1 * y2) / mag; // Math.min(Math.max(cosine, -1), 1) clamps the cosine between -1 and 1\n\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec2 to zero\n *\n * @param {vec2} out the receiving vector\n * @returns {vec2} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec2} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1];\n  var b0 = b[0],\n      b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n/**\n * Alias for {@link vec2.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec2.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec2.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec2.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec2.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec2.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec2.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec2s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 2;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n\n    return a;\n  };\n}();","export function vdf(input: string): { [name: string]: any }[] {\r\n  let state = 0\r\n  let key = ''\r\n  let val = ''\r\n  const objects: any[] = []\r\n\r\n  for (let i = 0; i < input.length; ++i) {\r\n    const c = input[i]\r\n\r\n    switch (state) {\r\n      case 0: {\r\n        // ROOT\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        }\r\n\r\n        if (c === '{') {\r\n          objects.push({})\r\n          state = 1\r\n        } else {\r\n          return []\r\n        }\r\n        break\r\n      }\r\n\r\n      case 1: {\r\n        // OBJECT\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        }\r\n\r\n        if (c === '}') {\r\n          state = 0\r\n        } else if (c === '\"') {\r\n          key = ''\r\n          state = 2\r\n        } else {\r\n          return []\r\n        }\r\n        break\r\n      }\r\n\r\n      case 2: {\r\n        // KEY\r\n        if (c === '\"') {\r\n          state = 3\r\n        } else {\r\n          key += c\r\n        }\r\n        break\r\n      }\r\n\r\n      case 3: {\r\n        // BETWEEN KEY AND VALUE\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        }\r\n\r\n        if (c === '\"') {\r\n          val = ''\r\n          state = 4\r\n        }\r\n        break\r\n      }\r\n\r\n      case 4: {\r\n        // VALUE\r\n        if (c === '\"') {\r\n          objects[objects.length - 1][key] = val\r\n          state = 1\r\n        } else {\r\n          val += c\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  return objects\r\n}\r\n","import type { vec3 } from 'gl-matrix'\r\nimport type { Tga } from './Parsers/Tga'\r\nimport type { Sprite } from './Parsers/Sprite'\r\nimport type { BspLightmap } from './BspLightmap'\r\n\r\nexport interface BspTexture {\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n  isExternal: boolean\r\n}\r\n\r\nexport interface BspModel {\r\n  origin: vec3\r\n  faces: {\r\n    buffer: Float32Array\r\n    textureIndex: number\r\n  }[]\r\n}\r\n\r\nexport class Bsp {\r\n  name: string\r\n  entities: any[]\r\n  textures: BspTexture[]\r\n  models: BspModel[]\r\n  lightmap: BspLightmap\r\n  skies: Tga[] = []\r\n  sprites: { [name: string]: Sprite } = {}\r\n\r\n  constructor(name: string, entities: any[], textures: BspTexture[], models: BspModel[], lightmap: BspLightmap) {\r\n    this.name = name\r\n    this.entities = entities\r\n    this.textures = textures\r\n    this.models = models\r\n    this.lightmap = lightmap\r\n  }\r\n}\r\n","export interface BspLightmapNode {\r\n  children: BspLightmapNode[]\r\n  isFilled: boolean\r\n  x: number\r\n  y: number\r\n  width: number\r\n  height: number\r\n}\r\n\r\nexport class BspLightmapParser {\r\n  static TEXTURE_SIZE = 1024\r\n\r\n  static init(lightmap: Uint8Array) {\r\n    return new BspLightmapParser(lightmap)\r\n  }\r\n\r\n  private lightmap: Uint8Array // entire lightmap of the bsp map\r\n  private texture: Uint8Array\r\n  private block = new Uint16Array(BspLightmapParser.TEXTURE_SIZE)\r\n\r\n  private constructor(lightmap: Uint8Array) {\r\n    this.lightmap = lightmap\r\n\r\n    this.texture = new Uint8Array(BspLightmapParser.TEXTURE_SIZE * BspLightmapParser.TEXTURE_SIZE * 4)\r\n    this.texture[this.texture.length - 4] = 255\r\n    this.texture[this.texture.length - 3] = 255\r\n    this.texture[this.texture.length - 2] = 255\r\n    this.texture[this.texture.length - 1] = 255\r\n  }\r\n\r\n  getTexture() {\r\n    return this.texture\r\n  }\r\n\r\n  processFace(\r\n    faceData: Float32Array,\r\n    texinfo: {\r\n      // TODO: MapTexInfo interface\r\n      s: number[]\r\n      sShift: number\r\n      t: number[]\r\n      tShift: number\r\n      textureIndex: number\r\n      flags: number\r\n    },\r\n    offset: number\r\n  ) {\r\n    const size = this.getDimensions(faceData)\r\n    const rect = this.readLightmap(offset, size.width, size.height)\r\n    if (rect) {\r\n      // Determine the correct TexCoords for the lightmap (I think this bit is bugged too)\r\n      for (let i = 0; i < faceData.length / 7; ++i) {\r\n        let lu =\r\n          faceData[i * 7] * texinfo.s[0] +\r\n          faceData[i * 7 + 1] * texinfo.s[1] +\r\n          faceData[i * 7 + 2] * texinfo.s[2] +\r\n          texinfo.sShift -\r\n          size.minU\r\n        lu += rect.x * 16 + 8\r\n        lu /= BspLightmapParser.TEXTURE_SIZE * 16\r\n\r\n        let lv =\r\n          faceData[i * 7] * texinfo.t[0] +\r\n          faceData[i * 7 + 1] * texinfo.t[1] +\r\n          faceData[i * 7 + 2] * texinfo.t[2] +\r\n          texinfo.tShift -\r\n          size.minV\r\n        lv += rect.y * 16 + 8\r\n        lv /= BspLightmapParser.TEXTURE_SIZE * 16\r\n\r\n        faceData[i * 7 + 5] = lu\r\n        faceData[i * 7 + 6] = lv\r\n      }\r\n    }\r\n  }\r\n\r\n  private getDimensions(faceData: Float32Array) {\r\n    // find the min and max UV's for a face\r\n    let minU = Math.floor(faceData[3])\r\n    let minV = Math.floor(faceData[4])\r\n    let maxU = Math.floor(faceData[3])\r\n    let maxV = Math.floor(faceData[4])\r\n\r\n    for (let i = 1; i < faceData.length / 7; ++i) {\r\n      if (Math.floor(faceData[i * 7 + 3]) < minU) {\r\n        minU = Math.floor(faceData[i * 7 + 3])\r\n      }\r\n      if (Math.floor(faceData[i * 7 + 4]) < minV) {\r\n        minV = Math.floor(faceData[i * 7 + 4])\r\n      }\r\n      if (Math.floor(faceData[i * 7 + 3]) > maxU) {\r\n        maxU = Math.floor(faceData[i * 7 + 3])\r\n      }\r\n      if (Math.floor(faceData[i * 7 + 4]) > maxV) {\r\n        maxV = Math.floor(faceData[i * 7 + 4])\r\n      }\r\n    }\r\n\r\n    // calculate the lightmap dimensions\r\n    return {\r\n      width: Math.ceil(maxU / 16) - Math.floor(minU / 16) + 1,\r\n      height: Math.ceil(maxV / 16) - Math.floor(minV / 16) + 1,\r\n      minU: Math.floor(minU),\r\n      minV: Math.floor(minV)\r\n    }\r\n  }\r\n\r\n  private readLightmap(offset: number, width: number, height: number): { x: number; y: number } | null {\r\n    if (height <= 0 || width <= 0) {\r\n      return null\r\n    }\r\n\r\n    const block = this.findFreeSpace(width, height)\r\n\r\n    if (block) {\r\n      const o = [block.x, block.y]\r\n      const s = [width, height]\r\n      const d = [BspLightmapParser.TEXTURE_SIZE, BspLightmapParser.TEXTURE_SIZE]\r\n      const count = width * height\r\n      for (let i = 0; i < count; ++i) {\r\n        const p = o[1] * d[0] + o[0] + d[0] * Math.floor(i / s[0]) + (i % s[0])\r\n        this.texture[p * 4] = Math.min(255, this.lightmap[offset + i * 3] * 2)\r\n        this.texture[p * 4 + 1] = Math.min(255, this.lightmap[offset + i * 3 + 1] * 2)\r\n        this.texture[p * 4 + 2] = Math.min(255, this.lightmap[offset + i * 3 + 2] * 2)\r\n        this.texture[p * 4 + 3] = 255\r\n      }\r\n    }\r\n\r\n    return block\r\n  }\r\n\r\n  private findFreeSpace(w: number, h: number): { x: number; y: number } | null {\r\n    let x = 0\r\n    let y = 0\r\n\r\n    let bestHeight = BspLightmapParser.TEXTURE_SIZE\r\n    for (let i = 0; i < this.block.length - w; ++i) {\r\n      let tentativeHeight = 0\r\n\r\n      let j = 0\r\n      for (; j < w; ++j) {\r\n        if (this.block[i + j] >= bestHeight) {\r\n          break\r\n        }\r\n        if (this.block[i + j] > tentativeHeight) {\r\n          tentativeHeight = this.block[i + j]\r\n        }\r\n      }\r\n\r\n      if (j === w) {\r\n        x = i\r\n        y = bestHeight = tentativeHeight\r\n      }\r\n    }\r\n\r\n    if (bestHeight + h > BspLightmapParser.TEXTURE_SIZE) {\r\n      return null\r\n    }\r\n\r\n    for (let i = 0; i < w; ++i) {\r\n      this.block[x + i] = bestHeight + h\r\n    }\r\n\r\n    return { x, y }\r\n  }\r\n}\r\n","import { vec3 } from 'gl-matrix'\r\nimport { basename } from '../Util'\r\nimport { vdf } from '../Parsers/Vdf'\r\nimport { Bsp, type BspTexture } from '../Bsp'\r\nimport { Reader, ReaderDataType } from '../Reader'\r\nimport { BspLightmapParser } from '../Parsers/BspLightmapParser'\r\nimport { paletteWithLastTransToRGBA, paletteToRGBA } from './Util'\r\n\r\nexport function parseModels(\r\n  models: BspLumpModel[],\r\n  faces: BspLumpFace[],\r\n  edges: BspLumpEdge[],\r\n  surfEdges: BspLumpSurfedge[],\r\n  vertices: BspLumpVertex[],\r\n  texinfo: BspLumpTexInfo[],\r\n  textures: BspTexture[],\r\n  lightmap: BspLightmapParser\r\n) {\r\n  const parsedModels = []\r\n\r\n  for (let i = 0; i < models.length; ++i) {\r\n    const model = models[i]\r\n\r\n    const _faces: {\r\n      buffer: Float32Array\r\n      textureIndex: number\r\n    }[] = []\r\n\r\n    const v0 = new Float32Array(3)\r\n    const v1 = new Float32Array(3)\r\n    const v2 = new Float32Array(3)\r\n    const uv0 = new Float32Array(2)\r\n    const uv1 = new Float32Array(2)\r\n    const uv2 = new Float32Array(2)\r\n    const luv0 = new Float32Array(2)\r\n    const luv1 = new Float32Array(2)\r\n    const luv2 = new Float32Array(2)\r\n\r\n    const _origin = i === 0 ? [0, 0, 0] : [0, 0, 0].map((_, i) => (model.maxs[i] - model.mins[i]) / 2 + model.mins[i])\r\n    const origin = vec3.fromValues(_origin[0], _origin[1], _origin[2])\r\n\r\n    for (let i = model.firstFace; i < model.firstFace + model.faceCount; ++i) {\r\n      const faceData = {\r\n        // 3 floats vertices | 2 floats uvs | 2 floats luvs\r\n        buffer: new Float32Array((faces[i].edgeCount - 2) * 21),\r\n        textureIndex: -1\r\n      }\r\n\r\n      const faceTexInfo = texinfo[faces[i].textureInfo]\r\n      const faceTexture = textures[faceTexInfo.textureIndex]\r\n      const faceSurfEdges = surfEdges.slice(faces[i].firstEdge, faces[i].firstEdge + faces[i].edgeCount)\r\n\r\n      const v0idx = edges[Math.abs(faceSurfEdges[0])][faceSurfEdges[0] > 0 ? 0 : 1]\r\n      v0[0] = vertices[v0idx][0]\r\n      v0[1] = vertices[v0idx][1]\r\n      v0[2] = vertices[v0idx][2]\r\n\r\n      uv0[0] = v0[0] * faceTexInfo.s[0] + v0[1] * faceTexInfo.s[1] + v0[2] * faceTexInfo.s[2] + faceTexInfo.sShift\r\n      uv0[1] = v0[0] * faceTexInfo.t[0] + v0[1] * faceTexInfo.t[1] + v0[2] * faceTexInfo.t[2] + faceTexInfo.tShift\r\n\r\n      luv0[0] = 0\r\n      luv0[1] = 0\r\n\r\n      const v1idx = edges[Math.abs(faceSurfEdges[1])][faceSurfEdges[1] > 0 ? 0 : 1]\r\n      v1[0] = vertices[v1idx][0]\r\n      v1[1] = vertices[v1idx][1]\r\n      v1[2] = vertices[v1idx][2]\r\n\r\n      uv1[0] = v1[0] * faceTexInfo.s[0] + v1[1] * faceTexInfo.s[1] + v1[2] * faceTexInfo.s[2] + faceTexInfo.sShift\r\n      uv1[1] = v1[0] * faceTexInfo.t[0] + v1[1] * faceTexInfo.t[1] + v1[2] * faceTexInfo.t[2] + faceTexInfo.tShift\r\n      luv1[0] = 0\r\n      luv1[1] = 0.999\r\n\r\n      let compIndex = 0\r\n      for (let j = 2; j < faces[i].edgeCount; ++j) {\r\n        const v2idx = edges[Math.abs(faceSurfEdges[j])][faceSurfEdges[j] > 0 ? 0 : 1]\r\n        v2[0] = vertices[v2idx][0]\r\n        v2[1] = vertices[v2idx][1]\r\n        v2[2] = vertices[v2idx][2]\r\n        uv2[0] = v2[0] * faceTexInfo.s[0] + v2[1] * faceTexInfo.s[1] + v2[2] * faceTexInfo.s[2] + faceTexInfo.sShift\r\n        uv2[1] = v2[0] * faceTexInfo.t[0] + v2[1] * faceTexInfo.t[1] + v2[2] * faceTexInfo.t[2] + faceTexInfo.tShift\r\n        luv2[0] = 0.999\r\n        luv2[1] = 0.999\r\n\r\n        // vert1: coord, uv and luv\r\n        faceData.buffer[compIndex++] = v0[0]\r\n        faceData.buffer[compIndex++] = v0[1]\r\n        faceData.buffer[compIndex++] = v0[2]\r\n        faceData.buffer[compIndex++] = uv0[0]\r\n        faceData.buffer[compIndex++] = uv0[1]\r\n        faceData.buffer[compIndex++] = luv0[0]\r\n        faceData.buffer[compIndex++] = luv0[1]\r\n\r\n        // vert2\r\n        faceData.buffer[compIndex++] = v1[0]\r\n        faceData.buffer[compIndex++] = v1[1]\r\n        faceData.buffer[compIndex++] = v1[2]\r\n        faceData.buffer[compIndex++] = uv1[0]\r\n        faceData.buffer[compIndex++] = uv1[1]\r\n        faceData.buffer[compIndex++] = luv1[0]\r\n        faceData.buffer[compIndex++] = luv1[1]\r\n\r\n        // vert2\r\n        faceData.buffer[compIndex++] = v2[0]\r\n        faceData.buffer[compIndex++] = v2[1]\r\n        faceData.buffer[compIndex++] = v2[2]\r\n        faceData.buffer[compIndex++] = uv2[0]\r\n        faceData.buffer[compIndex++] = uv2[1]\r\n        faceData.buffer[compIndex++] = luv2[0]\r\n        faceData.buffer[compIndex++] = luv2[1]\r\n\r\n        v1[0] = v2[0]\r\n        v1[1] = v2[1]\r\n        v1[2] = v2[2]\r\n        uv1[0] = uv2[0]\r\n        uv1[1] = uv2[1]\r\n        luv1[0] = luv2[0]\r\n        luv1[1] = luv2[1]\r\n      }\r\n\r\n      // face has a lightmap if flag is equal to 0\r\n      if (faceTexInfo.flags === 0 || faceTexInfo.flags === -65536) {\r\n        lightmap.processFace(faceData.buffer, faceTexInfo, faces[i].lightmapOffset)\r\n      }\r\n\r\n      faceData.textureIndex = faceTexInfo.textureIndex\r\n\r\n      for (let j = 0; j < faceData.buffer.length / 7; ++j) {\r\n        faceData.buffer[j * 7] -= origin[0]\r\n        faceData.buffer[j * 7 + 1] -= origin[1]\r\n        faceData.buffer[j * 7 + 2] -= origin[2]\r\n        faceData.buffer[j * 7 + 3] /= faceTexture.width\r\n        faceData.buffer[j * 7 + 4] /= faceTexture.height\r\n      }\r\n\r\n      _faces.push(faceData)\r\n    }\r\n\r\n    parsedModels.push({\r\n      origin,\r\n      faces: _faces\r\n    })\r\n  }\r\n\r\n  return parsedModels\r\n}\r\n\r\nexport enum BspLumpIndex {\r\n  Entities = 0,\r\n  Planes = 1,\r\n  Textures = 2,\r\n  Vertices = 3,\r\n  Visibility = 4,\r\n  Nodes = 5,\r\n  TexInfo = 6,\r\n  Faces = 7,\r\n  Lighting = 8,\r\n  ClipNodes = 9,\r\n  Leaves = 10,\r\n  MarkSurfaces = 11,\r\n  Edges = 12,\r\n  SurfEdges = 13,\r\n  Models = 14\r\n}\r\n\r\nexport interface BspLump {\r\n  offset: number\r\n  length: number\r\n}\r\n\r\nexport interface BspLumpFace {\r\n  plane: number\r\n  planeSide: number\r\n  firstEdge: number\r\n  edgeCount: number\r\n  textureInfo: number\r\n  styles: number[]\r\n  lightmapOffset: number\r\n}\r\n\r\nexport interface BspLumpModel {\r\n  mins: number[]\r\n  maxs: number[]\r\n  origin: vec3\r\n  headNodes: number[]\r\n  visLeaves: number\r\n  firstFace: number\r\n  faceCount: number\r\n}\r\n\r\nexport type BspLumpEdge = number[]\r\n\r\nexport type BspLumpSurfedge = number\r\n\r\nexport type BspLumpVertex = number[]\r\n\r\nexport interface BspLumpTexInfo {\r\n  s: number[]\r\n  sShift: number\r\n  t: number[]\r\n  tShift: number\r\n  textureIndex: number\r\n  flags: number\r\n}\r\n\r\nexport type BspLumpLightmap = Uint8Array\r\n\r\nexport const BspParser = {\r\n  parse(name: string, buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n    const version = r.ui()\r\n    if (version !== 30) {\r\n      throw new Error('Invalid map version')\r\n    }\r\n\r\n    const lumps: BspLump[] = []\r\n    for (let i = 0; i < 15; ++i) {\r\n      lumps.push({\r\n        offset: r.ui(),\r\n        length: r.ui()\r\n      })\r\n    }\r\n\r\n    const entities = this.loadEntities(r, lumps[BspLumpIndex.Entities].offset, lumps[BspLumpIndex.Entities].length)\r\n\r\n    const textures = this.loadTextures(r, lumps[BspLumpIndex.Textures].offset)\r\n\r\n    const models = this.loadModels(r, lumps[BspLumpIndex.Models].offset, lumps[BspLumpIndex.Models].length)\r\n\r\n    const faces = this.loadFaces(r, lumps[BspLumpIndex.Faces].offset, lumps[BspLumpIndex.Faces].length)\r\n\r\n    const edges = this.loadEdges(r, lumps[BspLumpIndex.Edges].offset, lumps[BspLumpIndex.Edges].length)\r\n\r\n    const surfEdges = this.loadSurfEdges(r, lumps[BspLumpIndex.SurfEdges].offset, lumps[BspLumpIndex.SurfEdges].length)\r\n\r\n    const vertices = this.loadVertices(r, lumps[BspLumpIndex.Vertices].offset, lumps[BspLumpIndex.Vertices].length)\r\n\r\n    const texinfo = this.loadTexInfo(r, lumps[BspLumpIndex.TexInfo].offset, lumps[BspLumpIndex.TexInfo].length)\r\n\r\n    const lightmap = this.loadLightmap(r, lumps[BspLumpIndex.Lighting].offset, lumps[BspLumpIndex.Lighting].length)\r\n\r\n    const parsedLightmap = BspLightmapParser.init(lightmap)\r\n\r\n    const parsedModels = parseModels(models, faces, edges, surfEdges, vertices, texinfo, textures, parsedLightmap)\r\n\r\n    return new Bsp(name, entities, textures, parsedModels, {\r\n      width: BspLightmapParser.TEXTURE_SIZE,\r\n      height: BspLightmapParser.TEXTURE_SIZE,\r\n      data: parsedLightmap.getTexture()\r\n    })\r\n  },\r\n  loadFaces(r: Reader, offset: number, length: number): BspLumpFace[] {\r\n    r.seek(offset)\r\n\r\n    const faces = []\r\n    for (let i = 0; i < length / 20; ++i) {\r\n      faces.push({\r\n        plane: r.us(),\r\n        planeSide: r.us(),\r\n        firstEdge: r.ui(),\r\n        edgeCount: r.us(),\r\n        textureInfo: r.us(),\r\n        styles: [r.ub(), r.ub(), r.ub(), r.ub()],\r\n        lightmapOffset: r.ui()\r\n      })\r\n    }\r\n    return faces\r\n  },\r\n  loadModels(r: Reader, offset: number, length: number): BspLumpModel[] {\r\n    r.seek(offset)\r\n\r\n    const models = []\r\n    for (let i = 0; i < length / 64; ++i) {\r\n      models.push({\r\n        mins: [r.f(), r.f(), r.f()],\r\n        maxs: [r.f(), r.f(), r.f()],\r\n        origin: vec3.fromValues(r.f(), r.f(), r.f()),\r\n        headNodes: [r.i(), r.i(), r.i(), r.i()],\r\n        visLeaves: r.i(),\r\n        firstFace: r.i(),\r\n        faceCount: r.i()\r\n      })\r\n    }\r\n    return models\r\n  },\r\n  loadEdges(r: Reader, offset: number, length: number): BspLumpEdge[] {\r\n    r.seek(offset)\r\n\r\n    const edges = []\r\n    for (let i = 0; i < length / 4; ++i) {\r\n      edges.push([r.us(), r.us()])\r\n    }\r\n    return edges\r\n  },\r\n  loadSurfEdges(r: Reader, offset: number, length: number): BspLumpSurfedge[] {\r\n    r.seek(offset)\r\n\r\n    const surfEdges = []\r\n    for (let i = 0; i < length / 4; ++i) {\r\n      surfEdges.push(r.i())\r\n    }\r\n    return surfEdges\r\n  },\r\n  loadVertices(r: Reader, offset: number, length: number): BspLumpVertex[] {\r\n    r.seek(offset)\r\n\r\n    const vertices = []\r\n    for (let i = 0; i < length / 12; ++i) {\r\n      vertices.push([r.f(), r.f(), r.f()])\r\n    }\r\n    return vertices\r\n  },\r\n  loadTexInfo(r: Reader, offset: number, length: number): BspLumpTexInfo[] {\r\n    r.seek(offset)\r\n\r\n    const texinfo: BspLumpTexInfo[] = []\r\n    for (let i = 0; i < length / 40; ++i) {\r\n      texinfo.push({\r\n        s: [r.f(), r.f(), r.f()],\r\n        sShift: r.f(),\r\n        t: [r.f(), r.f(), r.f()],\r\n        tShift: r.f(),\r\n        textureIndex: r.i(),\r\n        flags: r.i()\r\n      })\r\n    }\r\n    return texinfo\r\n  },\r\n  loadLightmap(r: Reader, offset: number, length: number): BspLumpLightmap {\r\n    r.seek(offset)\r\n    return r.arrx(length, ReaderDataType.UByte)\r\n  },\r\n  loadTextureData(r: Reader) {\r\n    const name = r.nstr(16)\r\n    const width = r.ui()\r\n    const height = r.ui()\r\n\r\n    const isExternal = !r.ui() // if mipmap offset == 0\r\n    if (isExternal) {\r\n      const data = new Uint8Array(4)\r\n      data[0] = data[1] = data[2] = data[3] = 255\r\n\r\n      return { name, width, height, data, isExternal }\r\n    }\r\n\r\n    r.skip(3 * 4) // skip mipmap offsets\r\n\r\n    // read largest mipmap data\r\n    const pixelCount = width * height\r\n    const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n    // skip other 3 mipmaps\r\n    r.skip(21 * (pixelCount / 64))\r\n\r\n    r.skip(2) // skip padding bytes\r\n\r\n    const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n    const data = name[0] === '{' ? paletteWithLastTransToRGBA(pixels, palette) : paletteToRGBA(pixels, palette)\r\n\r\n    return { name, width, height, data, isExternal }\r\n  },\r\n  loadTextures(r: Reader, offset: number) {\r\n    r.seek(offset)\r\n\r\n    const count = r.ui()\r\n    const offsets = []\r\n    for (let i = 0; i < count; ++i) {\r\n      offsets.push(r.ui())\r\n    }\r\n\r\n    const textures: BspTexture[] = []\r\n    for (let i = 0; i < count; ++i) {\r\n      if (offsets[i] === 0xffffffff) {\r\n        textures.push({\r\n          name: 'ERROR404',\r\n          width: 1,\r\n          height: 1,\r\n          data: new Uint8Array([0, 255, 0, 255]),\r\n          isExternal: false\r\n        })\r\n      } else {\r\n        r.seek(offset + offsets[i])\r\n        textures.push(this.loadTextureData(r))\r\n      }\r\n    }\r\n\r\n    return textures\r\n  },\r\n  loadEntities(r: Reader, offset: number, length: number) {\r\n    r.seek(offset)\r\n    const entities = vdf(r.nstr(length))\r\n\r\n    const VECTOR_ATTRS = ['origin', 'angles', '_diffuse_light', '_light', 'rendercolor', 'avelocity']\r\n    const NUMBER_ATTRS = ['renderamt', 'rendermode', 'scale']\r\n\r\n    const worldSpawn = entities[0]\r\n    if (worldSpawn.classname === 'worldspawn') {\r\n      worldSpawn.model = '*0'\r\n      worldSpawn.wad = worldSpawn.wad || ''\r\n      worldSpawn.wad = worldSpawn.wad\r\n        .split(';')\r\n        .filter((w: string) => w.length)\r\n        .map((w: string) => w.replace(/\\\\/g, '/'))\r\n        .map((w: string) => basename(w))\r\n    }\r\n\r\n    for (const e of entities) {\r\n      if (e.model) {\r\n        if (typeof e.renderamt === 'undefined') {\r\n          e.renderamt = 0\r\n        }\r\n\r\n        if (typeof e.rendermode === 'undefined') {\r\n          e.rendermode = 0\r\n        }\r\n\r\n        if (typeof e.renderfx === 'undefined') {\r\n          e.renderfx = 0\r\n        }\r\n\r\n        if (typeof e.rendercolor === 'undefined') {\r\n          e.rendercolor = '0 0 0'\r\n        }\r\n      }\r\n\r\n      for (const attr of VECTOR_ATTRS) {\r\n        if (e[attr]) {\r\n          e[attr] = e[attr].split(' ').map((v: string) => Number.parseFloat(v))\r\n        }\r\n      }\r\n\r\n      for (const attr of NUMBER_ATTRS) {\r\n        if (e[attr]) {\r\n          e[attr] = Number.parseFloat(e[attr])\r\n        }\r\n      }\r\n    }\r\n\r\n    return entities\r\n  }\r\n}\r\n","import { createNanoEvents, type Emitter as EventEmitter } from 'nanoevents'\r\nimport type { Bsp } from './Bsp'\r\nimport { Sound } from './Sound'\r\nimport { extname } from './Util'\r\nimport type { Config } from './Config'\r\nimport { Tga } from './Parsers/Tga'\r\nimport { Wad } from './Parsers/Wad'\r\nimport { Replay } from './Replay/Replay'\r\nimport { Sprite } from './Parsers/Sprite'\r\nimport { xhr, type ProgressCallback } from './Xhr'\r\nimport { BspParser } from './Parsers/BspParser'\r\n\r\nenum LoadItemStatus {\r\n  Loading = 1,\r\n  Skipped = 2,\r\n  Error = 3,\r\n  Done = 4\r\n}\r\n\r\nclass LoadItemBase<T> {\r\n  name: string\r\n  progress: number\r\n  status: LoadItemStatus\r\n  data: T | null\r\n\r\n  constructor(name: string) {\r\n    this.name = name\r\n    this.progress = 0\r\n    this.status = LoadItemStatus.Loading\r\n    this.data = null\r\n  }\r\n\r\n  isLoading() {\r\n    return this.status === LoadItemStatus.Loading\r\n  }\r\n\r\n  skip() {\r\n    this.status = LoadItemStatus.Skipped\r\n  }\r\n\r\n  isSkipped() {\r\n    return this.status === LoadItemStatus.Skipped\r\n  }\r\n\r\n  // TODO: Add error reason\r\n  error() {\r\n    this.status = LoadItemStatus.Error\r\n  }\r\n\r\n  isError() {\r\n    return this.status === LoadItemStatus.Error\r\n  }\r\n\r\n  done(data: T) {\r\n    this.status = LoadItemStatus.Done\r\n    this.data = data\r\n  }\r\n\r\n  isDone() {\r\n    return this.status === LoadItemStatus.Done\r\n  }\r\n}\r\n\r\nclass LoadItemReplay extends LoadItemBase<any> {\r\n  type = 'replay' as const\r\n}\r\n\r\nclass LoadItemBsp extends LoadItemBase<Bsp> {\r\n  type = 'bsp' as const\r\n}\r\n\r\nclass LoadItemSky extends LoadItemBase<Tga> {\r\n  type = 'sky' as const\r\n}\r\n\r\nclass LoadItemWad extends LoadItemBase<Wad> {\r\n  type = 'wad' as const\r\n}\r\n\r\nclass LoadItemSound extends LoadItemBase<Sound> {\r\n  type = 'sound' as const\r\n}\r\n\r\nclass LoadItemSprite extends LoadItemBase<Sprite> {\r\n  type = 'sprite' as const\r\n}\r\n\r\nexport type LoadItem = LoadItemReplay | LoadItemBsp | LoadItemSky | LoadItemWad | LoadItemSound | LoadItemSprite\r\n\r\nexport class Loader {\r\n  config: Config\r\n\r\n  replay?: LoadItemReplay\r\n  map?: LoadItemBsp\r\n  skies: LoadItemSky[]\r\n  wads: LoadItemWad[]\r\n  sounds: LoadItemSound[]\r\n  sprites: { [name: string]: LoadItemSprite } = {}\r\n  events: EventEmitter\r\n\r\n  constructor(config: Config) {\r\n    this.config = config\r\n\r\n    this.replay = undefined\r\n    this.map = undefined\r\n    this.skies = []\r\n    this.wads = []\r\n    this.sounds = []\r\n\r\n    this.events = createNanoEvents()\r\n    this.events.on('error', (err: any) => {\r\n      console.error(err)\r\n    })\r\n  }\r\n\r\n  clear() {\r\n    this.replay = undefined\r\n    this.map = undefined\r\n    this.skies.length = 0\r\n    this.wads.length = 0\r\n    this.sounds.length = 0\r\n    this.sprites = {}\r\n  }\r\n\r\n  checkStatus() {\r\n    if (this.replay && !this.replay.isDone()) {\r\n      return\r\n    }\r\n\r\n    if (this.map && !this.map.isDone()) {\r\n      return\r\n    }\r\n\r\n    for (let i = 0; i < this.skies.length; ++i) {\r\n      if (this.skies[i].isLoading()) {\r\n        return\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.wads.length; ++i) {\r\n      if (this.wads[i].isLoading()) {\r\n        return\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.sounds.length; ++i) {\r\n      if (this.sounds[i].isLoading()) {\r\n        return\r\n      }\r\n    }\r\n\r\n    const sprites = Object.entries(this.sprites)\r\n    for (let i = 0; i < sprites.length; ++i) {\r\n      if (sprites[i][1].isLoading()) {\r\n        return\r\n      }\r\n    }\r\n\r\n    this.events.emit('loadall', this)\r\n  }\r\n\r\n  load(name: string) {\r\n    const extension = extname(name)\r\n    if (extension === '.dem') {\r\n      this.loadReplay(name)\r\n    } else if (extension === '.bsp') {\r\n      this.loadMap(name)\r\n    } else {\r\n      this.events.emit('error', 'Invalid file extension', name)\r\n    }\r\n  }\r\n\r\n  async loadReplay(name: string) {\r\n    this.replay = new LoadItemReplay(name)\r\n    this.events.emit('loadstart', this.replay)\r\n\r\n    const progressCallback: ProgressCallback = (_1, progress) => {\r\n      if (this.replay) {\r\n        this.replay.progress = progress\r\n      }\r\n\r\n      this.events.emit('progress', this.replay)\r\n    }\r\n\r\n    const replayPath = this.config.getReplaysPath()\r\n    const buffer = await xhr(`${replayPath}/${name}`, {\r\n      method: 'GET',\r\n      isBinary: true,\r\n      progressCallback\r\n    }).catch((err: any) => {\r\n      if (this.replay) {\r\n        this.replay.error()\r\n      }\r\n      this.events.emit('error', err, this.replay)\r\n    })\r\n\r\n    if (this.replay.isError()) {\r\n      return\r\n    }\r\n\r\n    const replay = Replay.parseIntoChunks(buffer)\r\n    this.replay.done(replay)\r\n\r\n    this.loadMap(`${replay.maps[0].name}.bsp`)\r\n\r\n    const sounds = replay.maps[0].resources.sounds\r\n    for (const sound of sounds) {\r\n      if (sound.used) {\r\n        this.loadSound(sound.name, sound.index)\r\n      }\r\n    }\r\n\r\n    this.events.emit('load', this.replay)\r\n    this.checkStatus()\r\n  }\r\n\r\n  async loadMap(name: string) {\r\n    this.map = new LoadItemBsp(name)\r\n    this.events.emit('loadstart', this.map)\r\n\r\n    const progressCallback: ProgressCallback = (_1, progress) => {\r\n      if (this.map) {\r\n        this.map.progress = progress\r\n      }\r\n\r\n      this.events.emit('progress', this.map)\r\n    }\r\n\r\n    const mapsPath = this.config.getMapsPath()\r\n    const buffer = await xhr(`${mapsPath}/${name}`, {\r\n      method: 'GET',\r\n      isBinary: true,\r\n      progressCallback\r\n    }).catch((err) => {\r\n      if (this.map) {\r\n        this.map.error()\r\n      }\r\n\r\n      this.events.emit('error', err, this.map)\r\n    })\r\n\r\n    if (this.map.isError()) {\r\n      return\r\n    }\r\n\r\n    const map = BspParser.parse(name, buffer)\r\n    this.map.done(map)\r\n\r\n    map.entities\r\n      .map((e: any) => {\r\n        if (typeof e.model === 'string' && e.model.indexOf('.spr') > -1) {\r\n          return e.model as string\r\n        }\r\n        return undefined\r\n      })\r\n      .filter((a: string | undefined, pos: number, arr: (string | undefined)[]) => a && arr.indexOf(a) === pos)\r\n      .map((a) => a && this.loadSprite(a))\r\n\r\n    const skyname = map.entities[0].skyname\r\n    if (skyname) {\r\n      const sides = ['bk', 'dn', 'ft', 'lf', 'rt', 'up']\r\n      sides.map((a) => `${skyname}${a}`).map((a) => this.loadSky(a))\r\n    }\r\n\r\n    // check if there is at least one missing texture\r\n    // if yes then load wad files (textures should be there)\r\n    if (map.textures.find((a) => a.isExternal)) {\r\n      const wads = map.entities[0].wad\r\n      const wadPromises = wads.map((w: string) => this.loadWad(w))\r\n      await Promise.all(wadPromises)\r\n    }\r\n\r\n    this.events.emit('load', this.map)\r\n    this.checkStatus()\r\n  }\r\n\r\n  async loadSprite(name: string) {\r\n    const item = new LoadItemSprite(name)\r\n    this.sprites[name] = item\r\n    this.events.emit('loadstart', item)\r\n\r\n    const progressCallback: ProgressCallback = (_1, progress) => {\r\n      item.progress = progress\r\n      this.events.emit('progress', item)\r\n    }\r\n\r\n    const buffer = await xhr(`${this.config.getBasePath()}/${name}`, {\r\n      method: 'GET',\r\n      isBinary: true,\r\n      progressCallback\r\n    }).catch((err: any) => {\r\n      item.error()\r\n      this.events.emit('error', err, item)\r\n      this.checkStatus()\r\n    })\r\n\r\n    if (item.isError()) {\r\n      return\r\n    }\r\n\r\n    const sprite = Sprite.parse(buffer)\r\n    item.done(sprite)\r\n    this.events.emit('load', item)\r\n    this.checkStatus()\r\n  }\r\n\r\n  async loadSky(name: string) {\r\n    const item = new LoadItemSky(name)\r\n    this.skies.push(item)\r\n    this.events.emit('loadstart', item)\r\n\r\n    const progressCallback: ProgressCallback = (_1, progress) => {\r\n      item.progress = progress\r\n      this.events.emit('progress', item)\r\n    }\r\n\r\n    const skiesPath = this.config.getSkiesPath()\r\n    const buffer = await xhr(`${skiesPath}/${name}.tga`, {\r\n      method: 'GET',\r\n      isBinary: true,\r\n      progressCallback\r\n    }).catch((err: any) => {\r\n      item.error()\r\n      this.events.emit('error', err, item)\r\n      this.checkStatus()\r\n    })\r\n\r\n    if (item.isError()) {\r\n      return\r\n    }\r\n\r\n    const skyImage = Tga.parse(buffer, name)\r\n    item.done(skyImage)\r\n    this.events.emit('load', item)\r\n    this.checkStatus()\r\n  }\r\n\r\n  async loadWad(name: string) {\r\n    const wadItem = new LoadItemWad(name)\r\n    this.wads.push(wadItem)\r\n    this.events.emit('loadstart', wadItem)\r\n\r\n    const progressCallback: ProgressCallback = (_1, progress) => {\r\n      wadItem.progress = progress\r\n      this.events.emit('progress', wadItem)\r\n    }\r\n\r\n    const wadsPath = this.config.getWadsPath()\r\n    const buffer = await xhr(`${wadsPath}/${name}`, {\r\n      method: 'GET',\r\n      isBinary: true,\r\n      progressCallback\r\n    }).catch((err: any) => {\r\n      wadItem.error()\r\n      this.events.emit('error', err, wadItem)\r\n      this.checkStatus()\r\n    })\r\n\r\n    if (wadItem.isError()) {\r\n      return\r\n    }\r\n\r\n    const wad = Wad.parse(buffer)\r\n    wadItem.done(wad)\r\n\r\n    if (!this.map || !this.map.data) {\r\n      return\r\n    }\r\n\r\n    const map = this.map.data\r\n    const cmp = (a: any, b: any) => a.toLowerCase() === b.toLowerCase()\r\n    for (const entry of wad.entries) {\r\n      if (entry.type !== 'texture') {\r\n        return\r\n      }\r\n\r\n      for (const texture of map.textures) {\r\n        if (cmp(entry.name, texture.name)) {\r\n          texture.width = entry.width\r\n          texture.height = entry.height\r\n          texture.data = entry.data\r\n        }\r\n      }\r\n    }\r\n\r\n    this.events.emit('load', wadItem)\r\n    this.checkStatus()\r\n  }\r\n\r\n  async loadSound(name: string, index: number) {\r\n    const sound = new LoadItemSound(name)\r\n    this.sounds.push(sound)\r\n    this.events.emit('loadstart', sound)\r\n\r\n    const progressCallback: ProgressCallback = (_1, progress) => {\r\n      sound.progress = progress\r\n      this.events.emit('progress', sound)\r\n    }\r\n\r\n    const soundsPath = this.config.getSoundsPath()\r\n    const buffer = await xhr(`${soundsPath}/${name}`, {\r\n      method: 'GET',\r\n      isBinary: true,\r\n      progressCallback\r\n    }).catch((err: any) => {\r\n      sound.error()\r\n      this.events.emit('error', err, sound)\r\n      this.checkStatus()\r\n    })\r\n\r\n    if (sound.isError()) {\r\n      return\r\n    }\r\n\r\n    const data = await Sound.create(buffer).catch((err: any) => {\r\n      sound.error()\r\n      this.events.emit('error', err, sound)\r\n      this.checkStatus()\r\n    })\r\n\r\n    if (!data || sound.isError()) {\r\n      return\r\n    }\r\n\r\n    data.index = index\r\n    data.name = name\r\n    sound.done(data)\r\n    this.events.emit('load', sound)\r\n    this.checkStatus()\r\n  }\r\n}\r\n","import { vec2 } from 'gl-matrix'\r\n\r\nexport class Mouse {\r\n  click = false\r\n  leftClick = false\r\n  rightClick = false\r\n  position = vec2.create()\r\n  delta = vec2.create()\r\n}\r\n","import { vec2 } from 'gl-matrix'\r\n\r\nexport class Touch {\r\n  pressed = false\r\n  position = vec2.create()\r\n  delta = vec2.create()\r\n}\r\n","import { glMatrix, vec3, mat4 } from 'gl-matrix'\r\n\r\nexport class Camera {\r\n  static init(aspect: number) {\r\n    return new Camera(aspect)\r\n  }\r\n\r\n  projectionMatrix: mat4 = mat4.create()\r\n  aspect: number\r\n  fov: number = glMatrix.toRadian(60)\r\n  near = 1.0\r\n  far = 8192.0\r\n\r\n  viewMatrix: mat4 = mat4.create()\r\n  position = vec3.create()\r\n  rotation = vec3.create()\r\n\r\n  private constructor(aspect: number) {\r\n    this.aspect = aspect\r\n    this.updateProjectionMatrix()\r\n  }\r\n\r\n  updateProjectionMatrix() {\r\n    mat4.perspective(\r\n      this.projectionMatrix,\r\n      this.fov,\r\n      this.aspect,\r\n      this.near,\r\n      this.far\r\n    )\r\n  }\r\n\r\n  updateViewMatrix() {\r\n    mat4.identity(this.viewMatrix)\r\n    mat4.rotateX(\r\n      this.viewMatrix,\r\n      this.viewMatrix,\r\n      this.rotation[0] - Math.PI / 2\r\n    )\r\n    mat4.rotateZ(\r\n      this.viewMatrix,\r\n      this.viewMatrix,\r\n      Math.PI / 2 - this.rotation[1]\r\n    )\r\n    mat4.translate(this.viewMatrix, this.viewMatrix, [\r\n      -this.position[0],\r\n      -this.position[1],\r\n      -this.position[2]\r\n    ])\r\n  }\r\n}\r\n","export class Keyboard {\r\n  keys: Uint8Array\r\n\r\n  constructor() {\r\n    this.keys = new Uint8Array(256)\r\n    for (let i = 0; i < 256; ++i) {\r\n      this.keys[0] = 0\r\n    }\r\n  }\r\n}\r\n\r\nexport namespace Keyboard {\r\n  export enum KEYS {\r\n    A = 65,\r\n    B = 66,\r\n    C = 67,\r\n    D = 68,\r\n    E = 69,\r\n    F = 70,\r\n    G = 71,\r\n    H = 72,\r\n    I = 73,\r\n    J = 74,\r\n    K = 75,\r\n    L = 76,\r\n    M = 77,\r\n    N = 78,\r\n    O = 79,\r\n    P = 80,\r\n    Q = 81,\r\n    R = 82,\r\n    S = 83,\r\n    T = 84,\r\n    U = 85,\r\n    V = 86,\r\n    W = 87,\r\n    X = 88,\r\n    Y = 89,\r\n    Z = 90,\r\n    CTRL = 17,\r\n    ALT = 18,\r\n    SPACE = 32\r\n  }\r\n}\r\n","export interface Program {\r\n  handle: WebGLProgram\r\n  attributes: { [name: string]: number }\r\n  uniforms: { [name: string]: WebGLUniformLocation }\r\n}\r\n\r\nexport enum ShaderType {\r\n  VERTEX = 0,\r\n  FRAGMENT = 1\r\n}\r\n\r\nexport class Context {\r\n  public static init(canvas: HTMLCanvasElement) {\r\n    const gl = canvas.getContext('webgl', {\r\n      alpha: false\r\n    })\r\n    if (!gl) {\r\n      console.error('Failed to get WebGL context')\r\n      return null\r\n    }\r\n    return new Context(gl)\r\n  }\r\n\r\n  public static checkWebGLSupport() {\r\n    const MESSAGES = {\r\n      BAD_BROWSER: 'Your browser does not seem to support WebGL',\r\n      BAD_GPU: 'Your graphics card does not seem to support WebGL'\r\n    }\r\n\r\n    if (!window.WebGLRenderingContext) {\r\n      return {\r\n        hasSupport: false,\r\n        message: MESSAGES.BAD_BROWSER\r\n      }\r\n    }\r\n\r\n    const c = document.createElement('canvas')\r\n    try {\r\n      const ctx = c.getContext('webgl') || c.getContext('experimental-webgl')\r\n      if (ctx) {\r\n        return {\r\n          hasSupport: true,\r\n          message: ''\r\n        }\r\n      }\r\n      return {\r\n        hasSupport: false,\r\n        message: MESSAGES.BAD_GPU\r\n      }\r\n    } catch (e) {\r\n      return {\r\n        hasSupport: false,\r\n        message: MESSAGES.BAD_GPU\r\n      }\r\n    }\r\n  }\r\n\r\n  readonly gl: WebGLRenderingContext\r\n\r\n  private constructor(gl: WebGLRenderingContext) {\r\n    this.gl = gl\r\n  }\r\n\r\n  createProgram(params: {\r\n    vertexShaderSrc: string\r\n    fragmentShaderSrc: string\r\n    attributeNames: string[]\r\n    uniformNames: string[]\r\n  }): Program | null {\r\n    const gl = this.gl\r\n    const program = gl.createProgram()\r\n    if (!program) {\r\n      console.error('Failed to create WebGL program')\r\n      return null\r\n    }\r\n\r\n    const vertexShader = this.createShader({\r\n      source: params.vertexShaderSrc,\r\n      type: ShaderType.VERTEX\r\n    })\r\n    if (!vertexShader) {\r\n      console.error('Failed to compile vertex shader')\r\n      return null\r\n    }\r\n    const fragmentShader = this.createShader({\r\n      source: params.fragmentShaderSrc,\r\n      type: ShaderType.FRAGMENT\r\n    })\r\n    if (!fragmentShader) {\r\n      console.error('Failed to compile fragment shader')\r\n      return null\r\n    }\r\n\r\n    gl.attachShader(program, vertexShader)\r\n    gl.attachShader(program, fragmentShader)\r\n    gl.linkProgram(program)\r\n    gl.validateProgram(program)\r\n\r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n      gl.deleteProgram(program)\r\n      gl.deleteShader(vertexShader)\r\n      gl.deleteShader(fragmentShader)\r\n\r\n      const reason = gl.getProgramInfoLog(program)\r\n      console.error(`Could not initialize shader: ${reason}`)\r\n      return null\r\n    }\r\n\r\n    if (!gl.getProgramParameter(program, gl.VALIDATE_STATUS)) {\r\n      gl.deleteProgram(program)\r\n      gl.deleteShader(vertexShader)\r\n      gl.deleteShader(fragmentShader)\r\n\r\n      const reason = gl.getProgramInfoLog(program)\r\n      console.error(`Could not initialize shader: ${reason}`)\r\n      return null\r\n    }\r\n\r\n    gl.useProgram(program)\r\n\r\n    const attributes: { [name: string]: number } = {}\r\n    for (let i = 0; i < params.attributeNames.length; ++i) {\r\n      const name = params.attributeNames[i]\r\n      const attr = gl.getAttribLocation(program, name)\r\n      if (attr === -1) {\r\n        console.error(`gl.getAttribLocation failed for attrib named \"${name}\"`)\r\n        gl.deleteProgram(program)\r\n        return null\r\n      }\r\n      attributes[name] = attr\r\n    }\r\n\r\n    const uniforms: { [name: string]: WebGLUniformLocation } = {}\r\n    for (let i = 0; i < params.uniformNames.length; ++i) {\r\n      const name = params.uniformNames[i]\r\n      const uniform = gl.getUniformLocation(program, name)\r\n      if (uniform === null) {\r\n        console.error(`gl.getUniformLocation failed for uniform named \"${name}\"`)\r\n        gl.deleteProgram(program)\r\n        return null\r\n      }\r\n      uniforms[name] = uniform\r\n    }\r\n\r\n    return {\r\n      handle: program,\r\n      attributes,\r\n      uniforms\r\n    }\r\n  }\r\n\r\n  createShader(params: { source: string; type: ShaderType }) {\r\n    const gl = this.gl\r\n    const shader =\r\n      params.type === ShaderType.VERTEX ? gl.createShader(gl.VERTEX_SHADER) : gl.createShader(gl.FRAGMENT_SHADER)\r\n    if (!shader) {\r\n      console.error('Failed to create shader program')\r\n      return null\r\n    }\r\n    gl.shaderSource(shader, params.source)\r\n    gl.compileShader(shader)\r\n\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      console.error(gl.getShaderInfoLog(shader))\r\n      gl.deleteShader(shader)\r\n      return null\r\n    }\r\n\r\n    return shader\r\n  }\r\n\r\n  getAnisotropyExtension(): EXT_texture_filter_anisotropic | null {\r\n    return (\r\n      this.gl.getExtension('EXT_texture_filter_anisotropic') ||\r\n      this.gl.getExtension('MOZ_EXT_texture_filter_anisotropic') ||\r\n      this.gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')\r\n    )\r\n  }\r\n\r\n  getMaxAnisotropy(extension: EXT_texture_filter_anisotropic) {\r\n    return this.gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)\r\n  }\r\n}\r\n","import { glMatrix } from 'gl-matrix'\r\nimport { createNanoEvents, type Emitter as EventEmitter } from 'nanoevents'\r\nimport type { Game } from './Game'\r\nimport { Replay } from './Replay/Replay'\r\nimport { ReplayState } from './Replay/ReplayState'\r\n\r\nconst updateGame = (game: Game, state: ReplayState) => {\r\n  game.camera.position[0] = state.cameraPos[0]\r\n  game.camera.position[1] = state.cameraPos[1]\r\n  game.camera.position[2] = state.cameraPos[2]\r\n  game.camera.rotation[0] = glMatrix.toRadian(state.cameraRot[0])\r\n  game.camera.rotation[1] = glMatrix.toRadian(state.cameraRot[1])\r\n  game.camera.rotation[2] = glMatrix.toRadian(state.cameraRot[2])\r\n}\r\n\r\nexport class ReplayPlayer {\r\n  game: Game\r\n  state: ReplayState\r\n  replay: any\r\n  events: EventEmitter\r\n\r\n  currentMap = 0\r\n  currentChunk = 0\r\n  currentTime = 0\r\n  currentTick = 0\r\n  isPlaying = false\r\n  isPaused = false\r\n  speed = 1\r\n\r\n  constructor(game: Game) {\r\n    this.reset()\r\n    this.game = game\r\n    this.state = new ReplayState()\r\n    this.replay = null\r\n    this.events = createNanoEvents()\r\n  }\r\n\r\n  reset() {\r\n    this.currentMap = 0\r\n    this.currentChunk = 0\r\n    this.currentTime = 0\r\n    this.currentTick = 0\r\n\r\n    this.isPlaying = false\r\n    this.isPaused = false\r\n    this.speed = 1\r\n\r\n    if (this.replay) {\r\n      const firstChunk = this.replay.maps[0].chunks[0]\r\n      firstChunk.reader.seek(0)\r\n      this.state = firstChunk.state.clone()\r\n    }\r\n  }\r\n\r\n  changeReplay(replay: Replay) {\r\n    this.replay = replay\r\n    this.reset()\r\n  }\r\n\r\n  play() {\r\n    if (!this.isPlaying) {\r\n      this.isPlaying = true\r\n    } else if (this.isPaused) {\r\n      this.isPaused = false\r\n    }\r\n\r\n    this.events.emit('play', this.currentTime)\r\n  }\r\n\r\n  pause() {\r\n    if (this.isPlaying) {\r\n      this.isPaused = true\r\n    }\r\n\r\n    this.events.emit('pause', this.currentTime)\r\n  }\r\n\r\n  stop() {\r\n    this.reset()\r\n    this.events.emit('stop', 0)\r\n  }\r\n\r\n  speedUp() {\r\n    this.speed = Math.min(this.speed * 2, 4)\r\n  }\r\n\r\n  speedDown() {\r\n    this.speed = Math.max(this.speed / 2, 0.25)\r\n  }\r\n\r\n  seek(value: number) {\r\n    const t = Math.max(0, Math.min(this.replay.length, value))\r\n\r\n    const maps = this.replay.maps\r\n    for (let i = 0; i < maps.length; ++i) {\r\n      const chunks = maps[i].chunks\r\n      for (let j = 0; j < chunks.length; ++j) {\r\n        const chunk = chunks[j]\r\n        const startTime = chunk.startTime\r\n        const timeLimit = startTime + chunk.timeLength\r\n        if (t >= startTime && t < timeLimit) {\r\n          this.currentMap = i\r\n          this.currentChunk = j\r\n          this.currentTime = t\r\n\r\n          this.state = chunk.state.clone()\r\n          const deltaDecoders = this.replay.deltaDecoders\r\n          const customMessages = this.replay.customMessages\r\n          const r = chunk.reader\r\n          r.seek(0)\r\n          while (true) {\r\n            const offset = r.tell()\r\n            const frame = Replay.readFrame(r, deltaDecoders, customMessages)\r\n            if (frame.time <= t) {\r\n              this.state.feedFrame(frame)\r\n              this.currentTick = frame.tick\r\n            } else {\r\n              r.seek(offset)\r\n              break\r\n            }\r\n          }\r\n\r\n          this.events.emit('seek', t)\r\n          updateGame(this.game, this.state)\r\n\r\n          return\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  seekByPercent(value: number) {\r\n    this.seek((Math.max(0, Math.min(value, 100)) / 100) * this.replay.length)\r\n  }\r\n\r\n  update(dt: number) {\r\n    if (!this.isPlaying || this.isPaused) {\r\n      return\r\n    }\r\n\r\n    const deltaDecoders = this.replay.deltaDecoders\r\n    const customMessages = this.replay.customMessages\r\n\r\n    let map = this.replay.maps[this.currentMap]\r\n    let chunk = map.chunks[this.currentChunk]\r\n    let r = chunk.reader\r\n\r\n    const endTime = this.currentTime + dt * this.speed\r\n\r\n    let hitStop = false\r\n\r\n    while (true) {\r\n      let offset = r.tell()\r\n      if (offset >= chunk.data.length) {\r\n        if (this.currentChunk === map.chunks.length - 1) {\r\n          if (this.currentMap === this.replay.maps.length - 1) {\r\n            hitStop = true\r\n            break\r\n          }\r\n          this.currentChunk = 0\r\n          this.currentMap++\r\n          map = this.replay.maps[this.currentMap]\r\n          chunk = map.chunks[this.currentChunk]\r\n        } else {\r\n          this.currentChunk++\r\n          chunk = map.chunks[this.currentChunk]\r\n        }\r\n\r\n        r = chunk.reader\r\n        r.seek(0)\r\n        offset = 0\r\n\r\n        continue\r\n      }\r\n\r\n      const sounds: any[] = this.game.sounds\r\n      const frame: any = Replay.readFrame(r, deltaDecoders, customMessages)\r\n      if (frame.type < 2) {\r\n        for (let i = 0; i < frame.data.length; ++i) {\r\n          const message = frame.data[i]\r\n          if (message.type === 6) {\r\n            // TODO: Magic number SVC_SOUND\r\n            const msgSound = message.data\r\n            const sound = sounds.find((s: any) => s.index === msgSound.soundIndex)\r\n            if (sound && sound.name !== 'common/null.wav') {\r\n              const channel = msgSound.channel\r\n              const volume = msgSound.volume\r\n              // TODO: Positional audio\r\n              this.game.soundSystem.play(sound, channel, volume)\r\n            }\r\n          } else if (message.type === 29) {\r\n            // TODO: Magic number\r\n            const msgSound = message.data\r\n            const sound = sounds.find((s: any) => s.index === msgSound.soundIndex)\r\n            if (sound && sound.name !== 'common/null.wav') {\r\n              // TODO: Use after implementing positional audio\r\n              // let volume = msgSound.volume\r\n              // this.game.soundSystem.play(sound, 6, volume)\r\n            }\r\n          } else if (message.type === 9) {\r\n            for (const command of message.data.commands) {\r\n              switch (command.func) {\r\n                case 'speak':\r\n                case 'spk':\r\n                case 'play': {\r\n                  const soundName = `${command.params[0]}.wav`\r\n                  const sound = sounds.find((s: any) => s.name === soundName)\r\n                  if (!sound) {\r\n                    return\r\n                  }\r\n\r\n                  this.game.soundSystem.play(sound, 1, 0.7)\r\n                  break\r\n                }\r\n                case 'playvol': {\r\n                  const soundName = `${command.params[0]}.wav`\r\n                  let volume: number\r\n                  if (Number.isNaN(command.params[1])) {\r\n                    volume = 1\r\n                  } else {\r\n                    volume = Number.parseFloat(command.params[1])\r\n                  }\r\n                  const sound = sounds.find((s: any) => s.name === soundName)\r\n                  if (!sound) {\r\n                    return\r\n                  }\r\n\r\n                  this.game.soundSystem.play(sound, 1, volume)\r\n                  break\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else if (frame.type === 8) {\r\n        const sample = frame.sound.sample\r\n        const sound = sounds.find((s) => s.name === sample)\r\n        if (sound && sound.name !== 'common/null.wav') {\r\n          const channel = frame.sound.channel\r\n          const volume = frame.sound.volume\r\n          this.game.soundSystem.play(sound, channel, volume)\r\n        }\r\n      }\r\n      if (frame.time <= endTime) {\r\n        this.state.feedFrame(frame)\r\n        this.currentTick = frame.tick\r\n      } else {\r\n        r.seek(offset)\r\n        break\r\n      }\r\n    }\r\n\r\n    updateGame(this.game, this.state)\r\n\r\n    this.currentTime = endTime\r\n\r\n    if (hitStop) {\r\n      this.stop()\r\n    }\r\n  }\r\n}\r\n","import type { Context } from './Context'\r\n\r\nexport class Renderer {\r\n  static init(context: Context): Renderer | null {\r\n    const gl = context.gl\r\n\r\n    gl.clearColor(0.0, 0.0, 0.0, 1.0)\r\n    gl.clearDepth(1.0)\r\n    gl.enable(gl.DEPTH_TEST)\r\n    gl.depthFunc(gl.LEQUAL)\r\n\r\n    gl.enable(gl.BLEND)\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n\r\n    gl.enable(gl.CULL_FACE)\r\n    gl.cullFace(gl.FRONT)\r\n\r\n    return new Renderer({ context })\r\n  }\r\n\r\n  private context: Context\r\n\r\n  private constructor(params: { context: Context }) {\r\n    this.context = params.context\r\n  }\r\n\r\n  draw = () => {\r\n    const gl = this.context.gl\r\n\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\r\n  }\r\n}\r\n","import type { mat4 } from 'gl-matrix'\r\nimport type { Context, Program } from '../Context'\r\n\r\nconst fragmentSrc = `#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D diffuse;\r\n\r\nvarying vec2 vTexCoord;\r\n\r\nvoid main(void) {\r\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\r\n  gl_FragColor = vec4(diffuseColor.rgb, 1.0);\r\n}`\r\n\r\nconst vertexSrc = `#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nattribute vec3 position;\r\nattribute vec2 texCoord;\r\n\r\nvarying vec2 vTexCoord;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvoid main(void) {\r\n  vTexCoord = texCoord;\r\n  gl_Position = projectionMatrix * viewMatrix * vec4(position, 1);\r\n}`\r\n\r\nexport class SkyShader {\r\n  static init(context: Context): SkyShader | null {\r\n    const attributeNames = ['position', 'texCoord']\r\n    const uniformNames: string[] = ['viewMatrix', 'projectionMatrix', 'diffuse']\r\n    const program = context.createProgram({\r\n      vertexShaderSrc: vertexSrc,\r\n      fragmentShaderSrc: fragmentSrc,\r\n      attributeNames,\r\n      uniformNames\r\n    })\r\n    if (!program) {\r\n      console.error('Failed to create sky shader program')\r\n      return null\r\n    }\r\n\r\n    return new SkyShader(program)\r\n  }\r\n\r\n  private program: WebGLProgram\r\n  private aPosition: number\r\n  private aTexCoord: number\r\n  private uViewMx: WebGLUniformLocation\r\n  private uProjectionMx: WebGLUniformLocation\r\n  private uDiffuse: WebGLUniformLocation\r\n\r\n  private constructor(program: Program) {\r\n    this.program = program.handle\r\n    this.aPosition = program.attributes.position\r\n    this.aTexCoord = program.attributes.texCoord\r\n    this.uViewMx = program.uniforms.viewMatrix\r\n    this.uProjectionMx = program.uniforms.projectionMatrix\r\n    this.uDiffuse = program.uniforms.diffuse\r\n  }\r\n\r\n  useProgram(gl: WebGLRenderingContext) {\r\n    gl.useProgram(this.program)\r\n  }\r\n\r\n  setViewMatrix(gl: WebGLRenderingContext, matrix: mat4) {\r\n    gl.uniformMatrix4fv(this.uViewMx, false, matrix)\r\n  }\r\n\r\n  setProjectionMatrix(gl: WebGLRenderingContext, matrix: mat4) {\r\n    gl.uniformMatrix4fv(this.uProjectionMx, false, matrix)\r\n  }\r\n\r\n  setDiffuse(gl: WebGLRenderingContext, value: number) {\r\n    gl.uniform1i(this.uDiffuse, value)\r\n  }\r\n\r\n  enableVertexAttribs(gl: WebGLRenderingContext) {\r\n    gl.enableVertexAttribArray(this.aPosition)\r\n    gl.enableVertexAttribArray(this.aTexCoord)\r\n  }\r\n\r\n  setVertexAttribPointers(gl: WebGLRenderingContext) {\r\n    gl.vertexAttribPointer(this.aPosition, 3, gl.FLOAT, false, 5 * 4, 0)\r\n    gl.vertexAttribPointer(this.aTexCoord, 2, gl.FLOAT, false, 5 * 4, 3 * 4)\r\n  }\r\n}\r\n","import type { Bsp } from '../Bsp'\r\nimport type { Camera } from './Camera'\r\nimport type { Context } from './Context'\r\nimport { SkyShader } from './SkyShader/SkyShader'\r\n\r\nexport class SkyScene {\r\n  static init(context: Context): SkyScene | null {\r\n    const shader = SkyShader.init(context)\r\n    if (!shader) {\r\n      console.error(\"skyscenen't\")\r\n      return null\r\n    }\r\n\r\n    return new SkyScene({ context, shader })\r\n  }\r\n\r\n  private context: Context\r\n  private shader: SkyShader\r\n  private vertexBuffer: WebGLBuffer | null = null\r\n  private indexBuffer: WebGLBuffer | null = null\r\n  private texture: WebGLTexture | null = null\r\n  private isReady = false\r\n\r\n  private constructor(params: { context: Context; shader: SkyShader }) {\r\n    this.context = params.context\r\n    this.shader = params.shader\r\n  }\r\n\r\n  changeMap(bsp: Bsp) {\r\n    if (bsp.skies.length !== 6) {\r\n      this.isReady = false\r\n      return\r\n    }\r\n\r\n    const gl = this.context.gl\r\n    const vertexBuffer = gl.createBuffer()\r\n    const indexBuffer = gl.createBuffer()\r\n    const texture = gl.createTexture()\r\n    if (!vertexBuffer || !indexBuffer || !texture) {\r\n      // TODO\r\n      throw new Error('shouldnt happen')\r\n    }\r\n\r\n    // prettier-ignore\r\n    const indices = new Uint8Array([\r\n      0,  1,  2,      0,  2,  3,    // front\r\n      4,  5,  6,      4,  6,  7,    // back\r\n      8,  9,  10,     8,  10, 11,   // top\r\n      12, 13, 14,     12, 14, 15,   // bottom\r\n      16, 17, 18,     16, 18, 19,   // right\r\n      20, 21, 22,     20, 22, 23,   // left\r\n    ])\r\n    // prettier-ignore\r\n    const vertices = new Float32Array([\r\n      // Top face\r\n      -1.0, -1.0,  1.0, 0.499, 0.001,\r\n       1.0, -1.0,  1.0, 0.499, 0.249,\r\n       1.0,  1.0,  1.0, 0.001, 0.249,\r\n      -1.0,  1.0,  1.0, 0.001, 0.001,\r\n\r\n      // Bottom face\r\n      -1.0, -1.0, -1.0, 0.499, 0.749,\r\n      -1.0,  1.0, -1.0, 0.001, 0.749,\r\n       1.0,  1.0, -1.0, 0.001, 0.501,\r\n       1.0, -1.0, -1.0, 0.499, 0.501,\r\n\r\n      // Front face\r\n      -1.0,  1.0, -1.0, 0.501, 0.749,\r\n      -1.0,  1.0,  1.0, 0.501, 0.501,\r\n       1.0,  1.0,  1.0, 0.999, 0.501,\r\n       1.0,  1.0, -1.0, 0.999, 0.749,\r\n\r\n      // Back face\r\n      -1.0, -1.0, -1.0, 0.999, 0.249,\r\n       1.0, -1.0, -1.0, 0.501, 0.249,\r\n       1.0, -1.0,  1.0, 0.501, 0.001,\r\n      -1.0, -1.0,  1.0, 0.999, 0.001,\r\n\r\n      // Right face\r\n       1.0, -1.0, -1.0, 0.499, 0.499,\r\n       1.0,  1.0, -1.0, 0.001, 0.499,\r\n       1.0,  1.0,  1.0, 0.001, 0.251,\r\n       1.0, -1.0,  1.0, 0.499, 0.251,\r\n\r\n      // Left face\r\n      -1.0, -1.0, -1.0, 0.501, 0.499,\r\n      -1.0, -1.0,  1.0, 0.501, 0.251,\r\n      -1.0,  1.0,  1.0, 0.999, 0.251,\r\n      -1.0,  1.0, -1.0, 0.999, 0.499\r\n    ].map((a, i) => ((i % 5) < 3) ? a * 4096 : a))\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW)\r\n    gl.enableVertexAttribArray(0)\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer)\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW)\r\n\r\n    const canvas = document.createElement('canvas')\r\n    canvas.width = 512\r\n    canvas.height = 1024\r\n    const ctx = canvas.getContext('2d')\r\n    if (!ctx) {\r\n      throw new Error('sky ctx fail')\r\n    }\r\n\r\n    const coords: { [name: string]: number[] } = {\r\n      up: [0, 0],\r\n      rt: [0, 256],\r\n      dn: [0, 512],\r\n      ft: [256, 0],\r\n      lf: [256, 256],\r\n      bk: [256, 512]\r\n    }\r\n\r\n    for (const sky of bsp.skies) {\r\n      const smc = document.createElement('canvas')\r\n      const smctx = smc.getContext('2d')\r\n      if (!smctx) {\r\n        throw new Error('Runtime error.')\r\n      }\r\n      smc.width = sky.width\r\n      smc.height = sky.height\r\n      const imageData = smctx.getImageData(0, 0, smc.width, smc.height)\r\n      for (let i = 0; i < sky.data.length; ++i) {\r\n        imageData.data[i] = sky.data[i]\r\n      }\r\n      smctx.putImageData(imageData, 0, 0)\r\n\r\n      const side = sky.name.slice(-2)\r\n      const c = coords[side] ? coords[side] : []\r\n\r\n      // TODO: remove this check\r\n      if (!ctx) {\r\n        throw new Error('Runtime error.')\r\n      }\r\n      ctx.drawImage(smc, c[0], c[1])\r\n    }\r\n\r\n    const pixelData = ctx.getImageData(0, 0, 512, 1024).data\r\n    gl.bindTexture(gl.TEXTURE_2D, texture)\r\n    gl.texImage2D(\r\n      gl.TEXTURE_2D,\r\n      0,\r\n      gl.RGBA,\r\n      512,\r\n      1024,\r\n      0,\r\n      gl.RGBA,\r\n      gl.UNSIGNED_BYTE,\r\n      new Uint8Array(pixelData)\r\n    )\r\n    gl.generateMipmap(gl.TEXTURE_2D)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\r\n    gl.texParameteri(\r\n      gl.TEXTURE_2D,\r\n      gl.TEXTURE_MIN_FILTER,\r\n      gl.LINEAR_MIPMAP_LINEAR\r\n    )\r\n    gl.texParameterf(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n    const anisotropy = this.context.getAnisotropyExtension()\r\n    if (anisotropy) {\r\n      gl.texParameteri(\r\n        gl.TEXTURE_2D,\r\n        anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\r\n        this.context.getMaxAnisotropy(anisotropy)\r\n      )\r\n    }\r\n\r\n    this.vertexBuffer = vertexBuffer\r\n    this.indexBuffer = indexBuffer\r\n    this.texture = texture\r\n    this.isReady = true\r\n  }\r\n\r\n  draw(camera: Camera) {\r\n    if (!this.isReady) {\r\n      return\r\n    }\r\n\r\n    const gl = this.context.gl\r\n    const shader = this.shader\r\n\r\n    shader.useProgram(gl)\r\n    gl.bindTexture(gl.TEXTURE_2D, this.texture)\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer)\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer)\r\n    shader.enableVertexAttribs(gl)\r\n    shader.setVertexAttribPointers(gl)\r\n    shader.setDiffuse(gl, 0)\r\n\r\n    const x = camera.position[0]\r\n    const y = camera.position[1]\r\n    const z = camera.position[2]\r\n    camera.position[0] = 0\r\n    camera.position[1] = 0\r\n    camera.position[2] = 0\r\n    camera.updateViewMatrix()\r\n    camera.position[0] = x\r\n    camera.position[1] = y\r\n    camera.position[2] = z\r\n\r\n    shader.setViewMatrix(gl, camera.viewMatrix)\r\n    shader.setProjectionMatrix(gl, camera.projectionMatrix)\r\n\r\n    gl.drawElements(gl.TRIANGLES, 36, gl.UNSIGNED_BYTE, 0)\r\n    gl.clear(gl.DEPTH_BUFFER_BIT)\r\n  }\r\n}\r\n","import type { mat4 } from 'gl-matrix'\r\nimport type { Context, Program } from '../Context'\r\n\r\nconst fragmentSrc = `#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D diffuse;\r\nuniform sampler2D lightmap;\r\nuniform float opacity;\r\n\r\nvarying vec2 vTexCoord;\r\nvarying vec2 vLightmapCoord;\r\n\r\nvoid main(void) {\r\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\r\n  vec4 lightColor = texture2D(lightmap, vLightmapCoord);\r\n\r\n  gl_FragColor = vec4(diffuseColor.rgb * lightColor.rgb, diffuseColor.a * opacity);\r\n}`\r\n\r\nconst vertexSrc = `#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nattribute vec3 position;\r\nattribute vec2 texCoord;\r\nattribute vec2 texCoord2;\r\n\r\nvarying vec2 vTexCoord;\r\nvarying vec2 vLightmapCoord;\r\n\r\nuniform mat4 modelMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvoid main(void) {\r\n  vTexCoord = texCoord;\r\n  vLightmapCoord = texCoord2;\r\n\r\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1);\r\n}`\r\n\r\nexport class MainShader {\r\n  static init(context: Context): MainShader | null {\r\n    const attributeNames = ['position', 'texCoord', 'texCoord2']\r\n    const uniformNames: string[] = [\r\n      'modelMatrix',\r\n      'viewMatrix',\r\n      'projectionMatrix',\r\n      'diffuse',\r\n      'lightmap',\r\n      'opacity'\r\n    ]\r\n    const program = context.createProgram({\r\n      vertexShaderSrc: vertexSrc,\r\n      fragmentShaderSrc: fragmentSrc,\r\n      attributeNames,\r\n      uniformNames\r\n    })\r\n    if (!program) {\r\n      console.error('Failed to create MainShader program')\r\n      return null\r\n    }\r\n\r\n    return new MainShader(program)\r\n  }\r\n\r\n  private program: WebGLProgram\r\n  private aPosition: number\r\n  private aTexCoord: number\r\n  private aTexCoord2: number\r\n  private uModelMx: WebGLUniformLocation\r\n  private uViewMx: WebGLUniformLocation\r\n  private uProjectionMx: WebGLUniformLocation\r\n  private uDiffuse: WebGLUniformLocation\r\n  private uLightmap: WebGLUniformLocation\r\n  private uOpacity: WebGLUniformLocation\r\n\r\n  private constructor(program: Program) {\r\n    this.program = program.handle\r\n    this.aPosition = program.attributes.position\r\n    this.aTexCoord = program.attributes.texCoord\r\n    this.aTexCoord2 = program.attributes.texCoord2\r\n    this.uModelMx = program.uniforms.modelMatrix\r\n    this.uViewMx = program.uniforms.viewMatrix\r\n    this.uProjectionMx = program.uniforms.projectionMatrix\r\n    this.uDiffuse = program.uniforms.diffuse\r\n    this.uLightmap = program.uniforms.lightmap\r\n    this.uOpacity = program.uniforms.opacity\r\n  }\r\n\r\n  useProgram(gl: WebGLRenderingContext) {\r\n    gl.useProgram(this.program)\r\n  }\r\n\r\n  setModelMatrix(gl: WebGLRenderingContext, matrix: mat4) {\r\n    gl.uniformMatrix4fv(this.uModelMx, false, matrix)\r\n  }\r\n\r\n  setViewMatrix(gl: WebGLRenderingContext, matrix: mat4) {\r\n    gl.uniformMatrix4fv(this.uViewMx, false, matrix)\r\n  }\r\n\r\n  setProjectionMatrix(gl: WebGLRenderingContext, matrix: mat4) {\r\n    gl.uniformMatrix4fv(this.uProjectionMx, false, matrix)\r\n  }\r\n\r\n  setDiffuse(gl: WebGLRenderingContext, value: number) {\r\n    gl.uniform1i(this.uDiffuse, value)\r\n  }\r\n\r\n  setLightmap(gl: WebGLRenderingContext, val: number) {\r\n    gl.uniform1i(this.uLightmap, val)\r\n  }\r\n\r\n  setOpacity(gl: WebGLRenderingContext, val: number) {\r\n    gl.uniform1f(this.uOpacity, val)\r\n  }\r\n\r\n  enableVertexAttribs(gl: WebGLRenderingContext) {\r\n    gl.enableVertexAttribArray(this.aPosition)\r\n    gl.enableVertexAttribArray(this.aTexCoord)\r\n    gl.enableVertexAttribArray(this.aTexCoord2)\r\n  }\r\n\r\n  setVertexAttribPointers(gl: WebGLRenderingContext) {\r\n    gl.vertexAttribPointer(this.aPosition, 3, gl.FLOAT, false, 7 * 4, 0)\r\n    gl.vertexAttribPointer(this.aTexCoord, 2, gl.FLOAT, false, 7 * 4, 3 * 4)\r\n    gl.vertexAttribPointer(this.aTexCoord2, 2, gl.FLOAT, false, 7 * 4, 5 * 4)\r\n  }\r\n}\r\n","export interface WorldSpawn {\r\n  classname: 'worldspawn'\r\n  wad: string[]\r\n  mapversion: number\r\n  skyname: string\r\n  maxRange: number\r\n  message: string\r\n  sounds: number\r\n  light: number\r\n  waveHeight: number\r\n  startDark: WorldSpawnStartDark\r\n  newUnit: WorldSpawnNewUnit\r\n  gameTitle: WorldSpawnGameTitle\r\n  defaultTeam: WorldSpawnDefaultTeam\r\n}\r\nexport enum WorldSpawnStartDark {\r\n  No = 0,\r\n  Yes = 1 // the level will start black with fade in\r\n}\r\nexport enum WorldSpawnGameTitle {\r\n  No = 0,\r\n  Yes = 1 // \"Half-Life\" will be displayed after the map loads\r\n}\r\nexport enum WorldSpawnNewUnit {\r\n  No = 0,\r\n  Yes = 1 // All previous global triggers will be removed\r\n}\r\nexport enum WorldSpawnDefaultTeam {\r\n  FewestPlayers = 0,\r\n  FirstTeam = 1\r\n}\r\n\r\nexport interface AiScriptedSequence {\r\n  classname: 'aiscripted_sequence'\r\n  m_iszEntity: string\r\n  m_iszPlay: string\r\n  m_flRadius: number\r\n  m_flRepeat: number\r\n  m_fMoveTo: AiScriptedSequenceMoveTo\r\n  m_iFinishSchedule: AiScriptedSequenceFinishSchedule\r\n  spawnflags: AiScriptedSequenceSpawnflags\r\n}\r\nexport enum AiScriptedSequenceMoveTo {\r\n  No = 0,\r\n  Walk = 1,\r\n  Run = 2,\r\n  Instantaneous = 4,\r\n  No_TurnToFace = 5\r\n}\r\nexport enum AiScriptedSequenceFinishSchedule {\r\n  DefaultAI = 0,\r\n  Ambush = 1\r\n}\r\nexport enum AiScriptedSequenceSpawnflags {\r\n  Repeatable = 4,\r\n  LeaveCorpse = 8\r\n}\r\n\r\nexport interface AmbientGeneric {\r\n  classname: 'ambient_generic'\r\n  origin: number[]\r\n  targetName: string\r\n  message: string\r\n  health: number\r\n  preset: AmbientGenericPreset\r\n  startVolume: number\r\n  fadeIn: number\r\n  fadeOut: number\r\n  pitch: number\r\n  pitchStart: number\r\n  spinUp: number\r\n  spinDown: number\r\n  lfoType: number\r\n  lfoRate: number\r\n  lfoModPitch: number\r\n  lfoModVolume: number\r\n  cSpinUp: number\r\n  spawnFlags: AmbientGenericSpawnFlags\r\n}\r\nexport enum AmbientGenericPreset {\r\n  None = 0,\r\n  HugeMachine = 1,\r\n  BigMachine = 2,\r\n  Machine = 3,\r\n  SlowFadeIn = 4,\r\n  FadeIn = 5,\r\n  QuickFadeIn = 6,\r\n  SlowPulse = 7,\r\n  Pulse = 8,\r\n  QuickPulse = 9,\r\n  SlowOscillator = 10,\r\n  Oscillator = 11,\r\n  QuickOscillator = 12,\r\n  GrungePitch = 13,\r\n  VeryLowPitch = 14,\r\n  LowPitch = 15,\r\n  HighPitch = 16,\r\n  VeryHighPitch = 17,\r\n  ScreamingPitch = 18,\r\n  OscillateSpinUpDown = 19,\r\n  PulseSpinUpDown = 20,\r\n  RandomPitch = 21,\r\n  RandomPitchFast = 22,\r\n  IncrementalSpinup = 23,\r\n  Alien = 24,\r\n  Bizzare = 25,\r\n  PlanetX = 26,\r\n  Haunted = 27\r\n}\r\nexport enum AmbientGenericSpawnFlags {\r\n  PlayEverywhere = 1,\r\n  SmallRadius = 2,\r\n  MediumRadius = 4,\r\n  LargeRadius = 8,\r\n  StartSilent = 16,\r\n  NotToggled = 32\r\n}\r\n\r\nexport interface Ammo357 {\r\n  classname: 'ammo_357'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface Ammo9mmAR {\r\n  classname: 'ammo_9mmAR'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface Ammo9mmBox {\r\n  classname: 'ammo_9mmbox'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface Ammo9mmClip {\r\n  classname: 'ammo_9mmclip'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface AmmoARGrenades {\r\n  classname: 'ammo_ARgrenades'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface AmmoBuckShot {\r\n  classname: 'ammo_buckshot'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface AmmoCrossBox {\r\n  classname: 'ammo_crossbow'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface AmmoGaussClip {\r\n  classname: 'ammo_gaussclip'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface AmmoRPGClip {\r\n  classname: 'ammo_rpgclip'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  delay: number\r\n  killTarget: string\r\n  spawnFlags: number\r\n}\r\n\r\nexport interface ButtonTarget {\r\n  classname: 'button_target'\r\n  target: string\r\n  master: string\r\n  renderEffect: RenderEffect\r\n  renderMode: RenderMode\r\n  renderAmmount: number\r\n  renderColor: number[]\r\n  zhltLightFlags: ZHLTLightFlags\r\n  lightOrigin: string\r\n  spawnFlags: ButtonTargetSpawnFlags\r\n}\r\nexport enum ButtonTargetSpawnFlags {\r\n  UseActivates = 1,\r\n  StartOn = 2\r\n}\r\n\r\nexport interface Cycler {\r\n  classname: 'cycler'\r\n  origin: number[]\r\n  angles: number[]\r\n  targetName: string\r\n  model: string\r\n  sequence: string\r\n  renderEffect: RenderEffect\r\n  renderMode: RenderMode\r\n  renderAmmount: number\r\n  renderColor: number[]\r\n}\r\n\r\nexport interface CyclerSprite {\r\n  classname: 'cycler_sprite'\r\n  origin: number[]\r\n  angles: number[]\r\n  targetName: string\r\n  model: string\r\n  framerate: number\r\n  renderEffect: RenderEffect\r\n  renderMode: RenderMode\r\n  renderAmmount: number\r\n  renderColor: number[]\r\n}\r\n\r\nexport interface CyclerWeapon {\r\n  classname: 'cycler_weapon'\r\n  origin: number[]\r\n  angles: number[]\r\n  target: string\r\n  targetName: string\r\n  triggerTarget: string\r\n  triggerCondition: CyclerWeaponTriggerCondition\r\n  model: string\r\n  sequence: string\r\n  renderEffect: RenderEffect\r\n  renderMode: RenderMode\r\n  renderAmmount: number\r\n  renderColor: number[]\r\n}\r\n\r\nexport enum CyclerWeaponTriggerCondition {\r\n  NoTrigger = 0,\r\n  SeePlayerMadAtPlayer = 1,\r\n  TakeDamage = 2,\r\n  HalfHealthRemaining = 3,\r\n  Death = 4,\r\n  HearWorld = 7,\r\n  HearPlayer = 8,\r\n  HearCombat = 9,\r\n  SeePlayerUnconditional = 10,\r\n  SeePlayerNotInCombat = 11\r\n}\r\n\r\nexport interface CyclerWreckage {\r\n  classname: 'cycler_wreckage'\r\n  origin: number[]\r\n  angles: number[]\r\n  targetName: string\r\n  model: string\r\n  framerate: number\r\n  scale: number\r\n  renderEffect: RenderEffect\r\n  renderMode: RenderMode\r\n  renderAmmount: number\r\n  renderColor: number[]\r\n}\r\n\r\nexport interface EnvBeam {\r\n  classname: 'env_beam'\r\n  renderEffect: RenderEffect\r\n  renderMode: RenderMode\r\n  renderAmmount: number\r\n  renderColor: number[]\r\n  radius: number\r\n  life: number\r\n  boltWidth: number\r\n  noiseAmplitude: number\r\n  texture: string\r\n  textureScroll: number\r\n  frameRate: number\r\n  frameStart: number\r\n  strikeTime: number\r\n  damage: number\r\n  spawnFlags: EnvBeamSpawnFlags\r\n}\r\n\r\nexport enum EnvBeamSpawnFlags {\r\n  StartOn = 1,\r\n  Toggle = 2,\r\n  RandomStrike = 4,\r\n  Ring = 8,\r\n  StartSparks = 16,\r\n  EndSparks = 32,\r\n  DecalEnd = 64,\r\n  FadeStart = 128,\r\n  FadeEnd = 256\r\n}\r\n\r\nexport enum ZHLTLightFlags {\r\n  Normal = 0,\r\n  EmbeddedFix = 1,\r\n  OpaqueBlockLight = 2,\r\n  OpaqueEmbeddedFix = 3,\r\n  OpaqueConcaveFix = 6\r\n}\r\n\r\nexport enum RenderEffect {\r\n  Normal = 0,\r\n  SlowPulse = 1, //* Additive or Texture mode only.\r\n  FastPulse = 2, //* Additive or Texture mode only.\r\n  SlowWidePulse = 3, //* Additive or Texture mode only.\r\n  FastWidePulse = 4, //* Additive or Texture mode only.\r\n  SlowFadeAway = 5,\r\n  FastFadeAway = 6,\r\n  SlowBecomeSolid = 7,\r\n  FastBecomeSolid = 8,\r\n  SlowStrobe = 9,\r\n  FastStrobe = 10,\r\n  FasterStrobe = 11,\r\n  SlowFlicker = 12,\r\n  FastFlicker = 13,\r\n  //* Constant Glow only affects the Glow rendermode. With this setting, Glow mode behaves\r\n  //* exactly like Additive mode - except that (as is usual for Glow mode) the sprite isn't\r\n  //* obscured by intervening sprites or models.\r\n  ConstantGlow = 14,\r\n  DistortModels = 15,\r\n  HologramDistort = 16\r\n}\r\n\r\nexport enum RenderMode {\r\n  Normal = 0,\r\n  Color = 1,\r\n  Texture = 2,\r\n  Glow = 3,\r\n  Solid = 4,\r\n  Additive = 5\r\n}\r\n\r\nconst parseNumberArray = (a: string) => a.split(' ').map((b) => Number.parseFloat(b))\r\n\r\nconst parsers: {\r\n  worldspawn: (entityData: { [name: string]: any }) => WorldSpawn\r\n  aiscripted_sequence: (entityData: { [name: string]: any }) => AiScriptedSequence\r\n  ambient_generic: (entityData: { [name: string]: any }) => AmbientGeneric\r\n  ammo_357: (entityData: { [name: string]: any }) => Ammo357\r\n  ammo_9mmAR: (entityData: { [name: string]: any }) => Ammo9mmAR\r\n  ammo_9mmbox: (entityData: { [name: string]: any }) => Ammo9mmBox\r\n  ammo_9mmclip: (entityData: { [name: string]: any }) => Ammo9mmClip\r\n  ammo_ARgrenades: (entityData: { [name: string]: any }) => AmmoARGrenades\r\n  ammo_buckshot: (entityData: { [name: string]: any }) => AmmoBuckShot\r\n  ammo_crossbow: (entityData: { [name: string]: any }) => AmmoCrossBox\r\n  ammo_gaussclip: (entityData: { [name: string]: any }) => AmmoGaussClip\r\n  ammo_rpgclip: (entityData: { [name: string]: any }) => AmmoRPGClip\r\n  button_target: (entityData: { [name: string]: any }) => ButtonTarget\r\n  cycler: (entityData: { [name: string]: any }) => Cycler\r\n  cycler_sprite: (entityData: { [name: string]: any }) => CyclerSprite\r\n  cyclear_weapon: (entityData: { [name: string]: any }) => CyclerWeapon\r\n  cyclear_wreckage: (entityData: { [name: string]: any }) => CyclerWreckage\r\n  env_beam: (entityData: { [name: string]: any }) => EnvBeam\r\n} = {\r\n  worldspawn: (e) => ({\r\n    classname: 'worldspawn',\r\n    wad: e.wad\r\n      .split(';')\r\n      .filter((a: string) => a.length)\r\n      .map((w: string) => w.replace(/\\\\/g, '/')),\r\n    mapversion: Number.parseInt(e.mapversion),\r\n    skyname: e.skyname,\r\n    maxRange: Number.parseFloat(e.MaxRange) || 8192,\r\n    message: e.message || '',\r\n    sounds: Number.parseInt(e.sounds) || 0,\r\n    light: Number.parseInt(e.light) || 0,\r\n    waveHeight: Number.parseFloat(e.WaveHeight) || 0,\r\n    startDark: Number.parseInt(e.startdark) || 0,\r\n    newUnit: Number.parseInt(e.newunit) || 0,\r\n    defaultTeam: Number.parseInt(e.defaultteam) || 0,\r\n    gameTitle: Number.parseInt(e.gametitle) || 0\r\n  }),\r\n  aiscripted_sequence: (e) => ({\r\n    classname: 'aiscripted_sequence',\r\n    spawnflags: Number.parseInt(e.spawnflags),\r\n    m_iszEntity: e.m_iszEntity,\r\n    m_iszPlay: e.m_iszPlay || '',\r\n    m_flRadius: Number.parseInt(e.m_flRadius) || 512,\r\n    m_flRepeat: Number.parseInt(e.m_flRepeat) || 0,\r\n    m_fMoveTo: Number.parseInt(e.m_fMoveTo) || 0,\r\n    m_iFinishSchedule: Number.parseInt(e.m_iFinishSchedule) || 0\r\n  }),\r\n  ambient_generic: (e) => ({\r\n    classname: 'ambient_generic',\r\n    origin: parseNumberArray(e.origin),\r\n    targetName: e.targetname,\r\n    message: e.message,\r\n    health: Number.parseInt(e.health) || 10,\r\n    preset: Number.parseInt(e.preset) || 0,\r\n    startVolume: Number.parseInt(e.volstart) || 0,\r\n    fadeIn: Number.parseInt(e.fadein),\r\n    fadeOut: Number.parseInt(e.fadeout),\r\n    pitch: Number.parseInt(e.pitch),\r\n    pitchStart: Number.parseInt(e.pitchstart),\r\n    spinUp: Number.parseInt(e.spinup),\r\n    spinDown: Number.parseInt(e.spindown),\r\n    lfoType: Number.parseInt(e.lfotype),\r\n    lfoRate: Number.parseInt(e.lforate),\r\n    lfoModPitch: Number.parseInt(e.lfomodpitch),\r\n    lfoModVolume: Number.parseInt(e.lfomodvolume),\r\n    cSpinUp: Number.parseInt(e.cspinup),\r\n    spawnFlags: Number.parseInt(e.spawnflags)\r\n  }),\r\n  ammo_357: (e) => ({\r\n    classname: 'ammo_357',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_9mmAR: (e) => ({\r\n    classname: 'ammo_9mmAR',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_9mmbox: (e) => ({\r\n    classname: 'ammo_9mmbox',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_9mmclip: (e) => ({\r\n    classname: 'ammo_9mmclip',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_ARgrenades: (e) => ({\r\n    classname: 'ammo_ARgrenades',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_buckshot: (e) => ({\r\n    classname: 'ammo_buckshot',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_crossbow: (e) => ({\r\n    classname: 'ammo_crossbow',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_gaussclip: (e) => ({\r\n    classname: 'ammo_gaussclip',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  ammo_rpgclip: (e) => ({\r\n    classname: 'ammo_rpgclip',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname || '',\r\n    delay: Number.parseInt(e.delay) || 0,\r\n    killTarget: e.killtarget || '',\r\n    spawnFlags: e.spawnflags || 0\r\n  }),\r\n  button_target: (e) => ({\r\n    classname: 'button_target',\r\n    target: e.target,\r\n    master: e.master,\r\n    renderEffect: Number.parseInt(e.renderfx) || 0,\r\n    renderMode: Number.parseInt(e.rendermode) || 0,\r\n    renderAmmount: Number.parseInt(e.renderamt) || 255,\r\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0'),\r\n    zhltLightFlags: Number.parseInt(e.zhlt_lightflags) || 0,\r\n    lightOrigin: e.light_origin,\r\n    spawnFlags: Number.parseInt(e.spawnflags) || 1\r\n  }),\r\n  cycler: (e) => ({\r\n    classname: 'cycler',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    targetName: e.targetname,\r\n    model: e.model,\r\n    sequence: e.sequence || '',\r\n    renderEffect: Number.parseInt(e.renderfx) || 0,\r\n    renderMode: Number.parseInt(e.rendermode) || 0,\r\n    renderAmmount: Number.parseInt(e.renderamt) || 255,\r\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\r\n  }),\r\n  cycler_sprite: (e) => ({\r\n    classname: 'cycler_sprite',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    targetName: e.targetname,\r\n    model: e.model,\r\n    framerate: Number.parseInt(e.framerate || '10'),\r\n    renderEffect: Number.parseInt(e.renderfx) || 0,\r\n    renderMode: Number.parseInt(e.rendermode) || 0,\r\n    renderAmmount: Number.parseInt(e.renderamt) || 255,\r\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\r\n  }),\r\n  cyclear_weapon: (e) => ({\r\n    classname: 'cycler_weapon',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    target: e.target,\r\n    targetName: e.targetname,\r\n    triggerTarget: e.TriggerTarget || '',\r\n    triggerCondition: Number.parseInt(e.TriggerCondition) || 0,\r\n    model: e.model,\r\n    sequence: e.sequence,\r\n    renderEffect: Number.parseInt(e.renderfx) || 0,\r\n    renderMode: Number.parseInt(e.rendermode) || 0,\r\n    renderAmmount: Number.parseInt(e.renderamt) || 255,\r\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\r\n  }),\r\n  cyclear_wreckage: (e) => ({\r\n    classname: 'cycler_wreckage',\r\n    origin: parseNumberArray(e.origin),\r\n    angles: parseNumberArray(e.angles),\r\n    targetName: e.targetname,\r\n    model: e.model,\r\n    framerate: Number.parseInt(e.framerate) || 10,\r\n    scale: Number.parseFloat(e.scale) || 1.0,\r\n    renderEffect: Number.parseInt(e.renderfx) || 0,\r\n    renderMode: Number.parseInt(e.rendermode) || 0,\r\n    renderAmmount: Number.parseInt(e.renderamt) || 255,\r\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\r\n  }),\r\n  env_beam: (e) => ({\r\n    classname: 'env_beam',\r\n    renderEffect: Number.parseInt(e.renderfx) || 0,\r\n    renderMode: Number.parseInt(e.rendermode) || 0,\r\n    renderAmmount: Number.parseInt(e.renderamt) || 255,\r\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0'),\r\n    radius: Number.parseFloat(e.Radius) || 256,\r\n    life: Number.parseInt(e.life) || 1,\r\n    boltWidth: Number.parseInt(e.BoltWidth) || 20,\r\n    noiseAmplitude: Number.parseInt(e.NoiseAmplitude) || 0,\r\n    texture: e.texture || 'sprites/laserbeam.spr',\r\n    textureScroll: Number.parseInt(e.TextureScroll) || 35,\r\n    frameRate: Number.parseInt(e.framerate) || 0,\r\n    frameStart: Number.parseInt(e.framestart) || 0,\r\n    strikeTime: Number.parseInt(e.StrikeTime) || 1,\r\n    damage: Number.parseInt(e.damage) || 1,\r\n    spawnFlags: Number.parseInt(e.spawnflags)\r\n  })\r\n}\r\n\r\n// env_beverage (Half-Life)\r\n// env_blood (Half-Life)\r\n// env_bubbles (Half-Life)\r\n// env_explosion (Half-Life)\r\n// env_fade (Half-Life)\r\n// env_funnel (Half-Life)\r\n// env_global (Half-Life)\r\n// env_glow (Half-Life)\r\n// env_laser (Half-Life)\r\n// env_message (Half-Life)\r\n// env_render (Half-Life)\r\n// env_shake (Half-Life)\r\n// env_shooter (Half-Life)\r\n// env_sound (Half-Life)\r\n// env_spark (Half-Life)\r\n// env_sprite (Half-Life)\r\n// func_breakable (Half-Life)\r\n// func_button (Half-Life)\r\n// func_conveyor (Half-Life)\r\n// func_door (Half-Life)\r\n// func_door_rotating (Half-Life)\r\n// func_friction (Half-Life)\r\n// func_guntarget (Half-Life)\r\n// func_healthcharge (Half-Life)\r\n// func_illusionary (Half-Life)\r\n// func_ladder (Half-Life)\r\n// func_minicompo (Half-Life)\r\n// func_monsterclip (Half-Life)\r\n// func_mortar_field (Half-Life)\r\n// func_pendulum (Half-Life)\r\n// func_plat (Half-Life)\r\n// func_platrot (Half-Life)\r\n// func_pushable (Half-Life)\r\n// func_recharge (Half-Life)\r\n// func_rot_button (Half-Life)\r\n// func_rotating (Half-Life)\r\n// func_tank (Half-Life)\r\n// func_tankcontrols (Half-Life)\r\n// func_tanklaser (Half-Life)\r\n// func_tankmortar (Half-Life)\r\n// func_tankrocket (Half-Life)\r\n// func_trackautochange (Half-Life)\r\n// func_trackchange (Half-Life)\r\n// func_tracktrain (Half-Life)\r\n// func_train (Half-Life)\r\n// func_traincontrols (Half-Life)\r\n// func_wall (Half-Life)\r\n// func_wall_toggle (Half-Life)\r\n// func_water (Half-Life)\r\n// game_counter (Half-Life)\r\n// game_counter_set (Half-Life)\r\n// game_end (Half-Life)\r\n// game_player_equip (Half-Life)\r\n// game_player_hurt (Half-Life)\r\n// game_player_team (Half-Life)\r\n// game_score (Half-Life)\r\n// game_team_master (Half-Life)\r\n// game_team_set (Half-Life)\r\n// game_text (Half-Life)\r\n// game_zone_player (Half-Life)\r\n// gibshooter (Half-Life)\r\n// info_bigmomma (Half-Life)\r\n// info_intermission (Half-Life)\r\n// info_landmark (Half-Life)\r\n// info_node (Half-Life)\r\n// info_node_air (Half-Life)\r\n// info_null (Half-Life)\r\n// info_player_coop (Half-Life)\r\n// info_player_deathmatch (Half-Life)\r\n// info_player_start (Half-Life)\r\n// info_target (Half-Life)\r\n// info_teleport_destination (Half-Life)\r\n// info_texlights (Half-Life)\r\n// infodecal (Half-Life)\r\n// item_airtank (Half-Life)\r\n// item_antidote (Half-Life)\r\n// item_battery (Half-Life)\r\n// item_healthkit (Half-Life)\r\n// item_longjump (Half-Life)\r\n// item_security (Half-Life)\r\n// item_sodacan (Half-Life)\r\n// item_suit (Half-Life)\r\n// light (Half-Life)\r\n// light_environment (Half-Life)\r\n// light_spot (Half-Life)\r\n// momentary_door (Half-Life)\r\n// momentary_rot_button (Half-Life)\r\n// monster_alien_controller (Half-Life)\r\n// monster_alien_grunt (Half-Life)\r\n// monster_alien_slave (Half-Life)\r\n// monster_apache (Half-Life)\r\n// monster_babycrab (Half-Life)\r\n// monster_barnacle (Half-Life)\r\n// monster_barney (Half-Life)\r\n// monster_barney_dead (Half-Life)\r\n// monster_bigmomma (Half-Life)\r\n// monster_bloater (Half-Life)\r\n// monster_bullchicken (Half-Life)\r\n// monster_cockroach (Half-Life)\r\n// monster_flyer_flock (Half-Life)\r\n// monster_furniture (Half-Life)\r\n// monster_gargantua (Half-Life)\r\n// monster_generic (Half-Life)\r\n// monster_gman (Half-Life)\r\n// monster_grunt_repel (Half-Life)\r\n// monster_handgrenade (Half-Life)\r\n// monster_headcrab (Half-Life)\r\n// monster_hevsuit_dead (Half-Life)\r\n// monster_hgrunt_dead (Half-Life)\r\n// monster_houndeye (Half-Life)\r\n// monster_human_assassin (Half-Life)\r\n// monster_human_grunt (Half-Life)\r\n// monster_ichthyosaur (Half-Life)\r\n// monster_leech (Half-Life)\r\n// monster_miniturret (Half-Life)\r\n// monster_nihilanth (Half-Life)\r\n// monster_osprey (Half-Life)\r\n// monster_rat (Half-Life)\r\n// monster_satchelcharge (Half-Life)\r\n// monster_scientist (Half-Life)\r\n// monster_scientist_dead (Half-Life)\r\n// monster_sentry (Half-Life)\r\n// monster_sitting_scientist (Half-Life)\r\n// monster_snark (Half-Life)\r\n// monster_tentacle (Half-Life)\r\n// monster_tripmine (Half-Life)\r\n// monster_turret (Half-Life)\r\n// monster_zombie (Half-Life)\r\n// monstermaker (Half-Life)\r\n// multi_manager (Half-Life)\r\n// multisource (Half-Life)\r\n// path_corner (Half-Life)\r\n// path_track (Half-Life)\r\n// player_loadsaved (Half-Life)\r\n// player_weaponstrip (Half-Life)\r\n// scripted_sentence (Half-Life)\r\n// scripted_sequence (Half-Life)\r\n// speaker (Half-Life)\r\n// target_cdaudio (Half-Life)\r\n// trigger_auto (Half-Life)\r\n// trigger_autosave (Half-Life)\r\n// trigger_camera (Half-Life)\r\n// trigger_cdaudio (Half-Life)\r\n// trigger_changelevel (Half-Life)\r\n// trigger_changetarget (Half-Life)\r\n// trigger_counter (Half-Life)\r\n// trigger_endsection (Half-Life)\r\n// trigger_gravity (Half-Life)\r\n// trigger_hurt (Half-Life)\r\n// trigger_monsterjump (Half-Life)\r\n// trigger_multiple (Half-Life)\r\n// trigger_once (Half-Life)\r\n// trigger_push (Half-Life)\r\n// trigger_relay (Half-Life)\r\n// trigger_teleport (Half-Life)\r\n// trigger_transition (Half-Life)\r\n// weapon_357 (Half-Life)\r\n// weapon_9mmAR (Half-Life)\r\n// weapon_9mmhandgun (Half-Life)\r\n// weapon_crossbow (Half-Life)\r\n// weapon_crowbar (Half-Life)\r\n// weapon_egon (Half-Life)\r\n// weapon_gauss (Half-Life)\r\n// weapon_handgrenade (Half-Life)\r\n// weapon_hornetgun (Half-Life)\r\n// weapon_rpg (Half-Life)\r\n// weapon_satchel (Half-Life)\r\n// weapon_shotgun (Half-Life)\r\n// weapon_snark (Half-Life)\r\n// weapon_tripmine (Half-Life)\r\n// weaponbox (Half-Life)\r\n// world_items (Half-Life)\r\n// worldspawn (Half-Life)\r\n// xen_hair (Half-Life)\r\n// xen_plantlight (Half-Life)\r\n// xen_spore_large (Half-Life)\r\n// xen_spore_medium (Half-Life)\r\n// xen_spore_small (Half-Life)\r\n// xen_tree (Half-Life)\r\n\r\nexport interface FuncBreakable {\r\n  classname: 'func_breakable'\r\n}\r\n\r\nexport interface BadEntity {\r\n  classname: '!'\r\n  data: any\r\n}\r\n\r\nexport interface UnknownEntity {\r\n  classname: '?'\r\n  originalClassname: string\r\n  data: any\r\n}\r\n\r\nexport type Entity = WorldSpawn | FuncBreakable | BadEntity | UnknownEntity\r\n\r\nexport const BspEntityParser = {\r\n  parse(entities: any[]): Entity[] {\r\n    const arr: Entity[] = []\r\n\r\n    for (let i = 0; i < entities.length; ++i) {\r\n      const e = entities[i]\r\n\r\n      if (!e.classname) {\r\n        arr.push({\r\n          classname: '!',\r\n          data: e\r\n        })\r\n      }\r\n\r\n      if ((parsers as any)[e.classname]) {\r\n        arr.push((parsers as any)[e.classname](e))\r\n      } else {\r\n        arr.push({\r\n          classname: '?',\r\n          originalClassname: e.classname,\r\n          data: e\r\n        })\r\n      }\r\n    }\r\n\r\n    return arr\r\n  }\r\n}\r\n","export const resizeTexture = (\r\n  pixels: Uint8Array,\r\n  width: number,\r\n  height: number,\r\n  newWidth: number,\r\n  newHeight: number\r\n) => {\r\n  const canvas = document.createElement('canvas')\r\n  const ctx = canvas.getContext('2d')\r\n  if (!ctx) {\r\n    throw new Error('Runtime error.')\r\n  }\r\n  canvas.width = width\r\n  canvas.height = height\r\n\r\n  const nc = document.createElement('canvas')\r\n  const nctx = nc.getContext('2d')\r\n  if (!nctx) {\r\n    throw new Error('Runtime error.')\r\n  }\r\n  nc.width = newWidth\r\n  nc.height = newHeight\r\n\r\n  const cid = ctx.createImageData(width, height)\r\n  for (let i = 0, size = width * height * 4; i < size; i += 4) {\r\n    cid.data[i] = pixels[i]\r\n    cid.data[i + 1] = pixels[i + 1]\r\n    cid.data[i + 2] = pixels[i + 2]\r\n    cid.data[i + 3] = pixels[i + 3]\r\n  }\r\n  ctx.putImageData(cid, 0, 0)\r\n\r\n  nctx.drawImage(canvas, 0, 0, newWidth, newHeight)\r\n\r\n  return new Uint8Array(nctx.getImageData(0, 0, newWidth, newHeight).data)\r\n}\r\n\r\nexport const isPowerOfTwo = (n: number) => (n & (n - 1)) === 0\r\n\r\nexport const nextPowerOfTwo = (_n: number) => {\r\n  let n = _n\r\n  --n\r\n  for (let i = 1; i < 32; i <<= 1) {\r\n    n = n | (n >> i)\r\n  }\r\n  return n + 1\r\n}\r\n","import { mat4, vec3 } from 'gl-matrix'\r\nimport type { Bsp } from '../Bsp'\r\nimport type { Camera } from './Camera'\r\nimport type { Context } from './Context'\r\nimport { type Sprite, SpriteType } from '../Parsers/Sprite'\r\nimport { MainShader } from './WorldShader/WorldShader'\r\nimport { RenderMode } from '../Parsers/BspEntityParser'\r\nimport { isPowerOfTwo, nextPowerOfTwo, resizeTexture } from './Util'\r\n\r\ntype FaceInfo = {\r\n  offset: number\r\n  length: number\r\n  textureIndex: number\r\n}\r\ntype ModelInfo = {\r\n  origin: vec3\r\n  offset: number\r\n  length: number\r\n  isTransparent: boolean\r\n  faces: FaceInfo[]\r\n}\r\ntype SceneInfo = {\r\n  length: number\r\n  data: Float32Array\r\n  models: ModelInfo[]\r\n}\r\n\r\nexport class WorldScene {\r\n  static init(context: Context) {\r\n    const shader = MainShader.init(context)\r\n    if (!shader) {\r\n      console.error('Failed to init MainShader')\r\n      return null\r\n    }\r\n\r\n    shader.useProgram(context.gl)\r\n\r\n    const buffer = context.gl.createBuffer()\r\n    if (!buffer) {\r\n      console.error('Failed to create WebGL buffer')\r\n      return null\r\n    }\r\n\r\n    return new WorldScene({ buffer, context, shader })\r\n  }\r\n\r\n  private buffer: WebGLBuffer\r\n  private context: Context\r\n  private shader: MainShader\r\n  private modelMatrix: mat4 = mat4.create()\r\n\r\n  private sceneInfo: SceneInfo = {\r\n    length: 0,\r\n    data: new Float32Array(0),\r\n    models: []\r\n  }\r\n  private bsp: Bsp | null = null\r\n  private textures: {\r\n    name: string\r\n    width: number\r\n    height: number\r\n    data: Uint8Array\r\n    handle: WebGLTexture\r\n  }[] = []\r\n  private sprites: { [name: string]: Sprite } = {}\r\n  private lightmap: {\r\n    data: Uint8Array\r\n    handle: WebGLTexture\r\n  } | null = null\r\n  private constructor(params: { context: Context; buffer: WebGLBuffer; shader: MainShader }) {\r\n    this.buffer = params.buffer\r\n    this.context = params.context\r\n    this.shader = params.shader\r\n  }\r\n\r\n  changeMap(bsp: Bsp) {\r\n    this.fillBuffer(bsp)\r\n    this.loadTextures(bsp)\r\n    this.loadSpriteTextures(bsp)\r\n    this.loadLightmap(bsp)\r\n    this.bsp = bsp\r\n  }\r\n\r\n  private fillBuffer(bsp: Bsp) {\r\n    const gl = this.context.gl\r\n    const models = bsp.models\r\n\r\n    const INVISIBLE_TEXTURES = [\r\n      'aaatrigger',\r\n      'clip',\r\n      'null',\r\n      'hint',\r\n      'nodraw',\r\n      'invisible',\r\n      'skip',\r\n      'trigger',\r\n      'sky',\r\n      'fog'\r\n    ]\r\n\r\n    // get total buffer size\r\n    let size = 0\r\n    for (let i = 0; i < models.length; ++i) {\r\n      const model = models[i]\r\n      for (let j = 0; j < model.faces.length; ++j) {\r\n        const texture = bsp.textures[model.faces[j].textureIndex]\r\n        if (INVISIBLE_TEXTURES.indexOf(texture.name) > -1) {\r\n          continue\r\n        }\r\n\r\n        size += model.faces[j].buffer.length\r\n      }\r\n    }\r\n\r\n    // add 6 vertex for a single quad that will be used to render sprites\r\n    size += 7 * 6\r\n\r\n    // init scene info structure and buffer with the appropriate size\r\n    const sceneInfo: SceneInfo = {\r\n      length: size,\r\n      data: new Float32Array(size),\r\n      models: []\r\n    }\r\n\r\n    // fill the scene info structure\r\n    let currentVertex = 0\r\n    for (let i = 0; i < bsp.models.length; ++i) {\r\n      const model = bsp.models[i]\r\n      const modelInfo: ModelInfo = {\r\n        origin: model.origin,\r\n        offset: currentVertex,\r\n        length: 0,\r\n        isTransparent: false,\r\n        faces: []\r\n      }\r\n\r\n      for (let j = 0; j < model.faces.length; ++j) {\r\n        const texture = bsp.textures[model.faces[j].textureIndex]\r\n        if (INVISIBLE_TEXTURES.indexOf(texture.name) > -1) {\r\n          continue\r\n        }\r\n\r\n        const faceInfo: FaceInfo = {\r\n          offset: currentVertex,\r\n          length: 0,\r\n          textureIndex: -1\r\n        }\r\n\r\n        for (let k = 0; k < model.faces[j].buffer.length; ++k) {\r\n          sceneInfo.data[currentVertex++] = model.faces[j].buffer[k]\r\n        }\r\n\r\n        if (!modelInfo.isTransparent && bsp.textures[model.faces[j].textureIndex].name[0] === '{') {\r\n          modelInfo.isTransparent = true\r\n        }\r\n\r\n        faceInfo.textureIndex = model.faces[j].textureIndex\r\n        faceInfo.length = currentVertex - faceInfo.offset\r\n        modelInfo.faces.push(faceInfo)\r\n      }\r\n\r\n      modelInfo.length = currentVertex - modelInfo.offset\r\n      sceneInfo.models.push(modelInfo)\r\n    }\r\n\r\n    // set data of the last quad used for rendering sprites\r\n    sceneInfo.models.push({\r\n      origin: [0, 0, 0],\r\n      offset: currentVertex,\r\n      length: 4,\r\n      isTransparent: false, // unused\r\n      faces: [\r\n        {\r\n          offset: currentVertex,\r\n          length: 4,\r\n          textureIndex: 0 // unused\r\n        }\r\n      ]\r\n    })\r\n    sceneInfo.data[currentVertex++] = -0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = -0.5\r\n    sceneInfo.data[currentVertex++] = 1\r\n    sceneInfo.data[currentVertex++] = 1\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n\r\n    sceneInfo.data[currentVertex++] = 0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n\r\n    sceneInfo.data[currentVertex++] = -0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0.5\r\n    sceneInfo.data[currentVertex++] = 1\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n\r\n    sceneInfo.data[currentVertex++] = -0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = -0.5\r\n    sceneInfo.data[currentVertex++] = 1\r\n    sceneInfo.data[currentVertex++] = 1\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n\r\n    sceneInfo.data[currentVertex++] = 0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = -0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 1\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n\r\n    sceneInfo.data[currentVertex++] = 0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0.5\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n    sceneInfo.data[currentVertex++] = 0\r\n\r\n    // sort each model's face in scene info structure by texture index\r\n    // and merge faces with same texture to lower draw calls\r\n    currentVertex = 0\r\n    const sortedSceneInfo: SceneInfo = {\r\n      data: new Float32Array(sceneInfo.data),\r\n      length: sceneInfo.length,\r\n      models: sceneInfo.models.map((model) => ({\r\n        origin: vec3.clone(model.origin),\r\n        offset: model.offset,\r\n        length: model.length,\r\n        isTransparent: model.isTransparent,\r\n        faces: model.faces.map((face) => ({\r\n          offset: face.offset,\r\n          length: face.length,\r\n          textureIndex: face.textureIndex\r\n        }))\r\n      }))\r\n    }\r\n    for (let i = 0; i < sortedSceneInfo.models.length; ++i) {\r\n      const model = sortedSceneInfo.models[i]\r\n      model.faces.sort((a, b) => a.textureIndex - b.textureIndex)\r\n\r\n      for (let j = 0; j < model.faces.length; ++j) {\r\n        const face = model.faces[j]\r\n        const newOffset = currentVertex\r\n\r\n        for (let k = 0; k < face.length; ++k) {\r\n          sortedSceneInfo.data[currentVertex] = sceneInfo.data[face.offset + k]\r\n          currentVertex += 1\r\n        }\r\n\r\n        face.offset = newOffset\r\n      }\r\n\r\n      const newFaces: FaceInfo[] = []\r\n      let currentTextureIndex = -1\r\n      for (let j = 0; j < model.faces.length; ++j) {\r\n        const face = model.faces[j]\r\n\r\n        if (face.textureIndex === currentTextureIndex) {\r\n          newFaces[newFaces.length - 1].length += face.length\r\n        } else {\r\n          // merge\r\n          newFaces.push({\r\n            offset: face.offset,\r\n            length: face.length,\r\n            textureIndex: face.textureIndex\r\n          })\r\n          currentTextureIndex = face.textureIndex\r\n        }\r\n      }\r\n      model.faces = newFaces\r\n    }\r\n    this.sceneInfo = sortedSceneInfo\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.sceneInfo.data, gl.STATIC_DRAW)\r\n  }\r\n\r\n  private loadTextures(bsp: Bsp) {\r\n    const gl = this.context.gl\r\n\r\n    for (let i = 0; i < bsp.textures.length; ++i) {\r\n      const glTexture = gl.createTexture()\r\n      if (!glTexture) {\r\n        // shouldnt happen\r\n        // TODO: handle better\r\n        throw new Error('fatal error')\r\n      }\r\n\r\n      const texture = bsp.textures[i]\r\n      if (!isPowerOfTwo(texture.width) || !isPowerOfTwo(texture.height)) {\r\n        const w = texture.width\r\n        const h = texture.height\r\n        const nw = nextPowerOfTwo(texture.width)\r\n        const nh = nextPowerOfTwo(texture.height)\r\n        texture.data = resizeTexture(texture.data, w, h, nw, nh)\r\n        texture.width = nw\r\n        texture.height = nh\r\n      }\r\n\r\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\r\n      gl.texImage2D(\r\n        gl.TEXTURE_2D,\r\n        0,\r\n        gl.RGBA,\r\n        texture.width,\r\n        texture.height,\r\n        0,\r\n        gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        texture.data\r\n      )\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR)\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\r\n      gl.generateMipmap(gl.TEXTURE_2D)\r\n\r\n      const anisotropy = this.context.getAnisotropyExtension()\r\n      if (anisotropy) {\r\n        gl.texParameteri(\r\n          gl.TEXTURE_2D,\r\n          anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\r\n          this.context.getMaxAnisotropy(anisotropy)\r\n        )\r\n      }\r\n\r\n      this.textures.push({\r\n        name: texture.name,\r\n        width: texture.width,\r\n        height: texture.height,\r\n        data: texture.data,\r\n        handle: glTexture\r\n      })\r\n    }\r\n  }\r\n\r\n  private loadSpriteTextures(bsp: Bsp) {\r\n    const gl = this.context.gl\r\n\r\n    for (const [name, sprite] of Object.entries(bsp.sprites)) {\r\n      const glTexture = gl.createTexture()\r\n      if (!glTexture) {\r\n        // shouldnt happen\r\n        // TODO: handle better\r\n        throw new Error('fatal error')\r\n      }\r\n\r\n      const texture = sprite.frames[0]\r\n      if (!isPowerOfTwo(texture.width) || !isPowerOfTwo(texture.height)) {\r\n        const w = texture.width\r\n        const h = texture.height\r\n        const nw = nextPowerOfTwo(texture.width)\r\n        const nh = nextPowerOfTwo(texture.height)\r\n        texture.data = resizeTexture(texture.data, w, h, nw, nh)\r\n        texture.width = nw\r\n        texture.height = nh\r\n      }\r\n\r\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\r\n      gl.texImage2D(\r\n        gl.TEXTURE_2D,\r\n        0,\r\n        gl.RGBA,\r\n        texture.width,\r\n        texture.height,\r\n        0,\r\n        gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        texture.data\r\n      )\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR)\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\r\n      gl.generateMipmap(gl.TEXTURE_2D)\r\n\r\n      const anisotropy = this.context.getAnisotropyExtension()\r\n      if (anisotropy) {\r\n        gl.texParameteri(\r\n          gl.TEXTURE_2D,\r\n          anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\r\n          this.context.getMaxAnisotropy(anisotropy)\r\n        )\r\n      }\r\n\r\n      this.textures.push({\r\n        name: name,\r\n        width: texture.width,\r\n        height: texture.height,\r\n        data: texture.data,\r\n        handle: glTexture\r\n      })\r\n      this.sprites[name] = sprite\r\n    }\r\n  }\r\n\r\n  private loadLightmap(bsp: Bsp) {\r\n    const gl = this.context.gl\r\n\r\n    const glLightmap = gl.createTexture()\r\n    if (!glLightmap) {\r\n      // shouldnt happen\r\n      // TODO: handle better\r\n      throw new Error('fatal error')\r\n    }\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, glLightmap)\r\n    gl.texImage2D(\r\n      gl.TEXTURE_2D,\r\n      0,\r\n      gl.RGBA,\r\n      bsp.lightmap.width,\r\n      bsp.lightmap.height,\r\n      0,\r\n      gl.RGBA,\r\n      gl.UNSIGNED_BYTE,\r\n      bsp.lightmap.data\r\n    )\r\n    gl.generateMipmap(gl.TEXTURE_2D)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR)\r\n\r\n    this.lightmap = {\r\n      data: bsp.lightmap.data,\r\n      handle: glLightmap\r\n    }\r\n  }\r\n\r\n  draw(camera: Camera, entities: any[]) {\r\n    if (!this.bsp || !this.lightmap) {\r\n      return\r\n    }\r\n\r\n    const gl = this.context.gl\r\n    const shader = this.shader\r\n\r\n    shader.useProgram(gl)\r\n\r\n    camera.updateProjectionMatrix()\r\n    camera.updateViewMatrix()\r\n\r\n    shader.setViewMatrix(gl, camera.viewMatrix)\r\n    shader.setProjectionMatrix(gl, camera.projectionMatrix)\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer)\r\n    shader.enableVertexAttribs(gl)\r\n    shader.setVertexAttribPointers(gl)\r\n\r\n    shader.setDiffuse(gl, 0)\r\n    shader.setLightmap(gl, 1)\r\n\r\n    gl.activeTexture(gl.TEXTURE1)\r\n    gl.bindTexture(gl.TEXTURE_2D, this.lightmap.handle)\r\n\r\n    gl.activeTexture(gl.TEXTURE0)\r\n\r\n    const opaqueEntities = []\r\n    const transparentEntities = []\r\n    for (let i = 1; i < entities.length; ++i) {\r\n      const e = entities[i]\r\n      if (e.model) {\r\n        if (!e.rendermode || e.rendermode === RenderMode.Normal || e.rendermode === RenderMode.Solid) {\r\n          if (e.model[0] === '*') {\r\n            const model = this.sceneInfo.models[Number.parseInt(e.model.substr(1))]\r\n            if (model.isTransparent) {\r\n              transparentEntities.push(e)\r\n              continue\r\n            }\r\n          } else if (e.model.indexOf('.spr') > -1) {\r\n            transparentEntities.push(e)\r\n            continue\r\n          }\r\n\r\n          opaqueEntities.push(e)\r\n        } else if (e.rendermode === RenderMode.Additive) {\r\n          transparentEntities.push(e)\r\n        } else {\r\n          transparentEntities.push(e)\r\n        }\r\n      }\r\n    }\r\n\r\n    shader.setOpacity(gl, 1.0)\r\n    this.renderWorldSpawn()\r\n    this.renderOpaqueEntities(camera, opaqueEntities)\r\n\r\n    if (transparentEntities.length) {\r\n      gl.depthMask(false)\r\n      this.renderTransparentEntities(transparentEntities, camera)\r\n      gl.depthMask(true)\r\n    }\r\n  }\r\n\r\n  private renderWorldSpawn() {\r\n    const model = this.sceneInfo.models[0]\r\n    const gl = this.context.gl\r\n\r\n    mat4.identity(this.modelMatrix)\r\n    this.shader.setModelMatrix(gl, this.modelMatrix)\r\n\r\n    for (let j = 0; j < model.faces.length; ++j) {\r\n      const face = model.faces[j]\r\n      gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n      gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n    }\r\n  }\r\n\r\n  private renderOpaqueEntities(camera: Camera, entities: any[]) {\r\n    const gl = this.context.gl\r\n    const shader = this.shader\r\n    const mmx = this.modelMatrix\r\n\r\n    for (let i = 0; i < entities.length; ++i) {\r\n      const entity = entities[i]\r\n      const modelIndex = Number.parseInt(entity.model.substr(1))\r\n      const model = this.sceneInfo.models[modelIndex]\r\n      if (model) {\r\n        const angles = entity.angles || [0, 0, 0]\r\n        const origin = entity.origin\r\n          ? vec3.fromValues(entity.origin[0], entity.origin[1], entity.origin[2])\r\n          : vec3.create()\r\n        vec3.add(origin, origin, model.origin)\r\n\r\n        // TODO: this seems to work, but needs further research\r\n        mat4.identity(mmx)\r\n        mat4.translate(mmx, mmx, origin)\r\n        // mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180) // dunno this\r\n        mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180)\r\n        mat4.rotateX(this.modelMatrix, this.modelMatrix, (angles[2] * Math.PI) / 180)\r\n        shader.setModelMatrix(gl, this.modelMatrix)\r\n\r\n        for (let j = 0; j < model.faces.length; ++j) {\r\n          const face = model.faces[j]\r\n          gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n          gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n        }\r\n      } else if (entity.model.indexOf('.spr') > -1) {\r\n        const texture = this.textures.find((a) => a.name === entity.model)\r\n        const sprite = this.sprites[entity.model]\r\n        if (texture && sprite) {\r\n          const origin = entity.origin\r\n            ? vec3.fromValues(entity.origin[0], entity.origin[1], entity.origin[2])\r\n            : vec3.create()\r\n          const scale = vec3.fromValues(texture.width, 1, texture.height)\r\n          const angles = entity.angles\r\n            ? vec3.fromValues(entity.angles[0], entity.angles[2], entity.angles[1])\r\n            : vec3.create()\r\n          vec3.scale(scale, scale, entity.scale || 1)\r\n\r\n          mat4.identity(mmx)\r\n          mat4.translate(mmx, mmx, origin)\r\n\r\n          switch (sprite.header.type) {\r\n            case SpriteType.VP_PARALLEL_UPRIGHT: {\r\n              // TODO: incorrect, but will do for now\r\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\r\n              break\r\n            }\r\n            case SpriteType.FACING_UPRIGHT: {\r\n              // TODO: fix incorrect\r\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\r\n              break\r\n            }\r\n            case SpriteType.VP_PARALLEL: {\r\n              mat4.rotateZ(\r\n                mmx,\r\n                mmx,\r\n                Math.atan2(origin[1] - camera.position[1], origin[0] - camera.position[0]) + Math.PI / 2\r\n              )\r\n              mat4.rotateX(\r\n                mmx,\r\n                mmx,\r\n                Math.atan2(\r\n                  camera.position[2] - origin[2],\r\n                  Math.sqrt((camera.position[0] - origin[0]) ** 2 + (camera.position[1] - origin[1]) ** 2)\r\n                )\r\n              )\r\n\r\n              break\r\n            }\r\n            case SpriteType.ORIENTED: {\r\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\r\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\r\n              mat4.rotateX(mmx, mmx, (angles[2] * Math.PI) / 180 - Math.PI / 2)\r\n              break\r\n            }\r\n            case SpriteType.VP_PARALLEL_ORIENTED: {\r\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\r\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\r\n              break\r\n            }\r\n            default: {\r\n              throw new Error('Invalid sprite type')\r\n            }\r\n          }\r\n\r\n          mat4.scale(mmx, mmx, scale)\r\n          shader.setModelMatrix(gl, mmx)\r\n          shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n\r\n          const renderMode = entity.rendermode || RenderMode.Normal\r\n          switch (renderMode) {\r\n            case RenderMode.Normal: {\r\n              shader.setOpacity(gl, 1)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Color: {\r\n              // TODO: not properly implemented\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Texture: {\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Glow: {\r\n              // TODO: not properly implemented\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n              break\r\n            }\r\n            case RenderMode.Solid: {\r\n              // TODO: not properly implemented\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Additive: {\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n              break\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private renderTransparentEntities(entities: any[], camera: Camera) {\r\n    const gl = this.context.gl\r\n    const shader = this.shader\r\n    const mmx = this.modelMatrix\r\n\r\n    // distances of all entities from the camera\r\n    const entityDistances: {\r\n      index: number\r\n      distance: number\r\n    }[] = entities\r\n      .map((e, i) => ({\r\n        index: i,\r\n        distance: vec3.dist(camera.position, e.origin || [0, 0, 0])\r\n      }))\r\n      .sort((a, b) => a.distance - b.distance)\r\n\r\n    for (let i = 0; i < entityDistances.length; ++i) {\r\n      const entity = entities[entityDistances[i].index]\r\n\r\n      const modelIndex = Number.parseInt(entity.model.substr(1))\r\n      const model = this.sceneInfo.models[modelIndex]\r\n      if (model) {\r\n        const angles = entity.angles || [0, 0, 0]\r\n        const origin = entity.origin || [0, 0, 0]\r\n        origin[0] += model.origin[0]\r\n        origin[1] += model.origin[1]\r\n        origin[2] += model.origin[2]\r\n\r\n        // TODO: this seems to work, but needs further research\r\n        mat4.identity(mmx)\r\n        mat4.translate(mmx, mmx, origin)\r\n        mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180)\r\n        // mat4.rotateY(mmx, mmx, (angles[2] * Math.PI) / 180) // dunno this\r\n        mat4.rotateX(this.modelMatrix, this.modelMatrix, (angles[2] * Math.PI) / 180)\r\n        shader.setModelMatrix(gl, this.modelMatrix)\r\n\r\n        const renderMode = entity.rendermode || RenderMode.Normal\r\n        switch (renderMode) {\r\n          case RenderMode.Normal: {\r\n            shader.setOpacity(gl, 1)\r\n            for (let j = 0; j < model.faces.length; ++j) {\r\n              const face = model.faces[j]\r\n              gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n            }\r\n            break\r\n          }\r\n          case RenderMode.Color: {\r\n            // TODO: not properly implemented\r\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n            for (let j = 0; j < model.faces.length; ++j) {\r\n              const face = model.faces[j]\r\n              gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n            }\r\n            break\r\n          }\r\n          case RenderMode.Texture: {\r\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n            for (let j = 0; j < model.faces.length; ++j) {\r\n              const face = model.faces[j]\r\n              gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n            }\r\n            break\r\n          }\r\n          case RenderMode.Glow: {\r\n            // TODO: not properly implemented\r\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n            for (let j = 0; j < model.faces.length; ++j) {\r\n              const face = model.faces[j]\r\n              gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n            }\r\n            break\r\n          }\r\n          case RenderMode.Solid: {\r\n            // TODO: not properly implemented\r\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n            for (let j = 0; j < model.faces.length; ++j) {\r\n              const face = model.faces[j]\r\n              gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n            }\r\n            break\r\n          }\r\n          case RenderMode.Additive: {\r\n            gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\r\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n            for (let j = 0; j < model.faces.length; ++j) {\r\n              const face = model.faces[j]\r\n              gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\r\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\r\n            }\r\n            gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n            break\r\n          }\r\n        }\r\n      } else if (entity.model.indexOf('.spr') > -1) {\r\n        const texture = this.textures.find((a) => a.name === entity.model)\r\n        const sprite = this.sprites[entity.model]\r\n        if (texture && sprite) {\r\n          const origin = entity.origin\r\n            ? vec3.fromValues(entity.origin[0], entity.origin[1], entity.origin[2])\r\n            : vec3.create()\r\n          const scale = vec3.fromValues(texture.width, 1, texture.height)\r\n          const angles = entity.angles\r\n            ? vec3.fromValues(entity.angles[0], entity.angles[2], entity.angles[1])\r\n            : vec3.create()\r\n          vec3.scale(scale, scale, entity.scale || 1)\r\n\r\n          mat4.identity(mmx)\r\n          mat4.translate(mmx, mmx, origin)\r\n\r\n          switch (sprite.header.type) {\r\n            case SpriteType.VP_PARALLEL_UPRIGHT: {\r\n              // TODO: incorrect, but will do for now\r\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\r\n              break\r\n            }\r\n            case SpriteType.FACING_UPRIGHT: {\r\n              // TODO: fix incorrect\r\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\r\n              break\r\n            }\r\n            case SpriteType.VP_PARALLEL: {\r\n              mat4.rotateZ(\r\n                mmx,\r\n                mmx,\r\n                Math.atan2(origin[1] - camera.position[1], origin[0] - camera.position[0]) + Math.PI / 2\r\n              )\r\n              mat4.rotateX(\r\n                mmx,\r\n                mmx,\r\n                Math.atan2(\r\n                  camera.position[2] - origin[2],\r\n                  Math.sqrt((camera.position[0] - origin[0]) ** 2 + (camera.position[1] - origin[1]) ** 2)\r\n                )\r\n              )\r\n\r\n              break\r\n            }\r\n            case SpriteType.ORIENTED: {\r\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\r\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\r\n              mat4.rotateX(mmx, mmx, (angles[2] * Math.PI) / 180 - Math.PI / 2)\r\n              break\r\n            }\r\n            case SpriteType.VP_PARALLEL_ORIENTED: {\r\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\r\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\r\n              break\r\n            }\r\n            default: {\r\n              throw new Error('Invalid sprite type')\r\n            }\r\n          }\r\n\r\n          mat4.scale(mmx, mmx, scale)\r\n          shader.setModelMatrix(gl, mmx)\r\n          shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n\r\n          const renderMode = entity.rendermode || RenderMode.Normal\r\n          switch (renderMode) {\r\n            case RenderMode.Normal: {\r\n              shader.setOpacity(gl, 1)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Color: {\r\n              // TODO: not properly implemented\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Texture: {\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Glow: {\r\n              // TODO: not properly implemented\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n              break\r\n            }\r\n            case RenderMode.Solid: {\r\n              // TODO: not properly implemented\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              break\r\n            }\r\n            case RenderMode.Additive: {\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\r\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\r\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\r\n              gl.drawArrays(gl.TRIANGLES, this.sceneInfo.models[this.sceneInfo.models.length - 1].offset / 7, 6)\r\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n              break\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { createNanoEvents, type Emitter as EventEmitter } from 'nanoevents'\r\nimport type { Bsp } from './Bsp'\r\nimport type { Sound } from './Sound'\r\nimport type { Config } from './Config'\r\nimport type { Replay } from './Replay/Replay'\r\nimport * as Time from './Time'\r\nimport { Loader } from './Loader'\r\nimport { Mouse } from './Input/Mouse'\r\nimport { Touch } from './Input/Touch'\r\nimport { Camera } from './Graphics/Camera'\r\nimport { Keyboard } from './Input/Keyboard'\r\nimport { SoundSystem } from './SoundSystem'\r\nimport { Context } from './Graphics/Context'\r\nimport { ReplayPlayer } from './ReplayPlayer'\r\nimport { Renderer } from './Graphics/Renderer'\r\nimport { SkyScene } from './Graphics/SkyScene'\r\nimport { WorldScene } from './Graphics/WorldScene'\r\n\r\nexport enum PlayerMode {\r\n  FREE = 0,\r\n  REPLAY = 1\r\n}\r\n\r\ntype GameInitSuccess = { status: 'success'; game: Game }\r\ntype GameInitError = { status: 'error'; message: string }\r\ntype GameInit = GameInitSuccess | GameInitError\r\n\r\nexport class Game {\r\n  public static init(config: Config): GameInit {\r\n    const status = Context.checkWebGLSupport()\r\n    if (!status.hasSupport) {\r\n      return {\r\n        status: 'error',\r\n        message: 'No WebGL support!'\r\n      }\r\n    }\r\n\r\n    const canvas = document.createElement('canvas')\r\n    if (!canvas) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to create <canvas> element!'\r\n      }\r\n    }\r\n\r\n    const context = Context.init(canvas)\r\n    if (!context) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize WebGL context'\r\n      }\r\n    }\r\n\r\n    const renderer = Renderer.init(context)\r\n    if (!renderer) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize renderer'\r\n      }\r\n    }\r\n\r\n    const worldScene = WorldScene.init(context)\r\n    if (!worldScene) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize world scene'\r\n      }\r\n    }\r\n\r\n    const skyScene = SkyScene.init(context)\r\n    if (!skyScene) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize sky scene'\r\n      }\r\n    }\r\n\r\n    const game = new Game({\r\n      canvas,\r\n      config,\r\n      context,\r\n      renderer,\r\n      worldScene,\r\n      skyScene\r\n    })\r\n\r\n    return {\r\n      status: 'success',\r\n      game\r\n    }\r\n  }\r\n\r\n  config: Config\r\n\r\n  pauseTime = 0\r\n  isPaused = false\r\n  lastTime = 0\r\n  accumTime = 0\r\n  readonly timeStep: number = 1 / 60\r\n\r\n  title = ''\r\n  mode: PlayerMode\r\n  pointerLocked = false\r\n\r\n  touch: Touch = new Touch()\r\n  mouse: Mouse = new Mouse()\r\n  keyboard: Keyboard = new Keyboard()\r\n\r\n  loader: Loader\r\n  entities: any[] = []\r\n  sounds: Sound[]\r\n  soundSystem: SoundSystem\r\n  events: EventEmitter\r\n  player: ReplayPlayer\r\n\r\n  canvas: HTMLCanvasElement\r\n  mapName: string\r\n  context: Context\r\n  camera: Camera\r\n  renderer: Renderer\r\n  worldScene: WorldScene\r\n  skyScene: SkyScene\r\n\r\n  constructor(params: { config: Config; canvas: HTMLCanvasElement; context: Context; renderer: Renderer; worldScene: WorldScene; skyScene: SkyScene }) {\r\n    this.sounds = []\r\n    this.soundSystem = new SoundSystem()\r\n\r\n    this.config = params.config\r\n    this.loader = new Loader(this.config)\r\n    this.loader.events.on('loadall', this.onLoadAll)\r\n\r\n    document.addEventListener('touchstart', this.onTouchStart, false)\r\n    document.addEventListener('touchend', this.onTouchEnd, false)\r\n    document.addEventListener('touchcancel', this.onTouchEnd, false)\r\n    document.addEventListener('touchmove', this.onTouchMove, false)\r\n    document.addEventListener('mousemove', this.onMouseMove, false)\r\n    window.addEventListener('keydown', this.keyDown)\r\n    window.addEventListener('keyup', this.keyUp)\r\n    window.addEventListener('visibilitychange', this.onVisibilityChange)\r\n\r\n    this.canvas = params.canvas\r\n    this.camera = Camera.init(this.canvas.width / this.canvas.height)\r\n\r\n    this.context = params.context\r\n    this.renderer = params.renderer\r\n    this.worldScene = params.worldScene\r\n    this.skyScene = params.skyScene\r\n\r\n    this.mode = PlayerMode.FREE\r\n\r\n    this.player = new ReplayPlayer(this)\r\n    this.events = createNanoEvents()\r\n\r\n    this.mapName = ''\r\n  }\r\n\r\n  getCanvas() {\r\n    return this.canvas\r\n  }\r\n\r\n  load(name: string) {\r\n    this.events.emit('loadstart')\r\n    this.loader.load(name)\r\n  }\r\n\r\n  changeMap(map: Bsp) {\r\n    if (this.mapName.toLowerCase() === map.name.toLowerCase()) {\r\n      return\r\n    }\r\n\r\n    this.mapName = map.name\r\n\r\n    this.worldScene.changeMap(map)\r\n    this.skyScene.changeMap(map)\r\n\r\n    this.entities = map.entities\r\n\r\n    const spawn = map.entities.find((e) => e.classname === 'info_player_start')\r\n\r\n    if (spawn) {\r\n      this.camera.position[0] = spawn.origin[0]\r\n      this.camera.position[1] = spawn.origin[1]\r\n      this.camera.position[2] = spawn.origin[2]\r\n    } else {\r\n      this.camera.position[0] = 0\r\n      this.camera.position[1] = 0\r\n      this.camera.position[2] = 0\r\n    }\r\n\r\n    this.camera.rotation[0] = 0 // Math.PI / 2\r\n    this.camera.rotation[1] = 0\r\n    this.camera.rotation[2] = 0\r\n  }\r\n\r\n  changeReplay(replay: Replay) {\r\n    this.events.emit('prereplaychange', this, replay)\r\n\r\n    this.player.changeReplay(replay)\r\n\r\n    this.events.emit('postreplaychange', this, replay)\r\n  }\r\n\r\n  changeMode(mode: PlayerMode) {\r\n    this.mode = mode\r\n    this.events.emit('modechange', mode)\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this.title = title\r\n    this.events.emit('titlechange', title)\r\n  }\r\n\r\n  getTitle() {\r\n    return this.title\r\n  }\r\n\r\n  onLoadAll = (loader: Loader) => {\r\n    if (loader?.replay) {\r\n      this.changeReplay(loader.replay.data)\r\n      this.changeMode(PlayerMode.REPLAY)\r\n    }\r\n\r\n    if (!loader.map || !loader.map.data) {\r\n      return\r\n    }\r\n\r\n    const map = loader.map.data\r\n    const skies = loader.skies\r\n    let skiesValid = true\r\n    for (const sky of skies) {\r\n      skiesValid = skiesValid && sky.isDone()\r\n    }\r\n    if (skiesValid) {\r\n      for (const sky of skies) {\r\n        if (sky.data) {\r\n          map.skies.push(sky.data)\r\n        }\r\n      }\r\n    }\r\n\r\n    // add sprites\r\n    for (const [name, item] of Object.entries(loader.sprites)) {\r\n      if (item.data) {\r\n        map.sprites[name] = item.data\r\n      }\r\n    }\r\n\r\n    if (loader.sounds.length > 0) {\r\n      for (const sound of loader.sounds) {\r\n        if (sound.data) {\r\n          this.sounds.push(sound.data)\r\n        }\r\n      }\r\n    }\r\n\r\n    this.changeMap(map)\r\n\r\n    this.events.emit('load', loader)\r\n  }\r\n\r\n  draw = () => {\r\n    requestAnimationFrame(this.draw)\r\n\r\n    const canvas = this.canvas\r\n    const parent = canvas.parentElement\r\n    if (parent) {\r\n      const pw = parent.clientWidth\r\n      const ph = parent.clientHeight\r\n      if (canvas.width !== pw || canvas.height !== ph) {\r\n        canvas.width = pw\r\n        canvas.height = ph\r\n        this.camera.aspect = canvas.clientWidth / canvas.clientHeight\r\n        this.camera.updateProjectionMatrix()\r\n        this.context.gl.viewport(0, 0, this.context.gl.drawingBufferWidth, this.context.gl.drawingBufferHeight)\r\n      }\r\n\r\n      if (canvas.clientWidth !== canvas.width || canvas.clientHeight !== canvas.height) {\r\n        canvas.width = canvas.clientWidth\r\n        canvas.height = canvas.clientHeight\r\n        this.camera.aspect = canvas.clientWidth / canvas.clientHeight\r\n        this.camera.updateProjectionMatrix()\r\n        this.context.gl.viewport(0, 0, this.context.gl.drawingBufferWidth, this.context.gl.drawingBufferHeight)\r\n      }\r\n    }\r\n\r\n    if (this.isPaused) {\r\n      return\r\n    }\r\n\r\n    const currTime = Time.now() / 1000\r\n    const dt = currTime - this.lastTime\r\n    this.accumTime += dt\r\n\r\n    while (this.accumTime > this.timeStep) {\r\n      this.update(this.timeStep)\r\n      this.accumTime -= this.timeStep\r\n    }\r\n\r\n    this.renderer.draw()\r\n    if (this.mapName !== '') {\r\n      this.skyScene.draw(this.camera)\r\n      this.worldScene.draw(this.camera, this.entities)\r\n    }\r\n\r\n    this.lastTime = currTime\r\n  }\r\n\r\n  update(dt: number) {\r\n    this.events.emit('preupdate', this)\r\n\r\n    const camera = this.camera\r\n    const keyboard = this.keyboard\r\n    const mouse = this.mouse\r\n    const touch = this.touch\r\n\r\n    if (this.mode === PlayerMode.REPLAY) {\r\n      this.player.update(dt)\r\n    } else if (this.mode === PlayerMode.FREE) {\r\n      if (this.touch.pressed) {\r\n        camera.rotation[0] = Math.min(Math.max(camera.rotation[0] + touch.delta[1] / 100, -Math.PI / 2), Math.PI / 2)\r\n        camera.rotation[1] -= touch.delta[0] / 100\r\n      } else {\r\n        camera.rotation[0] = Math.min(Math.max(camera.rotation[0] + mouse.delta[1] / 100, -Math.PI / 2), Math.PI / 2)\r\n        camera.rotation[1] -= mouse.delta[0] / 100\r\n      }\r\n\r\n      const speed = 500\r\n      const ds = speed * dt\r\n      const KEY_W = Keyboard.KEYS.W\r\n      const KEY_S = Keyboard.KEYS.S\r\n      const KEY_A = Keyboard.KEYS.A\r\n      const KEY_D = Keyboard.KEYS.D\r\n      const downKey = Keyboard.KEYS.C\r\n      const upKey = Keyboard.KEYS.SPACE\r\n      if (keyboard.keys[KEY_W] !== keyboard.keys[KEY_S]) {\r\n        const yaw = camera.rotation[1]\r\n        const pitch = camera.rotation[0]\r\n        if (keyboard.keys[KEY_W]) {\r\n          camera.position[0] += Math.cos(yaw) * Math.cos(pitch) * ds\r\n          camera.position[1] += Math.sin(yaw) * Math.cos(pitch) * ds\r\n          camera.position[2] -= Math.sin(pitch) * ds\r\n        } else if (keyboard.keys[KEY_S]) {\r\n          camera.position[0] -= Math.cos(yaw) * Math.cos(pitch) * ds\r\n          camera.position[1] -= Math.sin(yaw) * Math.cos(pitch) * ds\r\n          camera.position[2] += Math.sin(pitch) * ds\r\n        }\r\n      }\r\n\r\n      if (keyboard.keys[KEY_A] !== keyboard.keys[KEY_D]) {\r\n        if (keyboard.keys[KEY_A]) {\r\n          camera.position[1] += Math.cos(camera.rotation[1]) * ds\r\n          camera.position[0] -= Math.sin(camera.rotation[1]) * ds\r\n        } else if (keyboard.keys[KEY_D]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1]) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1]) * ds\r\n        }\r\n      }\r\n\r\n      if (keyboard.keys[upKey] !== keyboard.keys[downKey]) {\r\n        if (keyboard.keys[upKey]) {\r\n          camera.position[2] += ds\r\n        } else if (keyboard.keys[downKey]) {\r\n          camera.position[2] -= ds\r\n        }\r\n      }\r\n    }\r\n\r\n    mouse.delta[0] = 0\r\n    mouse.delta[1] = 0\r\n\r\n    this.events.emit('postupdate', this)\r\n  }\r\n\r\n  onTouchStart = (e: TouchEvent) => {\r\n    const touch = e.touches.item(0)\r\n    if (touch) {\r\n      this.touch.pressed = true\r\n      this.touch.position[0] = touch.clientX\r\n      this.touch.position[1] = touch.clientY\r\n    }\r\n  }\r\n\r\n  onTouchEnd = () => {\r\n    this.touch.pressed = false\r\n    this.touch.delta[0] = 0\r\n    this.touch.delta[1] = 0\r\n  }\r\n\r\n  onTouchMove = (e: TouchEvent) => {\r\n    const touch = e.touches.item(0)\r\n    if (touch && this.touch.pressed) {\r\n      this.touch.delta[0]\r\n      this.touch.delta[0] = touch.clientX - this.touch.position[0]\r\n      this.touch.delta[1] = touch.clientY - this.touch.position[1]\r\n\r\n      this.touch.position[0] = touch.clientX\r\n      this.touch.position[1] = touch.clientY\r\n    }\r\n  }\r\n\r\n  onMouseMove = (e: MouseEvent) => {\r\n    if (this.pointerLocked) {\r\n      this.mouse.delta[0] = e.movementX * 0.5 // mul 0.5 to lower sensitivity\r\n      this.mouse.delta[1] = e.movementY * 0.5 //\r\n\r\n      this.mouse.position[0] = e.pageX\r\n      this.mouse.position[1] = e.pageY\r\n    }\r\n  }\r\n\r\n  keyDown = (e: KeyboardEvent) => {\r\n    this.keyboard.keys[e.which] = 1\r\n\r\n    if (this.pointerLocked) {\r\n      e.preventDefault()\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  keyUp = (e: KeyboardEvent) => {\r\n    this.keyboard.keys[e.which] = 0\r\n\r\n    if (this.pointerLocked) {\r\n      e.preventDefault()\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  onVisibilityChange = () => {\r\n    if (document.hidden) {\r\n      if (this.isPaused) {\r\n        return\r\n      }\r\n\r\n      this.pauseTime = Time.now() / 1000\r\n      this.isPaused = true\r\n    } else {\r\n      if (!this.isPaused) {\r\n        return\r\n      }\r\n\r\n      this.lastTime = Time.now() / 1000 - this.pauseTime + this.lastTime\r\n      this.isPaused = false\r\n    }\r\n  }\r\n}\r\n","type ConfigPaths = {\r\n  base: string\r\n  replays: string\r\n  maps: string\r\n  wads: string\r\n  skies: string\r\n  sounds: string\r\n}\r\n\r\nexport class Config {\r\n  public static init(params: any): Config {\r\n    if (typeof params === 'string') {\r\n      return new Config({\r\n        paths: {\r\n          base: params,\r\n          replays: `${params}/replays`,\r\n          maps: `${params}/maps`,\r\n          wads: `${params}/wads`,\r\n          skies: `${params}/skies`,\r\n          sounds: `${params}/sounds`\r\n        }\r\n      })\r\n    }\r\n\r\n    return new Config({\r\n      paths: {\r\n        base: (params?.paths?.base) || '',\r\n        replays: (params?.paths?.replays) || '/replays',\r\n        maps: (params?.paths?.maps) || '/maps',\r\n        wads: (params?.paths?.wads) || '/wads',\r\n        skies: (params?.paths?.skies) || '/skies',\r\n        sounds: (params?.paths?.sounds) || '/sounds'\r\n      }\r\n    })\r\n  }\r\n\r\n  private paths: ConfigPaths\r\n\r\n  constructor(params: { paths: ConfigPaths }) {\r\n    this.paths = { ...params.paths }\r\n  }\r\n\r\n  getBasePath() {\r\n    return this.paths.base\r\n  }\r\n  getReplaysPath() {\r\n    return this.paths.replays\r\n  }\r\n  getMapsPath() {\r\n    return this.paths.maps\r\n  }\r\n  getWadsPath() {\r\n    return this.paths.wads\r\n  }\r\n  getSkiesPath() {\r\n    return this.paths.skies\r\n  }\r\n  getSoundsPath() {\r\n    return this.paths.sounds\r\n  }\r\n}\r\n","let taskIdCounter = 1,\n  isCallbackScheduled = false,\n  isPerformingWork = false,\n  taskQueue = [],\n  currentTask = null,\n  shouldYieldToHost = null,\n  yieldInterval = 5,\n  deadline = 0,\n  maxYieldInterval = 300,\n  scheduleCallback = null,\n  scheduledCallback = null;\nconst maxSigned31BitInt = 1073741823;\nfunction setupScheduler() {\n  const channel = new MessageChannel(),\n    port = channel.port2;\n  scheduleCallback = () => port.postMessage(null);\n  channel.port1.onmessage = () => {\n    if (scheduledCallback !== null) {\n      const currentTime = performance.now();\n      deadline = currentTime + yieldInterval;\n      const hasTimeRemaining = true;\n      try {\n        const hasMoreWork = scheduledCallback(hasTimeRemaining, currentTime);\n        if (!hasMoreWork) {\n          scheduledCallback = null;\n        } else port.postMessage(null);\n      } catch (error) {\n        port.postMessage(null);\n        throw error;\n      }\n    }\n  };\n  if (navigator && navigator.scheduling && navigator.scheduling.isInputPending) {\n    const scheduling = navigator.scheduling;\n    shouldYieldToHost = () => {\n      const currentTime = performance.now();\n      if (currentTime >= deadline) {\n        if (scheduling.isInputPending()) {\n          return true;\n        }\n        return currentTime >= maxYieldInterval;\n      } else {\n        return false;\n      }\n    };\n  } else {\n    shouldYieldToHost = () => performance.now() >= deadline;\n  }\n}\nfunction enqueue(taskQueue, task) {\n  function findIndex() {\n    let m = 0;\n    let n = taskQueue.length - 1;\n    while (m <= n) {\n      const k = n + m >> 1;\n      const cmp = task.expirationTime - taskQueue[k].expirationTime;\n      if (cmp > 0) m = k + 1;else if (cmp < 0) n = k - 1;else return k;\n    }\n    return m;\n  }\n  taskQueue.splice(findIndex(), 0, task);\n}\nfunction requestCallback(fn, options) {\n  if (!scheduleCallback) setupScheduler();\n  let startTime = performance.now(),\n    timeout = maxSigned31BitInt;\n  if (options && options.timeout) timeout = options.timeout;\n  const newTask = {\n    id: taskIdCounter++,\n    fn,\n    startTime,\n    expirationTime: startTime + timeout\n  };\n  enqueue(taskQueue, newTask);\n  if (!isCallbackScheduled && !isPerformingWork) {\n    isCallbackScheduled = true;\n    scheduledCallback = flushWork;\n    scheduleCallback();\n  }\n  return newTask;\n}\nfunction cancelCallback(task) {\n  task.fn = null;\n}\nfunction flushWork(hasTimeRemaining, initialTime) {\n  isCallbackScheduled = false;\n  isPerformingWork = true;\n  try {\n    return workLoop(hasTimeRemaining, initialTime);\n  } finally {\n    currentTask = null;\n    isPerformingWork = false;\n  }\n}\nfunction workLoop(hasTimeRemaining, initialTime) {\n  let currentTime = initialTime;\n  currentTask = taskQueue[0] || null;\n  while (currentTask !== null) {\n    if (currentTask.expirationTime > currentTime && (!hasTimeRemaining || shouldYieldToHost())) {\n      break;\n    }\n    const callback = currentTask.fn;\n    if (callback !== null) {\n      currentTask.fn = null;\n      const didUserCallbackTimeout = currentTask.expirationTime <= currentTime;\n      callback(didUserCallbackTimeout);\n      currentTime = performance.now();\n      if (currentTask === taskQueue[0]) {\n        taskQueue.shift();\n      }\n    } else taskQueue.shift();\n    currentTask = taskQueue[0] || null;\n  }\n  return currentTask !== null;\n}\n\nconst sharedConfig = {\n  context: undefined,\n  registry: undefined,\n  effects: undefined,\n  done: false,\n  getContextId() {\n    return getContextId(this.context.count);\n  },\n  getNextContextId() {\n    return getContextId(this.context.count++);\n  }\n};\nfunction getContextId(count) {\n  const num = String(count),\n    len = num.length - 1;\n  return sharedConfig.context.id + (len ? String.fromCharCode(96 + len) : \"\") + num;\n}\nfunction setHydrateContext(context) {\n  sharedConfig.context = context;\n}\nfunction nextHydrateContext() {\n  return {\n    ...sharedConfig.context,\n    id: sharedConfig.getNextContextId(),\n    count: 0\n  };\n}\n\nconst equalFn = (a, b) => a === b;\nconst $PROXY = Symbol(\"solid-proxy\");\nconst $TRACK = Symbol(\"solid-track\");\nconst $DEVCOMP = Symbol(\"solid-dev-component\");\nconst signalOptions = {\n  equals: equalFn\n};\nlet ERROR = null;\nlet runEffects = runQueue;\nconst STALE = 1;\nconst PENDING = 2;\nconst UNOWNED = {\n  owned: null,\n  cleanups: null,\n  context: null,\n  owner: null\n};\nconst NO_INIT = {};\nvar Owner = null;\nlet Transition = null;\nlet Scheduler = null;\nlet ExternalSourceConfig = null;\nlet Listener = null;\nlet Updates = null;\nlet Effects = null;\nlet ExecCount = 0;\nfunction createRoot(fn, detachedOwner) {\n  const listener = Listener,\n    owner = Owner,\n    unowned = fn.length === 0,\n    current = detachedOwner === undefined ? owner : detachedOwner,\n    root = unowned ? UNOWNED : {\n      owned: null,\n      cleanups: null,\n      context: current ? current.context : null,\n      owner: current\n    },\n    updateFn = unowned ? fn : () => fn(() => untrack(() => cleanNode(root)));\n  Owner = root;\n  Listener = null;\n  try {\n    return runUpdates(updateFn, true);\n  } finally {\n    Listener = listener;\n    Owner = owner;\n  }\n}\nfunction createSignal(value, options) {\n  options = options ? Object.assign({}, signalOptions, options) : signalOptions;\n  const s = {\n    value,\n    observers: null,\n    observerSlots: null,\n    comparator: options.equals || undefined\n  };\n  const setter = value => {\n    if (typeof value === \"function\") {\n      if (Transition && Transition.running && Transition.sources.has(s)) value = value(s.tValue);else value = value(s.value);\n    }\n    return writeSignal(s, value);\n  };\n  return [readSignal.bind(s), setter];\n}\nfunction createComputed(fn, value, options) {\n  const c = createComputation(fn, value, true, STALE);\n  if (Scheduler && Transition && Transition.running) Updates.push(c);else updateComputation(c);\n}\nfunction createRenderEffect(fn, value, options) {\n  const c = createComputation(fn, value, false, STALE);\n  if (Scheduler && Transition && Transition.running) Updates.push(c);else updateComputation(c);\n}\nfunction createEffect(fn, value, options) {\n  runEffects = runUserEffects;\n  const c = createComputation(fn, value, false, STALE),\n    s = SuspenseContext && useContext(SuspenseContext);\n  if (s) c.suspense = s;\n  if (!options || !options.render) c.user = true;\n  Effects ? Effects.push(c) : updateComputation(c);\n}\nfunction createReaction(onInvalidate, options) {\n  let fn;\n  const c = createComputation(() => {\n      fn ? fn() : untrack(onInvalidate);\n      fn = undefined;\n    }, undefined, false, 0),\n    s = SuspenseContext && useContext(SuspenseContext);\n  if (s) c.suspense = s;\n  c.user = true;\n  return tracking => {\n    fn = tracking;\n    updateComputation(c);\n  };\n}\nfunction createMemo(fn, value, options) {\n  options = options ? Object.assign({}, signalOptions, options) : signalOptions;\n  const c = createComputation(fn, value, true, 0);\n  c.observers = null;\n  c.observerSlots = null;\n  c.comparator = options.equals || undefined;\n  if (Scheduler && Transition && Transition.running) {\n    c.tState = STALE;\n    Updates.push(c);\n  } else updateComputation(c);\n  return readSignal.bind(c);\n}\nfunction isPromise(v) {\n  return v && typeof v === \"object\" && \"then\" in v;\n}\nfunction createResource(pSource, pFetcher, pOptions) {\n  let source;\n  let fetcher;\n  let options;\n  if (arguments.length === 2 && typeof pFetcher === \"object\" || arguments.length === 1) {\n    source = true;\n    fetcher = pSource;\n    options = pFetcher || {};\n  } else {\n    source = pSource;\n    fetcher = pFetcher;\n    options = pOptions || {};\n  }\n  let pr = null,\n    initP = NO_INIT,\n    id = null,\n    loadedUnderTransition = false,\n    scheduled = false,\n    resolved = (\"initialValue\" in options),\n    dynamic = typeof source === \"function\" && createMemo(source);\n  const contexts = new Set(),\n    [value, setValue] = (options.storage || createSignal)(options.initialValue),\n    [error, setError] = createSignal(undefined),\n    [track, trigger] = createSignal(undefined, {\n      equals: false\n    }),\n    [state, setState] = createSignal(resolved ? \"ready\" : \"unresolved\");\n  if (sharedConfig.context) {\n    id = sharedConfig.getNextContextId();\n    if (options.ssrLoadFrom === \"initial\") initP = options.initialValue;else if (sharedConfig.load && sharedConfig.has(id)) initP = sharedConfig.load(id);\n  }\n  function loadEnd(p, v, error, key) {\n    if (pr === p) {\n      pr = null;\n      key !== undefined && (resolved = true);\n      if ((p === initP || v === initP) && options.onHydrated) queueMicrotask(() => options.onHydrated(key, {\n        value: v\n      }));\n      initP = NO_INIT;\n      if (Transition && p && loadedUnderTransition) {\n        Transition.promises.delete(p);\n        loadedUnderTransition = false;\n        runUpdates(() => {\n          Transition.running = true;\n          completeLoad(v, error);\n        }, false);\n      } else completeLoad(v, error);\n    }\n    return v;\n  }\n  function completeLoad(v, err) {\n    runUpdates(() => {\n      if (err === undefined) setValue(() => v);\n      setState(err !== undefined ? \"errored\" : resolved ? \"ready\" : \"unresolved\");\n      setError(err);\n      for (const c of contexts.keys()) c.decrement();\n      contexts.clear();\n    }, false);\n  }\n  function read() {\n    const c = SuspenseContext && useContext(SuspenseContext),\n      v = value(),\n      err = error();\n    if (err !== undefined && !pr) throw err;\n    if (Listener && !Listener.user && c) {\n      createComputed(() => {\n        track();\n        if (pr) {\n          if (c.resolved && Transition && loadedUnderTransition) Transition.promises.add(pr);else if (!contexts.has(c)) {\n            c.increment();\n            contexts.add(c);\n          }\n        }\n      });\n    }\n    return v;\n  }\n  function load(refetching = true) {\n    if (refetching !== false && scheduled) return;\n    scheduled = false;\n    const lookup = dynamic ? dynamic() : source;\n    loadedUnderTransition = Transition && Transition.running;\n    if (lookup == null || lookup === false) {\n      loadEnd(pr, untrack(value));\n      return;\n    }\n    if (Transition && pr) Transition.promises.delete(pr);\n    const p = initP !== NO_INIT ? initP : untrack(() => fetcher(lookup, {\n      value: value(),\n      refetching\n    }));\n    if (!isPromise(p)) {\n      loadEnd(pr, p, undefined, lookup);\n      return p;\n    }\n    pr = p;\n    if (\"value\" in p) {\n      if (p.status === \"success\") loadEnd(pr, p.value, undefined, lookup);else loadEnd(pr, undefined, castError(p.value), lookup);\n      return p;\n    }\n    scheduled = true;\n    queueMicrotask(() => scheduled = false);\n    runUpdates(() => {\n      setState(resolved ? \"refreshing\" : \"pending\");\n      trigger();\n    }, false);\n    return p.then(v => loadEnd(p, v, undefined, lookup), e => loadEnd(p, undefined, castError(e), lookup));\n  }\n  Object.defineProperties(read, {\n    state: {\n      get: () => state()\n    },\n    error: {\n      get: () => error()\n    },\n    loading: {\n      get() {\n        const s = state();\n        return s === \"pending\" || s === \"refreshing\";\n      }\n    },\n    latest: {\n      get() {\n        if (!resolved) return read();\n        const err = error();\n        if (err && !pr) throw err;\n        return value();\n      }\n    }\n  });\n  if (dynamic) createComputed(() => load(false));else load(false);\n  return [read, {\n    refetch: load,\n    mutate: setValue\n  }];\n}\nfunction createDeferred(source, options) {\n  let t,\n    timeout = options ? options.timeoutMs : undefined;\n  const node = createComputation(() => {\n    if (!t || !t.fn) t = requestCallback(() => setDeferred(() => node.value), timeout !== undefined ? {\n      timeout\n    } : undefined);\n    return source();\n  }, undefined, true);\n  const [deferred, setDeferred] = createSignal(Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value, options);\n  updateComputation(node);\n  setDeferred(() => Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value);\n  return deferred;\n}\nfunction createSelector(source, fn = equalFn, options) {\n  const subs = new Map();\n  const node = createComputation(p => {\n    const v = source();\n    for (const [key, val] of subs.entries()) if (fn(key, v) !== fn(key, p)) {\n      for (const c of val.values()) {\n        c.state = STALE;\n        if (c.pure) Updates.push(c);else Effects.push(c);\n      }\n    }\n    return v;\n  }, undefined, true, STALE);\n  updateComputation(node);\n  return key => {\n    const listener = Listener;\n    if (listener) {\n      let l;\n      if (l = subs.get(key)) l.add(listener);else subs.set(key, l = new Set([listener]));\n      onCleanup(() => {\n        l.delete(listener);\n        !l.size && subs.delete(key);\n      });\n    }\n    return fn(key, Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value);\n  };\n}\nfunction batch(fn) {\n  return runUpdates(fn, false);\n}\nfunction untrack(fn) {\n  if (!ExternalSourceConfig && Listener === null) return fn();\n  const listener = Listener;\n  Listener = null;\n  try {\n    if (ExternalSourceConfig) return ExternalSourceConfig.untrack(fn);\n    return fn();\n  } finally {\n    Listener = listener;\n  }\n}\nfunction on(deps, fn, options) {\n  const isArray = Array.isArray(deps);\n  let prevInput;\n  let defer = options && options.defer;\n  return prevValue => {\n    let input;\n    if (isArray) {\n      input = Array(deps.length);\n      for (let i = 0; i < deps.length; i++) input[i] = deps[i]();\n    } else input = deps();\n    if (defer) {\n      defer = false;\n      return prevValue;\n    }\n    const result = untrack(() => fn(input, prevInput, prevValue));\n    prevInput = input;\n    return result;\n  };\n}\nfunction onMount(fn) {\n  createEffect(() => untrack(fn));\n}\nfunction onCleanup(fn) {\n  if (Owner === null) ;else if (Owner.cleanups === null) Owner.cleanups = [fn];else Owner.cleanups.push(fn);\n  return fn;\n}\nfunction catchError(fn, handler) {\n  ERROR || (ERROR = Symbol(\"error\"));\n  Owner = createComputation(undefined, undefined, true);\n  Owner.context = {\n    ...Owner.context,\n    [ERROR]: [handler]\n  };\n  if (Transition && Transition.running) Transition.sources.add(Owner);\n  try {\n    return fn();\n  } catch (err) {\n    handleError(err);\n  } finally {\n    Owner = Owner.owner;\n  }\n}\nfunction getListener() {\n  return Listener;\n}\nfunction getOwner() {\n  return Owner;\n}\nfunction runWithOwner(o, fn) {\n  const prev = Owner;\n  const prevListener = Listener;\n  Owner = o;\n  Listener = null;\n  try {\n    return runUpdates(fn, true);\n  } catch (err) {\n    handleError(err);\n  } finally {\n    Owner = prev;\n    Listener = prevListener;\n  }\n}\nfunction enableScheduling(scheduler = requestCallback) {\n  Scheduler = scheduler;\n}\nfunction startTransition(fn) {\n  if (Transition && Transition.running) {\n    fn();\n    return Transition.done;\n  }\n  const l = Listener;\n  const o = Owner;\n  return Promise.resolve().then(() => {\n    Listener = l;\n    Owner = o;\n    let t;\n    if (Scheduler || SuspenseContext) {\n      t = Transition || (Transition = {\n        sources: new Set(),\n        effects: [],\n        promises: new Set(),\n        disposed: new Set(),\n        queue: new Set(),\n        running: true\n      });\n      t.done || (t.done = new Promise(res => t.resolve = res));\n      t.running = true;\n    }\n    runUpdates(fn, false);\n    Listener = Owner = null;\n    return t ? t.done : undefined;\n  });\n}\nconst [transPending, setTransPending] = /*@__PURE__*/createSignal(false);\nfunction useTransition() {\n  return [transPending, startTransition];\n}\nfunction resumeEffects(e) {\n  Effects.push.apply(Effects, e);\n  e.length = 0;\n}\nfunction createContext(defaultValue, options) {\n  const id = Symbol(\"context\");\n  return {\n    id,\n    Provider: createProvider(id),\n    defaultValue\n  };\n}\nfunction useContext(context) {\n  let value;\n  return Owner && Owner.context && (value = Owner.context[context.id]) !== undefined ? value : context.defaultValue;\n}\nfunction children(fn) {\n  const children = createMemo(fn);\n  const memo = createMemo(() => resolveChildren(children()));\n  memo.toArray = () => {\n    const c = memo();\n    return Array.isArray(c) ? c : c != null ? [c] : [];\n  };\n  return memo;\n}\nlet SuspenseContext;\nfunction getSuspenseContext() {\n  return SuspenseContext || (SuspenseContext = createContext());\n}\nfunction enableExternalSource(factory, untrack = fn => fn()) {\n  if (ExternalSourceConfig) {\n    const {\n      factory: oldFactory,\n      untrack: oldUntrack\n    } = ExternalSourceConfig;\n    ExternalSourceConfig = {\n      factory: (fn, trigger) => {\n        const oldSource = oldFactory(fn, trigger);\n        const source = factory(x => oldSource.track(x), trigger);\n        return {\n          track: x => source.track(x),\n          dispose() {\n            source.dispose();\n            oldSource.dispose();\n          }\n        };\n      },\n      untrack: fn => oldUntrack(() => untrack(fn))\n    };\n  } else {\n    ExternalSourceConfig = {\n      factory,\n      untrack\n    };\n  }\n}\nfunction readSignal() {\n  const runningTransition = Transition && Transition.running;\n  if (this.sources && (runningTransition ? this.tState : this.state)) {\n    if ((runningTransition ? this.tState : this.state) === STALE) updateComputation(this);else {\n      const updates = Updates;\n      Updates = null;\n      runUpdates(() => lookUpstream(this), false);\n      Updates = updates;\n    }\n  }\n  if (Listener) {\n    const sSlot = this.observers ? this.observers.length : 0;\n    if (!Listener.sources) {\n      Listener.sources = [this];\n      Listener.sourceSlots = [sSlot];\n    } else {\n      Listener.sources.push(this);\n      Listener.sourceSlots.push(sSlot);\n    }\n    if (!this.observers) {\n      this.observers = [Listener];\n      this.observerSlots = [Listener.sources.length - 1];\n    } else {\n      this.observers.push(Listener);\n      this.observerSlots.push(Listener.sources.length - 1);\n    }\n  }\n  if (runningTransition && Transition.sources.has(this)) return this.tValue;\n  return this.value;\n}\nfunction writeSignal(node, value, isComp) {\n  let current = Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value;\n  if (!node.comparator || !node.comparator(current, value)) {\n    if (Transition) {\n      const TransitionRunning = Transition.running;\n      if (TransitionRunning || !isComp && Transition.sources.has(node)) {\n        Transition.sources.add(node);\n        node.tValue = value;\n      }\n      if (!TransitionRunning) node.value = value;\n    } else node.value = value;\n    if (node.observers && node.observers.length) {\n      runUpdates(() => {\n        for (let i = 0; i < node.observers.length; i += 1) {\n          const o = node.observers[i];\n          const TransitionRunning = Transition && Transition.running;\n          if (TransitionRunning && Transition.disposed.has(o)) continue;\n          if (TransitionRunning ? !o.tState : !o.state) {\n            if (o.pure) Updates.push(o);else Effects.push(o);\n            if (o.observers) markDownstream(o);\n          }\n          if (!TransitionRunning) o.state = STALE;else o.tState = STALE;\n        }\n        if (Updates.length > 10e5) {\n          Updates = [];\n          if (false) ;\n          throw new Error();\n        }\n      }, false);\n    }\n  }\n  return value;\n}\nfunction updateComputation(node) {\n  if (!node.fn) return;\n  cleanNode(node);\n  const time = ExecCount;\n  runComputation(node, Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value, time);\n  if (Transition && !Transition.running && Transition.sources.has(node)) {\n    queueMicrotask(() => {\n      runUpdates(() => {\n        Transition && (Transition.running = true);\n        Listener = Owner = node;\n        runComputation(node, node.tValue, time);\n        Listener = Owner = null;\n      }, false);\n    });\n  }\n}\nfunction runComputation(node, value, time) {\n  let nextValue;\n  const owner = Owner,\n    listener = Listener;\n  Listener = Owner = node;\n  try {\n    nextValue = node.fn(value);\n  } catch (err) {\n    if (node.pure) {\n      if (Transition && Transition.running) {\n        node.tState = STALE;\n        node.tOwned && node.tOwned.forEach(cleanNode);\n        node.tOwned = undefined;\n      } else {\n        node.state = STALE;\n        node.owned && node.owned.forEach(cleanNode);\n        node.owned = null;\n      }\n    }\n    node.updatedAt = time + 1;\n    return handleError(err);\n  } finally {\n    Listener = listener;\n    Owner = owner;\n  }\n  if (!node.updatedAt || node.updatedAt <= time) {\n    if (node.updatedAt != null && \"observers\" in node) {\n      writeSignal(node, nextValue, true);\n    } else if (Transition && Transition.running && node.pure) {\n      Transition.sources.add(node);\n      node.tValue = nextValue;\n    } else node.value = nextValue;\n    node.updatedAt = time;\n  }\n}\nfunction createComputation(fn, init, pure, state = STALE, options) {\n  const c = {\n    fn,\n    state: state,\n    updatedAt: null,\n    owned: null,\n    sources: null,\n    sourceSlots: null,\n    cleanups: null,\n    value: init,\n    owner: Owner,\n    context: Owner ? Owner.context : null,\n    pure\n  };\n  if (Transition && Transition.running) {\n    c.state = 0;\n    c.tState = state;\n  }\n  if (Owner === null) ;else if (Owner !== UNOWNED) {\n    if (Transition && Transition.running && Owner.pure) {\n      if (!Owner.tOwned) Owner.tOwned = [c];else Owner.tOwned.push(c);\n    } else {\n      if (!Owner.owned) Owner.owned = [c];else Owner.owned.push(c);\n    }\n  }\n  if (ExternalSourceConfig && c.fn) {\n    const [track, trigger] = createSignal(undefined, {\n      equals: false\n    });\n    const ordinary = ExternalSourceConfig.factory(c.fn, trigger);\n    onCleanup(() => ordinary.dispose());\n    const triggerInTransition = () => startTransition(trigger).then(() => inTransition.dispose());\n    const inTransition = ExternalSourceConfig.factory(c.fn, triggerInTransition);\n    c.fn = x => {\n      track();\n      return Transition && Transition.running ? inTransition.track(x) : ordinary.track(x);\n    };\n  }\n  return c;\n}\nfunction runTop(node) {\n  const runningTransition = Transition && Transition.running;\n  if ((runningTransition ? node.tState : node.state) === 0) return;\n  if ((runningTransition ? node.tState : node.state) === PENDING) return lookUpstream(node);\n  if (node.suspense && untrack(node.suspense.inFallback)) return node.suspense.effects.push(node);\n  const ancestors = [node];\n  while ((node = node.owner) && (!node.updatedAt || node.updatedAt < ExecCount)) {\n    if (runningTransition && Transition.disposed.has(node)) return;\n    if (runningTransition ? node.tState : node.state) ancestors.push(node);\n  }\n  for (let i = ancestors.length - 1; i >= 0; i--) {\n    node = ancestors[i];\n    if (runningTransition) {\n      let top = node,\n        prev = ancestors[i + 1];\n      while ((top = top.owner) && top !== prev) {\n        if (Transition.disposed.has(top)) return;\n      }\n    }\n    if ((runningTransition ? node.tState : node.state) === STALE) {\n      updateComputation(node);\n    } else if ((runningTransition ? node.tState : node.state) === PENDING) {\n      const updates = Updates;\n      Updates = null;\n      runUpdates(() => lookUpstream(node, ancestors[0]), false);\n      Updates = updates;\n    }\n  }\n}\nfunction runUpdates(fn, init) {\n  if (Updates) return fn();\n  let wait = false;\n  if (!init) Updates = [];\n  if (Effects) wait = true;else Effects = [];\n  ExecCount++;\n  try {\n    const res = fn();\n    completeUpdates(wait);\n    return res;\n  } catch (err) {\n    if (!wait) Effects = null;\n    Updates = null;\n    handleError(err);\n  }\n}\nfunction completeUpdates(wait) {\n  if (Updates) {\n    if (Scheduler && Transition && Transition.running) scheduleQueue(Updates);else runQueue(Updates);\n    Updates = null;\n  }\n  if (wait) return;\n  let res;\n  if (Transition) {\n    if (!Transition.promises.size && !Transition.queue.size) {\n      const sources = Transition.sources;\n      const disposed = Transition.disposed;\n      Effects.push.apply(Effects, Transition.effects);\n      res = Transition.resolve;\n      for (const e of Effects) {\n        \"tState\" in e && (e.state = e.tState);\n        delete e.tState;\n      }\n      Transition = null;\n      runUpdates(() => {\n        for (const d of disposed) cleanNode(d);\n        for (const v of sources) {\n          v.value = v.tValue;\n          if (v.owned) {\n            for (let i = 0, len = v.owned.length; i < len; i++) cleanNode(v.owned[i]);\n          }\n          if (v.tOwned) v.owned = v.tOwned;\n          delete v.tValue;\n          delete v.tOwned;\n          v.tState = 0;\n        }\n        setTransPending(false);\n      }, false);\n    } else if (Transition.running) {\n      Transition.running = false;\n      Transition.effects.push.apply(Transition.effects, Effects);\n      Effects = null;\n      setTransPending(true);\n      return;\n    }\n  }\n  const e = Effects;\n  Effects = null;\n  if (e.length) runUpdates(() => runEffects(e), false);\n  if (res) res();\n}\nfunction runQueue(queue) {\n  for (let i = 0; i < queue.length; i++) runTop(queue[i]);\n}\nfunction scheduleQueue(queue) {\n  for (let i = 0; i < queue.length; i++) {\n    const item = queue[i];\n    const tasks = Transition.queue;\n    if (!tasks.has(item)) {\n      tasks.add(item);\n      Scheduler(() => {\n        tasks.delete(item);\n        runUpdates(() => {\n          Transition.running = true;\n          runTop(item);\n        }, false);\n        Transition && (Transition.running = false);\n      });\n    }\n  }\n}\nfunction runUserEffects(queue) {\n  let i,\n    userLength = 0;\n  for (i = 0; i < queue.length; i++) {\n    const e = queue[i];\n    if (!e.user) runTop(e);else queue[userLength++] = e;\n  }\n  if (sharedConfig.context) {\n    if (sharedConfig.count) {\n      sharedConfig.effects || (sharedConfig.effects = []);\n      sharedConfig.effects.push(...queue.slice(0, userLength));\n      return;\n    }\n    setHydrateContext();\n  }\n  if (sharedConfig.effects && (sharedConfig.done || !sharedConfig.count)) {\n    queue = [...sharedConfig.effects, ...queue];\n    userLength += sharedConfig.effects.length;\n    delete sharedConfig.effects;\n  }\n  for (i = 0; i < userLength; i++) runTop(queue[i]);\n}\nfunction lookUpstream(node, ignore) {\n  const runningTransition = Transition && Transition.running;\n  if (runningTransition) node.tState = 0;else node.state = 0;\n  for (let i = 0; i < node.sources.length; i += 1) {\n    const source = node.sources[i];\n    if (source.sources) {\n      const state = runningTransition ? source.tState : source.state;\n      if (state === STALE) {\n        if (source !== ignore && (!source.updatedAt || source.updatedAt < ExecCount)) runTop(source);\n      } else if (state === PENDING) lookUpstream(source, ignore);\n    }\n  }\n}\nfunction markDownstream(node) {\n  const runningTransition = Transition && Transition.running;\n  for (let i = 0; i < node.observers.length; i += 1) {\n    const o = node.observers[i];\n    if (runningTransition ? !o.tState : !o.state) {\n      if (runningTransition) o.tState = PENDING;else o.state = PENDING;\n      if (o.pure) Updates.push(o);else Effects.push(o);\n      o.observers && markDownstream(o);\n    }\n  }\n}\nfunction cleanNode(node) {\n  let i;\n  if (node.sources) {\n    while (node.sources.length) {\n      const source = node.sources.pop(),\n        index = node.sourceSlots.pop(),\n        obs = source.observers;\n      if (obs && obs.length) {\n        const n = obs.pop(),\n          s = source.observerSlots.pop();\n        if (index < obs.length) {\n          n.sourceSlots[s] = index;\n          obs[index] = n;\n          source.observerSlots[index] = s;\n        }\n      }\n    }\n  }\n  if (Transition && Transition.running && node.pure) {\n    if (node.tOwned) {\n      for (i = node.tOwned.length - 1; i >= 0; i--) cleanNode(node.tOwned[i]);\n      delete node.tOwned;\n    }\n    reset(node, true);\n  } else if (node.owned) {\n    for (i = node.owned.length - 1; i >= 0; i--) cleanNode(node.owned[i]);\n    node.owned = null;\n  }\n  if (node.cleanups) {\n    for (i = node.cleanups.length - 1; i >= 0; i--) node.cleanups[i]();\n    node.cleanups = null;\n  }\n  if (Transition && Transition.running) node.tState = 0;else node.state = 0;\n}\nfunction reset(node, top) {\n  if (!top) {\n    node.tState = 0;\n    Transition.disposed.add(node);\n  }\n  if (node.owned) {\n    for (let i = 0; i < node.owned.length; i++) reset(node.owned[i]);\n  }\n}\nfunction castError(err) {\n  if (err instanceof Error) return err;\n  return new Error(typeof err === \"string\" ? err : \"Unknown error\", {\n    cause: err\n  });\n}\nfunction runErrors(err, fns, owner) {\n  try {\n    for (const f of fns) f(err);\n  } catch (e) {\n    handleError(e, owner && owner.owner || null);\n  }\n}\nfunction handleError(err, owner = Owner) {\n  const fns = ERROR && owner && owner.context && owner.context[ERROR];\n  const error = castError(err);\n  if (!fns) throw error;\n  if (Effects) Effects.push({\n    fn() {\n      runErrors(error, fns, owner);\n    },\n    state: STALE\n  });else runErrors(error, fns, owner);\n}\nfunction resolveChildren(children) {\n  if (typeof children === \"function\" && !children.length) return resolveChildren(children());\n  if (Array.isArray(children)) {\n    const results = [];\n    for (let i = 0; i < children.length; i++) {\n      const result = resolveChildren(children[i]);\n      Array.isArray(result) ? results.push.apply(results, result) : results.push(result);\n    }\n    return results;\n  }\n  return children;\n}\nfunction createProvider(id, options) {\n  return function provider(props) {\n    let res;\n    createRenderEffect(() => res = untrack(() => {\n      Owner.context = {\n        ...Owner.context,\n        [id]: props.value\n      };\n      return children(() => props.children);\n    }), undefined);\n    return res;\n  };\n}\nfunction onError(fn) {\n  ERROR || (ERROR = Symbol(\"error\"));\n  if (Owner === null) ;else if (Owner.context === null || !Owner.context[ERROR]) {\n    Owner.context = {\n      ...Owner.context,\n      [ERROR]: [fn]\n    };\n    mutateContext(Owner, ERROR, [fn]);\n  } else Owner.context[ERROR].push(fn);\n}\nfunction mutateContext(o, key, value) {\n  if (o.owned) {\n    for (let i = 0; i < o.owned.length; i++) {\n      if (o.owned[i].context === o.context) mutateContext(o.owned[i], key, value);\n      if (!o.owned[i].context) {\n        o.owned[i].context = o.context;\n        mutateContext(o.owned[i], key, value);\n      } else if (!o.owned[i].context[key]) {\n        o.owned[i].context[key] = value;\n        mutateContext(o.owned[i], key, value);\n      }\n    }\n  }\n}\n\nfunction observable(input) {\n  return {\n    subscribe(observer) {\n      if (!(observer instanceof Object) || observer == null) {\n        throw new TypeError(\"Expected the observer to be an object.\");\n      }\n      const handler = typeof observer === \"function\" ? observer : observer.next && observer.next.bind(observer);\n      if (!handler) {\n        return {\n          unsubscribe() {}\n        };\n      }\n      const dispose = createRoot(disposer => {\n        createEffect(() => {\n          const v = input();\n          untrack(() => handler(v));\n        });\n        return disposer;\n      });\n      if (getOwner()) onCleanup(dispose);\n      return {\n        unsubscribe() {\n          dispose();\n        }\n      };\n    },\n    [Symbol.observable || \"@@observable\"]() {\n      return this;\n    }\n  };\n}\nfunction from(producer) {\n  const [s, set] = createSignal(undefined, {\n    equals: false\n  });\n  if (\"subscribe\" in producer) {\n    const unsub = producer.subscribe(v => set(() => v));\n    onCleanup(() => \"unsubscribe\" in unsub ? unsub.unsubscribe() : unsub());\n  } else {\n    const clean = producer(set);\n    onCleanup(clean);\n  }\n  return s;\n}\n\nconst FALLBACK = Symbol(\"fallback\");\nfunction dispose(d) {\n  for (let i = 0; i < d.length; i++) d[i]();\n}\nfunction mapArray(list, mapFn, options = {}) {\n  let items = [],\n    mapped = [],\n    disposers = [],\n    len = 0,\n    indexes = mapFn.length > 1 ? [] : null;\n  onCleanup(() => dispose(disposers));\n  return () => {\n    let newItems = list() || [],\n      newLen = newItems.length,\n      i,\n      j;\n    newItems[$TRACK];\n    return untrack(() => {\n      let newIndices, newIndicesNext, temp, tempdisposers, tempIndexes, start, end, newEnd, item;\n      if (newLen === 0) {\n        if (len !== 0) {\n          dispose(disposers);\n          disposers = [];\n          items = [];\n          mapped = [];\n          len = 0;\n          indexes && (indexes = []);\n        }\n        if (options.fallback) {\n          items = [FALLBACK];\n          mapped[0] = createRoot(disposer => {\n            disposers[0] = disposer;\n            return options.fallback();\n          });\n          len = 1;\n        }\n      }\n      else if (len === 0) {\n        mapped = new Array(newLen);\n        for (j = 0; j < newLen; j++) {\n          items[j] = newItems[j];\n          mapped[j] = createRoot(mapper);\n        }\n        len = newLen;\n      } else {\n        temp = new Array(newLen);\n        tempdisposers = new Array(newLen);\n        indexes && (tempIndexes = new Array(newLen));\n        for (start = 0, end = Math.min(len, newLen); start < end && items[start] === newItems[start]; start++);\n        for (end = len - 1, newEnd = newLen - 1; end >= start && newEnd >= start && items[end] === newItems[newEnd]; end--, newEnd--) {\n          temp[newEnd] = mapped[end];\n          tempdisposers[newEnd] = disposers[end];\n          indexes && (tempIndexes[newEnd] = indexes[end]);\n        }\n        newIndices = new Map();\n        newIndicesNext = new Array(newEnd + 1);\n        for (j = newEnd; j >= start; j--) {\n          item = newItems[j];\n          i = newIndices.get(item);\n          newIndicesNext[j] = i === undefined ? -1 : i;\n          newIndices.set(item, j);\n        }\n        for (i = start; i <= end; i++) {\n          item = items[i];\n          j = newIndices.get(item);\n          if (j !== undefined && j !== -1) {\n            temp[j] = mapped[i];\n            tempdisposers[j] = disposers[i];\n            indexes && (tempIndexes[j] = indexes[i]);\n            j = newIndicesNext[j];\n            newIndices.set(item, j);\n          } else disposers[i]();\n        }\n        for (j = start; j < newLen; j++) {\n          if (j in temp) {\n            mapped[j] = temp[j];\n            disposers[j] = tempdisposers[j];\n            if (indexes) {\n              indexes[j] = tempIndexes[j];\n              indexes[j](j);\n            }\n          } else mapped[j] = createRoot(mapper);\n        }\n        mapped = mapped.slice(0, len = newLen);\n        items = newItems.slice(0);\n      }\n      return mapped;\n    });\n    function mapper(disposer) {\n      disposers[j] = disposer;\n      if (indexes) {\n        const [s, set] = createSignal(j);\n        indexes[j] = set;\n        return mapFn(newItems[j], s);\n      }\n      return mapFn(newItems[j]);\n    }\n  };\n}\nfunction indexArray(list, mapFn, options = {}) {\n  let items = [],\n    mapped = [],\n    disposers = [],\n    signals = [],\n    len = 0,\n    i;\n  onCleanup(() => dispose(disposers));\n  return () => {\n    const newItems = list() || [],\n      newLen = newItems.length;\n    newItems[$TRACK];\n    return untrack(() => {\n      if (newLen === 0) {\n        if (len !== 0) {\n          dispose(disposers);\n          disposers = [];\n          items = [];\n          mapped = [];\n          len = 0;\n          signals = [];\n        }\n        if (options.fallback) {\n          items = [FALLBACK];\n          mapped[0] = createRoot(disposer => {\n            disposers[0] = disposer;\n            return options.fallback();\n          });\n          len = 1;\n        }\n        return mapped;\n      }\n      if (items[0] === FALLBACK) {\n        disposers[0]();\n        disposers = [];\n        items = [];\n        mapped = [];\n        len = 0;\n      }\n      for (i = 0; i < newLen; i++) {\n        if (i < items.length && items[i] !== newItems[i]) {\n          signals[i](() => newItems[i]);\n        } else if (i >= items.length) {\n          mapped[i] = createRoot(mapper);\n        }\n      }\n      for (; i < items.length; i++) {\n        disposers[i]();\n      }\n      len = signals.length = disposers.length = newLen;\n      items = newItems.slice(0);\n      return mapped = mapped.slice(0, len);\n    });\n    function mapper(disposer) {\n      disposers[i] = disposer;\n      const [s, set] = createSignal(newItems[i]);\n      signals[i] = set;\n      return mapFn(s, i);\n    }\n  };\n}\n\nlet hydrationEnabled = false;\nfunction enableHydration() {\n  hydrationEnabled = true;\n}\nfunction createComponent(Comp, props) {\n  if (hydrationEnabled) {\n    if (sharedConfig.context) {\n      const c = sharedConfig.context;\n      setHydrateContext(nextHydrateContext());\n      const r = untrack(() => Comp(props || {}));\n      setHydrateContext(c);\n      return r;\n    }\n  }\n  return untrack(() => Comp(props || {}));\n}\nfunction trueFn() {\n  return true;\n}\nconst propTraps = {\n  get(_, property, receiver) {\n    if (property === $PROXY) return receiver;\n    return _.get(property);\n  },\n  has(_, property) {\n    if (property === $PROXY) return true;\n    return _.has(property);\n  },\n  set: trueFn,\n  deleteProperty: trueFn,\n  getOwnPropertyDescriptor(_, property) {\n    return {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return _.get(property);\n      },\n      set: trueFn,\n      deleteProperty: trueFn\n    };\n  },\n  ownKeys(_) {\n    return _.keys();\n  }\n};\nfunction resolveSource(s) {\n  return !(s = typeof s === \"function\" ? s() : s) ? {} : s;\n}\nfunction resolveSources() {\n  for (let i = 0, length = this.length; i < length; ++i) {\n    const v = this[i]();\n    if (v !== undefined) return v;\n  }\n}\nfunction mergeProps(...sources) {\n  let proxy = false;\n  for (let i = 0; i < sources.length; i++) {\n    const s = sources[i];\n    proxy = proxy || !!s && $PROXY in s;\n    sources[i] = typeof s === \"function\" ? (proxy = true, createMemo(s)) : s;\n  }\n  if (proxy) {\n    return new Proxy({\n      get(property) {\n        for (let i = sources.length - 1; i >= 0; i--) {\n          const v = resolveSource(sources[i])[property];\n          if (v !== undefined) return v;\n        }\n      },\n      has(property) {\n        for (let i = sources.length - 1; i >= 0; i--) {\n          if (property in resolveSource(sources[i])) return true;\n        }\n        return false;\n      },\n      keys() {\n        const keys = [];\n        for (let i = 0; i < sources.length; i++) keys.push(...Object.keys(resolveSource(sources[i])));\n        return [...new Set(keys)];\n      }\n    }, propTraps);\n  }\n  const sourcesMap = {};\n  const defined = Object.create(null);\n  for (let i = sources.length - 1; i >= 0; i--) {\n    const source = sources[i];\n    if (!source) continue;\n    const sourceKeys = Object.getOwnPropertyNames(source);\n    for (let i = sourceKeys.length - 1; i >= 0; i--) {\n      const key = sourceKeys[i];\n      if (key === \"__proto__\" || key === \"constructor\") continue;\n      const desc = Object.getOwnPropertyDescriptor(source, key);\n      if (!defined[key]) {\n        defined[key] = desc.get ? {\n          enumerable: true,\n          configurable: true,\n          get: resolveSources.bind(sourcesMap[key] = [desc.get.bind(source)])\n        } : desc.value !== undefined ? desc : undefined;\n      } else {\n        const sources = sourcesMap[key];\n        if (sources) {\n          if (desc.get) sources.push(desc.get.bind(source));else if (desc.value !== undefined) sources.push(() => desc.value);\n        }\n      }\n    }\n  }\n  const target = {};\n  const definedKeys = Object.keys(defined);\n  for (let i = definedKeys.length - 1; i >= 0; i--) {\n    const key = definedKeys[i],\n      desc = defined[key];\n    if (desc && desc.get) Object.defineProperty(target, key, desc);else target[key] = desc ? desc.value : undefined;\n  }\n  return target;\n}\nfunction splitProps(props, ...keys) {\n  if ($PROXY in props) {\n    const blocked = new Set(keys.length > 1 ? keys.flat() : keys[0]);\n    const res = keys.map(k => {\n      return new Proxy({\n        get(property) {\n          return k.includes(property) ? props[property] : undefined;\n        },\n        has(property) {\n          return k.includes(property) && property in props;\n        },\n        keys() {\n          return k.filter(property => property in props);\n        }\n      }, propTraps);\n    });\n    res.push(new Proxy({\n      get(property) {\n        return blocked.has(property) ? undefined : props[property];\n      },\n      has(property) {\n        return blocked.has(property) ? false : property in props;\n      },\n      keys() {\n        return Object.keys(props).filter(k => !blocked.has(k));\n      }\n    }, propTraps));\n    return res;\n  }\n  const otherObject = {};\n  const objects = keys.map(() => ({}));\n  for (const propName of Object.getOwnPropertyNames(props)) {\n    const desc = Object.getOwnPropertyDescriptor(props, propName);\n    const isDefaultDesc = !desc.get && !desc.set && desc.enumerable && desc.writable && desc.configurable;\n    let blocked = false;\n    let objectIndex = 0;\n    for (const k of keys) {\n      if (k.includes(propName)) {\n        blocked = true;\n        isDefaultDesc ? objects[objectIndex][propName] = desc.value : Object.defineProperty(objects[objectIndex], propName, desc);\n      }\n      ++objectIndex;\n    }\n    if (!blocked) {\n      isDefaultDesc ? otherObject[propName] = desc.value : Object.defineProperty(otherObject, propName, desc);\n    }\n  }\n  return [...objects, otherObject];\n}\nfunction lazy(fn) {\n  let comp;\n  let p;\n  const wrap = props => {\n    const ctx = sharedConfig.context;\n    if (ctx) {\n      const [s, set] = createSignal();\n      sharedConfig.count || (sharedConfig.count = 0);\n      sharedConfig.count++;\n      (p || (p = fn())).then(mod => {\n        !sharedConfig.done && setHydrateContext(ctx);\n        sharedConfig.count--;\n        set(() => mod.default);\n        setHydrateContext();\n      });\n      comp = s;\n    } else if (!comp) {\n      const [s] = createResource(() => (p || (p = fn())).then(mod => mod.default));\n      comp = s;\n    }\n    let Comp;\n    return createMemo(() => (Comp = comp()) ? untrack(() => {\n      if (false) ;\n      if (!ctx || sharedConfig.done) return Comp(props);\n      const c = sharedConfig.context;\n      setHydrateContext(ctx);\n      const r = Comp(props);\n      setHydrateContext(c);\n      return r;\n    }) : \"\");\n  };\n  wrap.preload = () => p || ((p = fn()).then(mod => comp = () => mod.default), p);\n  return wrap;\n}\nlet counter = 0;\nfunction createUniqueId() {\n  const ctx = sharedConfig.context;\n  return ctx ? sharedConfig.getNextContextId() : `cl-${counter++}`;\n}\n\nconst narrowedError = name => `Stale read from <${name}>.`;\nfunction For(props) {\n  const fallback = \"fallback\" in props && {\n    fallback: () => props.fallback\n  };\n  return createMemo(mapArray(() => props.each, props.children, fallback || undefined));\n}\nfunction Index(props) {\n  const fallback = \"fallback\" in props && {\n    fallback: () => props.fallback\n  };\n  return createMemo(indexArray(() => props.each, props.children, fallback || undefined));\n}\nfunction Show(props) {\n  const keyed = props.keyed;\n  const condition = createMemo(() => props.when, undefined, {\n    equals: (a, b) => keyed ? a === b : !a === !b\n  });\n  return createMemo(() => {\n    const c = condition();\n    if (c) {\n      const child = props.children;\n      const fn = typeof child === \"function\" && child.length > 0;\n      return fn ? untrack(() => child(keyed ? c : () => {\n        if (!untrack(condition)) throw narrowedError(\"Show\");\n        return props.when;\n      })) : child;\n    }\n    return props.fallback;\n  }, undefined, undefined);\n}\nfunction Switch(props) {\n  let keyed = false;\n  const equals = (a, b) => (keyed ? a[1] === b[1] : !a[1] === !b[1]) && a[2] === b[2];\n  const conditions = children(() => props.children),\n    evalConditions = createMemo(() => {\n      let conds = conditions();\n      if (!Array.isArray(conds)) conds = [conds];\n      for (let i = 0; i < conds.length; i++) {\n        const c = conds[i].when;\n        if (c) {\n          keyed = !!conds[i].keyed;\n          return [i, c, conds[i]];\n        }\n      }\n      return [-1];\n    }, undefined, {\n      equals\n    });\n  return createMemo(() => {\n    const [index, when, cond] = evalConditions();\n    if (index < 0) return props.fallback;\n    const c = cond.children;\n    const fn = typeof c === \"function\" && c.length > 0;\n    return fn ? untrack(() => c(keyed ? when : () => {\n      if (untrack(evalConditions)[0] !== index) throw narrowedError(\"Match\");\n      return cond.when;\n    })) : c;\n  }, undefined, undefined);\n}\nfunction Match(props) {\n  return props;\n}\nlet Errors;\nfunction resetErrorBoundaries() {\n  Errors && [...Errors].forEach(fn => fn());\n}\nfunction ErrorBoundary(props) {\n  let err;\n  if (sharedConfig.context && sharedConfig.load) err = sharedConfig.load(sharedConfig.getContextId());\n  const [errored, setErrored] = createSignal(err, undefined);\n  Errors || (Errors = new Set());\n  Errors.add(setErrored);\n  onCleanup(() => Errors.delete(setErrored));\n  return createMemo(() => {\n    let e;\n    if (e = errored()) {\n      const f = props.fallback;\n      return typeof f === \"function\" && f.length ? untrack(() => f(e, () => setErrored())) : f;\n    }\n    return catchError(() => props.children, setErrored);\n  }, undefined, undefined);\n}\n\nconst suspenseListEquals = (a, b) => a.showContent === b.showContent && a.showFallback === b.showFallback;\nconst SuspenseListContext = /* #__PURE__ */createContext();\nfunction SuspenseList(props) {\n  let [wrapper, setWrapper] = createSignal(() => ({\n      inFallback: false\n    })),\n    show;\n  const listContext = useContext(SuspenseListContext);\n  const [registry, setRegistry] = createSignal([]);\n  if (listContext) {\n    show = listContext.register(createMemo(() => wrapper()().inFallback));\n  }\n  const resolved = createMemo(prev => {\n    const reveal = props.revealOrder,\n      tail = props.tail,\n      {\n        showContent = true,\n        showFallback = true\n      } = show ? show() : {},\n      reg = registry(),\n      reverse = reveal === \"backwards\";\n    if (reveal === \"together\") {\n      const all = reg.every(inFallback => !inFallback());\n      const res = reg.map(() => ({\n        showContent: all && showContent,\n        showFallback\n      }));\n      res.inFallback = !all;\n      return res;\n    }\n    let stop = false;\n    let inFallback = prev.inFallback;\n    const res = [];\n    for (let i = 0, len = reg.length; i < len; i++) {\n      const n = reverse ? len - i - 1 : i,\n        s = reg[n]();\n      if (!stop && !s) {\n        res[n] = {\n          showContent,\n          showFallback\n        };\n      } else {\n        const next = !stop;\n        if (next) inFallback = true;\n        res[n] = {\n          showContent: next,\n          showFallback: !tail || next && tail === \"collapsed\" ? showFallback : false\n        };\n        stop = true;\n      }\n    }\n    if (!stop) inFallback = false;\n    res.inFallback = inFallback;\n    return res;\n  }, {\n    inFallback: false\n  });\n  setWrapper(() => resolved);\n  return createComponent(SuspenseListContext.Provider, {\n    value: {\n      register: inFallback => {\n        let index;\n        setRegistry(registry => {\n          index = registry.length;\n          return [...registry, inFallback];\n        });\n        return createMemo(() => resolved()[index], undefined, {\n          equals: suspenseListEquals\n        });\n      }\n    },\n    get children() {\n      return props.children;\n    }\n  });\n}\nfunction Suspense(props) {\n  let counter = 0,\n    show,\n    ctx,\n    p,\n    flicker,\n    error;\n  const [inFallback, setFallback] = createSignal(false),\n    SuspenseContext = getSuspenseContext(),\n    store = {\n      increment: () => {\n        if (++counter === 1) setFallback(true);\n      },\n      decrement: () => {\n        if (--counter === 0) setFallback(false);\n      },\n      inFallback,\n      effects: [],\n      resolved: false\n    },\n    owner = getOwner();\n  if (sharedConfig.context && sharedConfig.load) {\n    const key = sharedConfig.getContextId();\n    let ref = sharedConfig.load(key);\n    if (ref) {\n      if (typeof ref !== \"object\" || ref.status !== \"success\") p = ref;else sharedConfig.gather(key);\n    }\n    if (p && p !== \"$$f\") {\n      const [s, set] = createSignal(undefined, {\n        equals: false\n      });\n      flicker = s;\n      p.then(() => {\n        if (sharedConfig.done) return set();\n        sharedConfig.gather(key);\n        setHydrateContext(ctx);\n        set();\n        setHydrateContext();\n      }, err => {\n        error = err;\n        set();\n      });\n    }\n  }\n  const listContext = useContext(SuspenseListContext);\n  if (listContext) show = listContext.register(store.inFallback);\n  let dispose;\n  onCleanup(() => dispose && dispose());\n  return createComponent(SuspenseContext.Provider, {\n    value: store,\n    get children() {\n      return createMemo(() => {\n        if (error) throw error;\n        ctx = sharedConfig.context;\n        if (flicker) {\n          flicker();\n          return flicker = undefined;\n        }\n        if (ctx && p === \"$$f\") setHydrateContext();\n        const rendered = createMemo(() => props.children);\n        return createMemo(prev => {\n          const inFallback = store.inFallback(),\n            {\n              showContent = true,\n              showFallback = true\n            } = show ? show() : {};\n          if ((!inFallback || p && p !== \"$$f\") && showContent) {\n            store.resolved = true;\n            dispose && dispose();\n            dispose = ctx = p = undefined;\n            resumeEffects(store.effects);\n            return rendered();\n          }\n          if (!showFallback) return;\n          if (dispose) return prev;\n          return createRoot(disposer => {\n            dispose = disposer;\n            if (ctx) {\n              setHydrateContext({\n                id: ctx.id + \"F\",\n                count: 0\n              });\n              ctx = undefined;\n            }\n            return props.fallback;\n          }, owner);\n        });\n      });\n    }\n  });\n}\n\nconst DEV = undefined;\n\nexport { $DEVCOMP, $PROXY, $TRACK, DEV, ErrorBoundary, For, Index, Match, Show, Suspense, SuspenseList, Switch, batch, cancelCallback, catchError, children, createComponent, createComputed, createContext, createDeferred, createEffect, createMemo, createReaction, createRenderEffect, createResource, createRoot, createSelector, createSignal, createUniqueId, enableExternalSource, enableHydration, enableScheduling, equalFn, from, getListener, getOwner, indexArray, lazy, mapArray, mergeProps, observable, on, onCleanup, onError, onMount, requestCallback, resetErrorBoundaries, runWithOwner, sharedConfig, splitProps, startTransition, untrack, useContext, useTransition };\n","import { createRoot, createRenderEffect, untrack, sharedConfig, enableHydration, getOwner, createEffect, runWithOwner, createMemo, createSignal, onCleanup, splitProps } from 'solid-js';\nexport { ErrorBoundary, For, Index, Match, Show, Suspense, SuspenseList, Switch, createComponent, createRenderEffect as effect, getOwner, createMemo as memo, mergeProps, untrack } from 'solid-js';\n\nconst booleans = [\"allowfullscreen\", \"async\", \"autofocus\", \"autoplay\", \"checked\", \"controls\", \"default\", \"disabled\", \"formnovalidate\", \"hidden\", \"indeterminate\", \"inert\", \"ismap\", \"loop\", \"multiple\", \"muted\", \"nomodule\", \"novalidate\", \"open\", \"playsinline\", \"readonly\", \"required\", \"reversed\", \"seamless\", \"selected\"];\nconst Properties = /*#__PURE__*/new Set([\"className\", \"value\", \"readOnly\", \"formNoValidate\", \"isMap\", \"noModule\", \"playsInline\", ...booleans]);\nconst ChildProperties = /*#__PURE__*/new Set([\"innerHTML\", \"textContent\", \"innerText\", \"children\"]);\nconst Aliases = /*#__PURE__*/Object.assign(Object.create(null), {\n  className: \"class\",\n  htmlFor: \"for\"\n});\nconst PropAliases = /*#__PURE__*/Object.assign(Object.create(null), {\n  class: \"className\",\n  formnovalidate: {\n    $: \"formNoValidate\",\n    BUTTON: 1,\n    INPUT: 1\n  },\n  ismap: {\n    $: \"isMap\",\n    IMG: 1\n  },\n  nomodule: {\n    $: \"noModule\",\n    SCRIPT: 1\n  },\n  playsinline: {\n    $: \"playsInline\",\n    VIDEO: 1\n  },\n  readonly: {\n    $: \"readOnly\",\n    INPUT: 1,\n    TEXTAREA: 1\n  }\n});\nfunction getPropAlias(prop, tagName) {\n  const a = PropAliases[prop];\n  return typeof a === \"object\" ? a[tagName] ? a[\"$\"] : undefined : a;\n}\nconst DelegatedEvents = /*#__PURE__*/new Set([\"beforeinput\", \"click\", \"dblclick\", \"contextmenu\", \"focusin\", \"focusout\", \"input\", \"keydown\", \"keyup\", \"mousedown\", \"mousemove\", \"mouseout\", \"mouseover\", \"mouseup\", \"pointerdown\", \"pointermove\", \"pointerout\", \"pointerover\", \"pointerup\", \"touchend\", \"touchmove\", \"touchstart\"]);\nconst SVGElements = /*#__PURE__*/new Set([\n\"altGlyph\", \"altGlyphDef\", \"altGlyphItem\", \"animate\", \"animateColor\", \"animateMotion\", \"animateTransform\", \"circle\", \"clipPath\", \"color-profile\", \"cursor\", \"defs\", \"desc\", \"ellipse\", \"feBlend\", \"feColorMatrix\", \"feComponentTransfer\", \"feComposite\", \"feConvolveMatrix\", \"feDiffuseLighting\", \"feDisplacementMap\", \"feDistantLight\", \"feDropShadow\", \"feFlood\", \"feFuncA\", \"feFuncB\", \"feFuncG\", \"feFuncR\", \"feGaussianBlur\", \"feImage\", \"feMerge\", \"feMergeNode\", \"feMorphology\", \"feOffset\", \"fePointLight\", \"feSpecularLighting\", \"feSpotLight\", \"feTile\", \"feTurbulence\", \"filter\", \"font\", \"font-face\", \"font-face-format\", \"font-face-name\", \"font-face-src\", \"font-face-uri\", \"foreignObject\", \"g\", \"glyph\", \"glyphRef\", \"hkern\", \"image\", \"line\", \"linearGradient\", \"marker\", \"mask\", \"metadata\", \"missing-glyph\", \"mpath\", \"path\", \"pattern\", \"polygon\", \"polyline\", \"radialGradient\", \"rect\",\n\"set\", \"stop\",\n\"svg\", \"switch\", \"symbol\", \"text\", \"textPath\",\n\"tref\", \"tspan\", \"use\", \"view\", \"vkern\"]);\nconst SVGNamespace = {\n  xlink: \"http://www.w3.org/1999/xlink\",\n  xml: \"http://www.w3.org/XML/1998/namespace\"\n};\nconst DOMElements = /*#__PURE__*/new Set([\"html\", \"base\", \"head\", \"link\", \"meta\", \"style\", \"title\", \"body\", \"address\", \"article\", \"aside\", \"footer\", \"header\", \"main\", \"nav\", \"section\", \"body\", \"blockquote\", \"dd\", \"div\", \"dl\", \"dt\", \"figcaption\", \"figure\", \"hr\", \"li\", \"ol\", \"p\", \"pre\", \"ul\", \"a\", \"abbr\", \"b\", \"bdi\", \"bdo\", \"br\", \"cite\", \"code\", \"data\", \"dfn\", \"em\", \"i\", \"kbd\", \"mark\", \"q\", \"rp\", \"rt\", \"ruby\", \"s\", \"samp\", \"small\", \"span\", \"strong\", \"sub\", \"sup\", \"time\", \"u\", \"var\", \"wbr\", \"area\", \"audio\", \"img\", \"map\", \"track\", \"video\", \"embed\", \"iframe\", \"object\", \"param\", \"picture\", \"portal\", \"source\", \"svg\", \"math\", \"canvas\", \"noscript\", \"script\", \"del\", \"ins\", \"caption\", \"col\", \"colgroup\", \"table\", \"tbody\", \"td\", \"tfoot\", \"th\", \"thead\", \"tr\", \"button\", \"datalist\", \"fieldset\", \"form\", \"input\", \"label\", \"legend\", \"meter\", \"optgroup\", \"option\", \"output\", \"progress\", \"select\", \"textarea\", \"details\", \"dialog\", \"menu\", \"summary\", \"details\", \"slot\", \"template\", \"acronym\", \"applet\", \"basefont\", \"bgsound\", \"big\", \"blink\", \"center\", \"content\", \"dir\", \"font\", \"frame\", \"frameset\", \"hgroup\", \"image\", \"keygen\", \"marquee\", \"menuitem\", \"nobr\", \"noembed\", \"noframes\", \"plaintext\", \"rb\", \"rtc\", \"shadow\", \"spacer\", \"strike\", \"tt\", \"xmp\", \"a\", \"abbr\", \"acronym\", \"address\", \"applet\", \"area\", \"article\", \"aside\", \"audio\", \"b\", \"base\", \"basefont\", \"bdi\", \"bdo\", \"bgsound\", \"big\", \"blink\", \"blockquote\", \"body\", \"br\", \"button\", \"canvas\", \"caption\", \"center\", \"cite\", \"code\", \"col\", \"colgroup\", \"content\", \"data\", \"datalist\", \"dd\", \"del\", \"details\", \"dfn\", \"dialog\", \"dir\", \"div\", \"dl\", \"dt\", \"em\", \"embed\", \"fieldset\", \"figcaption\", \"figure\", \"font\", \"footer\", \"form\", \"frame\", \"frameset\", \"head\", \"header\", \"hgroup\", \"hr\", \"html\", \"i\", \"iframe\", \"image\", \"img\", \"input\", \"ins\", \"kbd\", \"keygen\", \"label\", \"legend\", \"li\", \"link\", \"main\", \"map\", \"mark\", \"marquee\", \"menu\", \"menuitem\", \"meta\", \"meter\", \"nav\", \"nobr\", \"noembed\", \"noframes\", \"noscript\", \"object\", \"ol\", \"optgroup\", \"option\", \"output\", \"p\", \"param\", \"picture\", \"plaintext\", \"portal\", \"pre\", \"progress\", \"q\", \"rb\", \"rp\", \"rt\", \"rtc\", \"ruby\", \"s\", \"samp\", \"script\", \"section\", \"select\", \"shadow\", \"slot\", \"small\", \"source\", \"spacer\", \"span\", \"strike\", \"strong\", \"style\", \"sub\", \"summary\", \"sup\", \"table\", \"tbody\", \"td\", \"template\", \"textarea\", \"tfoot\", \"th\", \"thead\", \"time\", \"title\", \"tr\", \"track\", \"tt\", \"u\", \"ul\", \"var\", \"video\", \"wbr\", \"xmp\", \"input\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"]);\n\nfunction reconcileArrays(parentNode, a, b) {\n  let bLength = b.length,\n    aEnd = a.length,\n    bEnd = bLength,\n    aStart = 0,\n    bStart = 0,\n    after = a[aEnd - 1].nextSibling,\n    map = null;\n  while (aStart < aEnd || bStart < bEnd) {\n    if (a[aStart] === b[bStart]) {\n      aStart++;\n      bStart++;\n      continue;\n    }\n    while (a[aEnd - 1] === b[bEnd - 1]) {\n      aEnd--;\n      bEnd--;\n    }\n    if (aEnd === aStart) {\n      const node = bEnd < bLength ? bStart ? b[bStart - 1].nextSibling : b[bEnd - bStart] : after;\n      while (bStart < bEnd) parentNode.insertBefore(b[bStart++], node);\n    } else if (bEnd === bStart) {\n      while (aStart < aEnd) {\n        if (!map || !map.has(a[aStart])) a[aStart].remove();\n        aStart++;\n      }\n    } else if (a[aStart] === b[bEnd - 1] && b[bStart] === a[aEnd - 1]) {\n      const node = a[--aEnd].nextSibling;\n      parentNode.insertBefore(b[bStart++], a[aStart++].nextSibling);\n      parentNode.insertBefore(b[--bEnd], node);\n      a[aEnd] = b[bEnd];\n    } else {\n      if (!map) {\n        map = new Map();\n        let i = bStart;\n        while (i < bEnd) map.set(b[i], i++);\n      }\n      const index = map.get(a[aStart]);\n      if (index != null) {\n        if (bStart < index && index < bEnd) {\n          let i = aStart,\n            sequence = 1,\n            t;\n          while (++i < aEnd && i < bEnd) {\n            if ((t = map.get(a[i])) == null || t !== index + sequence) break;\n            sequence++;\n          }\n          if (sequence > index - bStart) {\n            const node = a[aStart];\n            while (bStart < index) parentNode.insertBefore(b[bStart++], node);\n          } else parentNode.replaceChild(b[bStart++], a[aStart++]);\n        } else aStart++;\n      } else a[aStart++].remove();\n    }\n  }\n}\n\nconst $$EVENTS = \"_$DX_DELEGATE\";\nfunction render(code, element, init, options = {}) {\n  let disposer;\n  createRoot(dispose => {\n    disposer = dispose;\n    element === document ? code() : insert(element, code(), element.firstChild ? null : undefined, init);\n  }, options.owner);\n  return () => {\n    disposer();\n    element.textContent = \"\";\n  };\n}\nfunction template(html, isCE, isSVG) {\n  let node;\n  const create = () => {\n    const t = document.createElement(\"template\");\n    t.innerHTML = html;\n    return isSVG ? t.content.firstChild.firstChild : t.content.firstChild;\n  };\n  const fn = isCE ? () => untrack(() => document.importNode(node || (node = create()), true)) : () => (node || (node = create())).cloneNode(true);\n  fn.cloneNode = fn;\n  return fn;\n}\nfunction delegateEvents(eventNames, document = window.document) {\n  const e = document[$$EVENTS] || (document[$$EVENTS] = new Set());\n  for (let i = 0, l = eventNames.length; i < l; i++) {\n    const name = eventNames[i];\n    if (!e.has(name)) {\n      e.add(name);\n      document.addEventListener(name, eventHandler);\n    }\n  }\n}\nfunction clearDelegatedEvents(document = window.document) {\n  if (document[$$EVENTS]) {\n    for (let name of document[$$EVENTS].keys()) document.removeEventListener(name, eventHandler);\n    delete document[$$EVENTS];\n  }\n}\nfunction setProperty(node, name, value) {\n  if (isHydrating(node)) return;\n  node[name] = value;\n}\nfunction setAttribute(node, name, value) {\n  if (isHydrating(node)) return;\n  if (value == null) node.removeAttribute(name);else node.setAttribute(name, value);\n}\nfunction setAttributeNS(node, namespace, name, value) {\n  if (isHydrating(node)) return;\n  if (value == null) node.removeAttributeNS(namespace, name);else node.setAttributeNS(namespace, name, value);\n}\nfunction className(node, value) {\n  if (isHydrating(node)) return;\n  if (value == null) node.removeAttribute(\"class\");else node.className = value;\n}\nfunction addEventListener(node, name, handler, delegate) {\n  if (delegate) {\n    if (Array.isArray(handler)) {\n      node[`$$${name}`] = handler[0];\n      node[`$$${name}Data`] = handler[1];\n    } else node[`$$${name}`] = handler;\n  } else if (Array.isArray(handler)) {\n    const handlerFn = handler[0];\n    node.addEventListener(name, handler[0] = e => handlerFn.call(node, handler[1], e));\n  } else node.addEventListener(name, handler);\n}\nfunction classList(node, value, prev = {}) {\n  const classKeys = Object.keys(value || {}),\n    prevKeys = Object.keys(prev);\n  let i, len;\n  for (i = 0, len = prevKeys.length; i < len; i++) {\n    const key = prevKeys[i];\n    if (!key || key === \"undefined\" || value[key]) continue;\n    toggleClassKey(node, key, false);\n    delete prev[key];\n  }\n  for (i = 0, len = classKeys.length; i < len; i++) {\n    const key = classKeys[i],\n      classValue = !!value[key];\n    if (!key || key === \"undefined\" || prev[key] === classValue || !classValue) continue;\n    toggleClassKey(node, key, true);\n    prev[key] = classValue;\n  }\n  return prev;\n}\nfunction style(node, value, prev) {\n  if (!value) return prev ? setAttribute(node, \"style\") : value;\n  const nodeStyle = node.style;\n  if (typeof value === \"string\") return nodeStyle.cssText = value;\n  typeof prev === \"string\" && (nodeStyle.cssText = prev = undefined);\n  prev || (prev = {});\n  value || (value = {});\n  let v, s;\n  for (s in prev) {\n    value[s] == null && nodeStyle.removeProperty(s);\n    delete prev[s];\n  }\n  for (s in value) {\n    v = value[s];\n    if (v !== prev[s]) {\n      nodeStyle.setProperty(s, v);\n      prev[s] = v;\n    }\n  }\n  return prev;\n}\nfunction spread(node, props = {}, isSVG, skipChildren) {\n  const prevProps = {};\n  if (!skipChildren) {\n    createRenderEffect(() => prevProps.children = insertExpression(node, props.children, prevProps.children));\n  }\n  createRenderEffect(() => typeof props.ref === \"function\" && use(props.ref, node));\n  createRenderEffect(() => assign(node, props, isSVG, true, prevProps, true));\n  return prevProps;\n}\nfunction dynamicProperty(props, key) {\n  const src = props[key];\n  Object.defineProperty(props, key, {\n    get() {\n      return src();\n    },\n    enumerable: true\n  });\n  return props;\n}\nfunction use(fn, element, arg) {\n  return untrack(() => fn(element, arg));\n}\nfunction insert(parent, accessor, marker, initial) {\n  if (marker !== undefined && !initial) initial = [];\n  if (typeof accessor !== \"function\") return insertExpression(parent, accessor, initial, marker);\n  createRenderEffect(current => insertExpression(parent, accessor(), current, marker), initial);\n}\nfunction assign(node, props, isSVG, skipChildren, prevProps = {}, skipRef = false) {\n  props || (props = {});\n  for (const prop in prevProps) {\n    if (!(prop in props)) {\n      if (prop === \"children\") continue;\n      prevProps[prop] = assignProp(node, prop, null, prevProps[prop], isSVG, skipRef);\n    }\n  }\n  for (const prop in props) {\n    if (prop === \"children\") {\n      if (!skipChildren) insertExpression(node, props.children);\n      continue;\n    }\n    const value = props[prop];\n    prevProps[prop] = assignProp(node, prop, value, prevProps[prop], isSVG, skipRef);\n  }\n}\nfunction hydrate$1(code, element, options = {}) {\n  if (globalThis._$HY.done) return render(code, element, [...element.childNodes], options);\n  sharedConfig.completed = globalThis._$HY.completed;\n  sharedConfig.events = globalThis._$HY.events;\n  sharedConfig.load = id => globalThis._$HY.r[id];\n  sharedConfig.has = id => id in globalThis._$HY.r;\n  sharedConfig.gather = root => gatherHydratable(element, root);\n  sharedConfig.registry = new Map();\n  sharedConfig.context = {\n    id: options.renderId || \"\",\n    count: 0\n  };\n  try {\n    gatherHydratable(element, options.renderId);\n    return render(code, element, [...element.childNodes], options);\n  } finally {\n    sharedConfig.context = null;\n  }\n}\nfunction getNextElement(template) {\n  let node,\n    key,\n    hydrating = isHydrating();\n  if (!hydrating || !(node = sharedConfig.registry.get(key = getHydrationKey()))) {\n    return template();\n  }\n  if (sharedConfig.completed) sharedConfig.completed.add(node);\n  sharedConfig.registry.delete(key);\n  return node;\n}\nfunction getNextMatch(el, nodeName) {\n  while (el && el.localName !== nodeName) el = el.nextSibling;\n  return el;\n}\nfunction getNextMarker(start) {\n  let end = start,\n    count = 0,\n    current = [];\n  if (isHydrating(start)) {\n    while (end) {\n      if (end.nodeType === 8) {\n        const v = end.nodeValue;\n        if (v === \"$\") count++;else if (v === \"/\") {\n          if (count === 0) return [end, current];\n          count--;\n        }\n      }\n      current.push(end);\n      end = end.nextSibling;\n    }\n  }\n  return [end, current];\n}\nfunction runHydrationEvents() {\n  if (sharedConfig.events && !sharedConfig.events.queued) {\n    queueMicrotask(() => {\n      const {\n        completed,\n        events\n      } = sharedConfig;\n      events.queued = false;\n      while (events.length) {\n        const [el, e] = events[0];\n        if (!completed.has(el)) return;\n        events.shift();\n        eventHandler(e);\n      }\n      if (sharedConfig.done) {\n        sharedConfig.events = _$HY.events = null;\n        sharedConfig.completed = _$HY.completed = null;\n      }\n    });\n    sharedConfig.events.queued = true;\n  }\n}\nfunction isHydrating(node) {\n  return !!sharedConfig.context && !sharedConfig.done && (!node || node.isConnected);\n}\nfunction toPropertyName(name) {\n  return name.toLowerCase().replace(/-([a-z])/g, (_, w) => w.toUpperCase());\n}\nfunction toggleClassKey(node, key, value) {\n  const classNames = key.trim().split(/\\s+/);\n  for (let i = 0, nameLen = classNames.length; i < nameLen; i++) node.classList.toggle(classNames[i], value);\n}\nfunction assignProp(node, prop, value, prev, isSVG, skipRef) {\n  let isCE, isProp, isChildProp, propAlias, forceProp;\n  if (prop === \"style\") return style(node, value, prev);\n  if (prop === \"classList\") return classList(node, value, prev);\n  if (value === prev) return prev;\n  if (prop === \"ref\") {\n    if (!skipRef) value(node);\n  } else if (prop.slice(0, 3) === \"on:\") {\n    const e = prop.slice(3);\n    prev && node.removeEventListener(e, prev);\n    value && node.addEventListener(e, value);\n  } else if (prop.slice(0, 10) === \"oncapture:\") {\n    const e = prop.slice(10);\n    prev && node.removeEventListener(e, prev, true);\n    value && node.addEventListener(e, value, true);\n  } else if (prop.slice(0, 2) === \"on\") {\n    const name = prop.slice(2).toLowerCase();\n    const delegate = DelegatedEvents.has(name);\n    if (!delegate && prev) {\n      const h = Array.isArray(prev) ? prev[0] : prev;\n      node.removeEventListener(name, h);\n    }\n    if (delegate || value) {\n      addEventListener(node, name, value, delegate);\n      delegate && delegateEvents([name]);\n    }\n  } else if (prop.slice(0, 5) === \"attr:\") {\n    setAttribute(node, prop.slice(5), value);\n  } else if ((forceProp = prop.slice(0, 5) === \"prop:\") || (isChildProp = ChildProperties.has(prop)) || !isSVG && ((propAlias = getPropAlias(prop, node.tagName)) || (isProp = Properties.has(prop))) || (isCE = node.nodeName.includes(\"-\"))) {\n    if (forceProp) {\n      prop = prop.slice(5);\n      isProp = true;\n    } else if (isHydrating(node)) return value;\n    if (prop === \"class\" || prop === \"className\") className(node, value);else if (isCE && !isProp && !isChildProp) node[toPropertyName(prop)] = value;else node[propAlias || prop] = value;\n  } else {\n    const ns = isSVG && prop.indexOf(\":\") > -1 && SVGNamespace[prop.split(\":\")[0]];\n    if (ns) setAttributeNS(node, ns, prop, value);else setAttribute(node, Aliases[prop] || prop, value);\n  }\n  return value;\n}\nfunction eventHandler(e) {\n  if (sharedConfig.registry && sharedConfig.events) {\n    if (sharedConfig.events.find(([el, ev]) => ev === e)) return;\n  }\n  const key = `$$${e.type}`;\n  let node = e.composedPath && e.composedPath()[0] || e.target;\n  if (e.target !== node) {\n    Object.defineProperty(e, \"target\", {\n      configurable: true,\n      value: node\n    });\n  }\n  Object.defineProperty(e, \"currentTarget\", {\n    configurable: true,\n    get() {\n      return node || document;\n    }\n  });\n  if (sharedConfig.registry && !sharedConfig.done) sharedConfig.done = _$HY.done = true;\n  while (node) {\n    const handler = node[key];\n    if (handler && !node.disabled) {\n      const data = node[`${key}Data`];\n      data !== undefined ? handler.call(node, data, e) : handler.call(node, e);\n      if (e.cancelBubble) return;\n    }\n    node = node._$host || node.parentNode || node.host;\n  }\n}\nfunction insertExpression(parent, value, current, marker, unwrapArray) {\n  const hydrating = isHydrating(parent);\n  if (hydrating) {\n    !current && (current = [...parent.childNodes]);\n    let cleaned = [];\n    for (let i = 0; i < current.length; i++) {\n      const node = current[i];\n      if (node.nodeType === 8 && node.data.slice(0, 2) === \"!$\") node.remove();else cleaned.push(node);\n    }\n    current = cleaned;\n  }\n  while (typeof current === \"function\") current = current();\n  if (value === current) return current;\n  const t = typeof value,\n    multi = marker !== undefined;\n  parent = multi && current[0] && current[0].parentNode || parent;\n  if (t === \"string\" || t === \"number\") {\n    if (hydrating) return current;\n    if (t === \"number\") {\n      value = value.toString();\n      if (value === current) return current;\n    }\n    if (multi) {\n      let node = current[0];\n      if (node && node.nodeType === 3) {\n        node.data !== value && (node.data = value);\n      } else node = document.createTextNode(value);\n      current = cleanChildren(parent, current, marker, node);\n    } else {\n      if (current !== \"\" && typeof current === \"string\") {\n        current = parent.firstChild.data = value;\n      } else current = parent.textContent = value;\n    }\n  } else if (value == null || t === \"boolean\") {\n    if (hydrating) return current;\n    current = cleanChildren(parent, current, marker);\n  } else if (t === \"function\") {\n    createRenderEffect(() => {\n      let v = value();\n      while (typeof v === \"function\") v = v();\n      current = insertExpression(parent, v, current, marker);\n    });\n    return () => current;\n  } else if (Array.isArray(value)) {\n    const array = [];\n    const currentArray = current && Array.isArray(current);\n    if (normalizeIncomingArray(array, value, current, unwrapArray)) {\n      createRenderEffect(() => current = insertExpression(parent, array, current, marker, true));\n      return () => current;\n    }\n    if (hydrating) {\n      if (!array.length) return current;\n      if (marker === undefined) return current = [...parent.childNodes];\n      let node = array[0];\n      if (node.parentNode !== parent) return current;\n      const nodes = [node];\n      while ((node = node.nextSibling) !== marker) nodes.push(node);\n      return current = nodes;\n    }\n    if (array.length === 0) {\n      current = cleanChildren(parent, current, marker);\n      if (multi) return current;\n    } else if (currentArray) {\n      if (current.length === 0) {\n        appendNodes(parent, array, marker);\n      } else reconcileArrays(parent, current, array);\n    } else {\n      current && cleanChildren(parent);\n      appendNodes(parent, array);\n    }\n    current = array;\n  } else if (value.nodeType) {\n    if (hydrating && value.parentNode) return current = multi ? [value] : value;\n    if (Array.isArray(current)) {\n      if (multi) return current = cleanChildren(parent, current, marker, value);\n      cleanChildren(parent, current, null, value);\n    } else if (current == null || current === \"\" || !parent.firstChild) {\n      parent.appendChild(value);\n    } else parent.replaceChild(value, parent.firstChild);\n    current = value;\n  } else ;\n  return current;\n}\nfunction normalizeIncomingArray(normalized, array, current, unwrap) {\n  let dynamic = false;\n  for (let i = 0, len = array.length; i < len; i++) {\n    let item = array[i],\n      prev = current && current[normalized.length],\n      t;\n    if (item == null || item === true || item === false) ; else if ((t = typeof item) === \"object\" && item.nodeType) {\n      normalized.push(item);\n    } else if (Array.isArray(item)) {\n      dynamic = normalizeIncomingArray(normalized, item, prev) || dynamic;\n    } else if (t === \"function\") {\n      if (unwrap) {\n        while (typeof item === \"function\") item = item();\n        dynamic = normalizeIncomingArray(normalized, Array.isArray(item) ? item : [item], Array.isArray(prev) ? prev : [prev]) || dynamic;\n      } else {\n        normalized.push(item);\n        dynamic = true;\n      }\n    } else {\n      const value = String(item);\n      if (prev && prev.nodeType === 3 && prev.data === value) normalized.push(prev);else normalized.push(document.createTextNode(value));\n    }\n  }\n  return dynamic;\n}\nfunction appendNodes(parent, array, marker = null) {\n  for (let i = 0, len = array.length; i < len; i++) parent.insertBefore(array[i], marker);\n}\nfunction cleanChildren(parent, current, marker, replacement) {\n  if (marker === undefined) return parent.textContent = \"\";\n  const node = replacement || document.createTextNode(\"\");\n  if (current.length) {\n    let inserted = false;\n    for (let i = current.length - 1; i >= 0; i--) {\n      const el = current[i];\n      if (node !== el) {\n        const isParent = el.parentNode === parent;\n        if (!inserted && !i) isParent ? parent.replaceChild(node, el) : parent.insertBefore(node, marker);else isParent && el.remove();\n      } else inserted = true;\n    }\n  } else parent.insertBefore(node, marker);\n  return [node];\n}\nfunction gatherHydratable(element, root) {\n  const templates = element.querySelectorAll(`*[data-hk]`);\n  for (let i = 0; i < templates.length; i++) {\n    const node = templates[i];\n    const key = node.getAttribute(\"data-hk\");\n    if ((!root || key.startsWith(root)) && !sharedConfig.registry.has(key)) sharedConfig.registry.set(key, node);\n  }\n}\nfunction getHydrationKey() {\n  return sharedConfig.getNextContextId();\n}\nfunction NoHydration(props) {\n  return sharedConfig.context ? undefined : props.children;\n}\nfunction Hydration(props) {\n  return props.children;\n}\nconst voidFn = () => undefined;\nconst RequestContext = Symbol();\nfunction innerHTML(parent, content) {\n  !sharedConfig.context && (parent.innerHTML = content);\n}\n\nfunction throwInBrowser(func) {\n  const err = new Error(`${func.name} is not supported in the browser, returning undefined`);\n  console.error(err);\n}\nfunction renderToString(fn, options) {\n  throwInBrowser(renderToString);\n}\nfunction renderToStringAsync(fn, options) {\n  throwInBrowser(renderToStringAsync);\n}\nfunction renderToStream(fn, options) {\n  throwInBrowser(renderToStream);\n}\nfunction ssr(template, ...nodes) {}\nfunction ssrElement(name, props, children, needsId) {}\nfunction ssrClassList(value) {}\nfunction ssrStyle(value) {}\nfunction ssrAttribute(key, value) {}\nfunction ssrHydrationKey() {}\nfunction resolveSSRNode(node) {}\nfunction escape(html) {}\nfunction ssrSpread(props, isSVG, skipChildren) {}\n\nconst isServer = false;\nconst isDev = false;\nconst SVG_NAMESPACE = \"http://www.w3.org/2000/svg\";\nfunction createElement(tagName, isSVG = false) {\n  return isSVG ? document.createElementNS(SVG_NAMESPACE, tagName) : document.createElement(tagName);\n}\nconst hydrate = (...args) => {\n  enableHydration();\n  return hydrate$1(...args);\n};\nfunction Portal(props) {\n  const {\n      useShadow\n    } = props,\n    marker = document.createTextNode(\"\"),\n    mount = () => props.mount || document.body,\n    owner = getOwner();\n  let content;\n  let hydrating = !!sharedConfig.context;\n  createEffect(() => {\n    if (hydrating) getOwner().user = hydrating = false;\n    content || (content = runWithOwner(owner, () => createMemo(() => props.children)));\n    const el = mount();\n    if (el instanceof HTMLHeadElement) {\n      const [clean, setClean] = createSignal(false);\n      const cleanup = () => setClean(true);\n      createRoot(dispose => insert(el, () => !clean() ? content() : dispose(), null));\n      onCleanup(cleanup);\n    } else {\n      const container = createElement(props.isSVG ? \"g\" : \"div\", props.isSVG),\n        renderRoot = useShadow && container.attachShadow ? container.attachShadow({\n          mode: \"open\"\n        }) : container;\n      Object.defineProperty(container, \"_$host\", {\n        get() {\n          return marker.parentNode;\n        },\n        configurable: true\n      });\n      insert(renderRoot, content);\n      el.appendChild(container);\n      props.ref && props.ref(container);\n      onCleanup(() => el.removeChild(container));\n    }\n  }, undefined, {\n    render: !hydrating\n  });\n  return marker;\n}\nfunction Dynamic(props) {\n  const [p, others] = splitProps(props, [\"component\"]);\n  const cached = createMemo(() => p.component);\n  return createMemo(() => {\n    const component = cached();\n    switch (typeof component) {\n      case \"function\":\n        return untrack(() => component(others));\n      case \"string\":\n        const isSvg = SVGElements.has(component);\n        const el = sharedConfig.context ? getNextElement() : createElement(component, isSvg);\n        spread(el, others, isSvg);\n        return el;\n    }\n  });\n}\n\nexport { Aliases, voidFn as Assets, ChildProperties, DOMElements, DelegatedEvents, Dynamic, Hydration, voidFn as HydrationScript, NoHydration, Portal, Properties, RequestContext, SVGElements, SVGNamespace, addEventListener, assign, classList, className, clearDelegatedEvents, delegateEvents, dynamicProperty, escape, voidFn as generateHydrationScript, voidFn as getAssets, getHydrationKey, getNextElement, getNextMarker, getNextMatch, getPropAlias, voidFn as getRequestEvent, hydrate, innerHTML, insert, isDev, isServer, render, renderToStream, renderToString, renderToStringAsync, resolveSSRNode, runHydrationEvents, setAttribute, setAttributeNS, setProperty, spread, ssr, ssrAttribute, ssrClassList, ssrElement, ssrHydrationKey, ssrSpread, ssrStyle, style, template, use, voidFn as useAssets };\n","import { $PROXY, $TRACK, getListener, batch, createSignal } from 'solid-js';\n\nconst $RAW = Symbol(\"store-raw\"),\n  $NODE = Symbol(\"store-node\"),\n  $HAS = Symbol(\"store-has\"),\n  $SELF = Symbol(\"store-self\");\nfunction wrap$1(value) {\n  let p = value[$PROXY];\n  if (!p) {\n    Object.defineProperty(value, $PROXY, {\n      value: p = new Proxy(value, proxyTraps$1)\n    });\n    if (!Array.isArray(value)) {\n      const keys = Object.keys(value),\n        desc = Object.getOwnPropertyDescriptors(value);\n      for (let i = 0, l = keys.length; i < l; i++) {\n        const prop = keys[i];\n        if (desc[prop].get) {\n          Object.defineProperty(value, prop, {\n            enumerable: desc[prop].enumerable,\n            get: desc[prop].get.bind(p)\n          });\n        }\n      }\n    }\n  }\n  return p;\n}\nfunction isWrappable(obj) {\n  let proto;\n  return obj != null && typeof obj === \"object\" && (obj[$PROXY] || !(proto = Object.getPrototypeOf(obj)) || proto === Object.prototype || Array.isArray(obj));\n}\nfunction unwrap(item, set = new Set()) {\n  let result, unwrapped, v, prop;\n  if (result = item != null && item[$RAW]) return result;\n  if (!isWrappable(item) || set.has(item)) return item;\n  if (Array.isArray(item)) {\n    if (Object.isFrozen(item)) item = item.slice(0);else set.add(item);\n    for (let i = 0, l = item.length; i < l; i++) {\n      v = item[i];\n      if ((unwrapped = unwrap(v, set)) !== v) item[i] = unwrapped;\n    }\n  } else {\n    if (Object.isFrozen(item)) item = Object.assign({}, item);else set.add(item);\n    const keys = Object.keys(item),\n      desc = Object.getOwnPropertyDescriptors(item);\n    for (let i = 0, l = keys.length; i < l; i++) {\n      prop = keys[i];\n      if (desc[prop].get) continue;\n      v = item[prop];\n      if ((unwrapped = unwrap(v, set)) !== v) item[prop] = unwrapped;\n    }\n  }\n  return item;\n}\nfunction getNodes(target, symbol) {\n  let nodes = target[symbol];\n  if (!nodes) Object.defineProperty(target, symbol, {\n    value: nodes = Object.create(null)\n  });\n  return nodes;\n}\nfunction getNode(nodes, property, value) {\n  if (nodes[property]) return nodes[property];\n  const [s, set] = createSignal(value, {\n    equals: false,\n    internal: true\n  });\n  s.$ = set;\n  return nodes[property] = s;\n}\nfunction proxyDescriptor$1(target, property) {\n  const desc = Reflect.getOwnPropertyDescriptor(target, property);\n  if (!desc || desc.get || !desc.configurable || property === $PROXY || property === $NODE) return desc;\n  delete desc.value;\n  delete desc.writable;\n  desc.get = () => target[$PROXY][property];\n  return desc;\n}\nfunction trackSelf(target) {\n  getListener() && getNode(getNodes(target, $NODE), $SELF)();\n}\nfunction ownKeys(target) {\n  trackSelf(target);\n  return Reflect.ownKeys(target);\n}\nconst proxyTraps$1 = {\n  get(target, property, receiver) {\n    if (property === $RAW) return target;\n    if (property === $PROXY) return receiver;\n    if (property === $TRACK) {\n      trackSelf(target);\n      return receiver;\n    }\n    const nodes = getNodes(target, $NODE);\n    const tracked = nodes[property];\n    let value = tracked ? tracked() : target[property];\n    if (property === $NODE || property === $HAS || property === \"__proto__\") return value;\n    if (!tracked) {\n      const desc = Object.getOwnPropertyDescriptor(target, property);\n      if (getListener() && (typeof value !== \"function\" || target.hasOwnProperty(property)) && !(desc && desc.get)) value = getNode(nodes, property, value)();\n    }\n    return isWrappable(value) ? wrap$1(value) : value;\n  },\n  has(target, property) {\n    if (property === $RAW || property === $PROXY || property === $TRACK || property === $NODE || property === $HAS || property === \"__proto__\") return true;\n    getListener() && getNode(getNodes(target, $HAS), property)();\n    return property in target;\n  },\n  set() {\n    return true;\n  },\n  deleteProperty() {\n    return true;\n  },\n  ownKeys: ownKeys,\n  getOwnPropertyDescriptor: proxyDescriptor$1\n};\nfunction setProperty(state, property, value, deleting = false) {\n  if (!deleting && state[property] === value) return;\n  const prev = state[property],\n    len = state.length;\n  if (value === undefined) {\n    delete state[property];\n    if (state[$HAS] && state[$HAS][property] && prev !== undefined) state[$HAS][property].$();\n  } else {\n    state[property] = value;\n    if (state[$HAS] && state[$HAS][property] && prev === undefined) state[$HAS][property].$();\n  }\n  let nodes = getNodes(state, $NODE),\n    node;\n  if (node = getNode(nodes, property, prev)) node.$(() => value);\n  if (Array.isArray(state) && state.length !== len) {\n    for (let i = state.length; i < len; i++) (node = nodes[i]) && node.$();\n    (node = getNode(nodes, \"length\", len)) && node.$(state.length);\n  }\n  (node = nodes[$SELF]) && node.$();\n}\nfunction mergeStoreNode(state, value) {\n  const keys = Object.keys(value);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    setProperty(state, key, value[key]);\n  }\n}\nfunction updateArray(current, next) {\n  if (typeof next === \"function\") next = next(current);\n  next = unwrap(next);\n  if (Array.isArray(next)) {\n    if (current === next) return;\n    let i = 0,\n      len = next.length;\n    for (; i < len; i++) {\n      const value = next[i];\n      if (current[i] !== value) setProperty(current, i, value);\n    }\n    setProperty(current, \"length\", len);\n  } else mergeStoreNode(current, next);\n}\nfunction updatePath(current, path, traversed = []) {\n  let part,\n    prev = current;\n  if (path.length > 1) {\n    part = path.shift();\n    const partType = typeof part,\n      isArray = Array.isArray(current);\n    if (Array.isArray(part)) {\n      for (let i = 0; i < part.length; i++) {\n        updatePath(current, [part[i]].concat(path), traversed);\n      }\n      return;\n    } else if (isArray && partType === \"function\") {\n      for (let i = 0; i < current.length; i++) {\n        if (part(current[i], i)) updatePath(current, [i].concat(path), traversed);\n      }\n      return;\n    } else if (isArray && partType === \"object\") {\n      const {\n        from = 0,\n        to = current.length - 1,\n        by = 1\n      } = part;\n      for (let i = from; i <= to; i += by) {\n        updatePath(current, [i].concat(path), traversed);\n      }\n      return;\n    } else if (path.length > 1) {\n      updatePath(current[part], path, [part].concat(traversed));\n      return;\n    }\n    prev = current[part];\n    traversed = [part].concat(traversed);\n  }\n  let value = path[0];\n  if (typeof value === \"function\") {\n    value = value(prev, traversed);\n    if (value === prev) return;\n  }\n  if (part === undefined && value == undefined) return;\n  value = unwrap(value);\n  if (part === undefined || isWrappable(prev) && isWrappable(value) && !Array.isArray(value)) {\n    mergeStoreNode(prev, value);\n  } else setProperty(current, part, value);\n}\nfunction createStore(...[store, options]) {\n  const unwrappedStore = unwrap(store || {});\n  const isArray = Array.isArray(unwrappedStore);\n  const wrappedStore = wrap$1(unwrappedStore);\n  function setStore(...args) {\n    batch(() => {\n      isArray && args.length === 1 ? updateArray(unwrappedStore, args[0]) : updatePath(unwrappedStore, args);\n    });\n  }\n  return [wrappedStore, setStore];\n}\n\nfunction proxyDescriptor(target, property) {\n  const desc = Reflect.getOwnPropertyDescriptor(target, property);\n  if (!desc || desc.get || desc.set || !desc.configurable || property === $PROXY || property === $NODE) return desc;\n  delete desc.value;\n  delete desc.writable;\n  desc.get = () => target[$PROXY][property];\n  desc.set = v => target[$PROXY][property] = v;\n  return desc;\n}\nconst proxyTraps = {\n  get(target, property, receiver) {\n    if (property === $RAW) return target;\n    if (property === $PROXY) return receiver;\n    if (property === $TRACK) {\n      trackSelf(target);\n      return receiver;\n    }\n    const nodes = getNodes(target, $NODE);\n    const tracked = nodes[property];\n    let value = tracked ? tracked() : target[property];\n    if (property === $NODE || property === $HAS || property === \"__proto__\") return value;\n    if (!tracked) {\n      const desc = Object.getOwnPropertyDescriptor(target, property);\n      const isFunction = typeof value === \"function\";\n      if (getListener() && (!isFunction || target.hasOwnProperty(property)) && !(desc && desc.get)) value = getNode(nodes, property, value)();else if (value != null && isFunction && value === Array.prototype[property]) {\n        return (...args) => batch(() => Array.prototype[property].apply(receiver, args));\n      }\n    }\n    return isWrappable(value) ? wrap(value) : value;\n  },\n  has(target, property) {\n    if (property === $RAW || property === $PROXY || property === $TRACK || property === $NODE || property === $HAS || property === \"__proto__\") return true;\n    getListener() && getNode(getNodes(target, $HAS), property)();\n    return property in target;\n  },\n  set(target, property, value) {\n    batch(() => setProperty(target, property, unwrap(value)));\n    return true;\n  },\n  deleteProperty(target, property) {\n    batch(() => setProperty(target, property, undefined, true));\n    return true;\n  },\n  ownKeys: ownKeys,\n  getOwnPropertyDescriptor: proxyDescriptor\n};\nfunction wrap(value) {\n  let p = value[$PROXY];\n  if (!p) {\n    Object.defineProperty(value, $PROXY, {\n      value: p = new Proxy(value, proxyTraps)\n    });\n    const keys = Object.keys(value),\n      desc = Object.getOwnPropertyDescriptors(value);\n    const proto = Object.getPrototypeOf(value);\n    const isClass = value !== null && typeof value === \"object\" && !Array.isArray(value) && proto !== Object.prototype;\n    if (isClass) {\n      const descriptors = Object.getOwnPropertyDescriptors(proto);\n      keys.push(...Object.keys(descriptors));\n      Object.assign(desc, descriptors);\n    }\n    for (let i = 0, l = keys.length; i < l; i++) {\n      const prop = keys[i];\n      if (isClass && prop === \"constructor\") continue;\n      if (desc[prop].get) {\n        const get = desc[prop].get.bind(p);\n        Object.defineProperty(value, prop, {\n          get,\n          configurable: true\n        });\n      }\n      if (desc[prop].set) {\n        const og = desc[prop].set,\n          set = v => batch(() => og.call(p, v));\n        Object.defineProperty(value, prop, {\n          set,\n          configurable: true\n        });\n      }\n    }\n  }\n  return p;\n}\nfunction createMutable(state, options) {\n  const unwrappedStore = unwrap(state || {});\n  const wrappedStore = wrap(unwrappedStore);\n  return wrappedStore;\n}\nfunction modifyMutable(state, modifier) {\n  batch(() => modifier(unwrap(state)));\n}\n\nconst $ROOT = Symbol(\"store-root\");\nfunction applyState(target, parent, property, merge, key) {\n  const previous = parent[property];\n  if (target === previous) return;\n  const isArray = Array.isArray(target);\n  if (property !== $ROOT && (!isWrappable(target) || !isWrappable(previous) || isArray !== Array.isArray(previous) || key && target[key] !== previous[key])) {\n    setProperty(parent, property, target);\n    return;\n  }\n  if (isArray) {\n    if (target.length && previous.length && (!merge || key && target[0] && target[0][key] != null)) {\n      let i, j, start, end, newEnd, item, newIndicesNext, keyVal;\n      for (start = 0, end = Math.min(previous.length, target.length); start < end && (previous[start] === target[start] || key && previous[start] && target[start] && previous[start][key] === target[start][key]); start++) {\n        applyState(target[start], previous, start, merge, key);\n      }\n      const temp = new Array(target.length),\n        newIndices = new Map();\n      for (end = previous.length - 1, newEnd = target.length - 1; end >= start && newEnd >= start && (previous[end] === target[newEnd] || key && previous[start] && target[start] && previous[end][key] === target[newEnd][key]); end--, newEnd--) {\n        temp[newEnd] = previous[end];\n      }\n      if (start > newEnd || start > end) {\n        for (j = start; j <= newEnd; j++) setProperty(previous, j, target[j]);\n        for (; j < target.length; j++) {\n          setProperty(previous, j, temp[j]);\n          applyState(target[j], previous, j, merge, key);\n        }\n        if (previous.length > target.length) setProperty(previous, \"length\", target.length);\n        return;\n      }\n      newIndicesNext = new Array(newEnd + 1);\n      for (j = newEnd; j >= start; j--) {\n        item = target[j];\n        keyVal = key && item ? item[key] : item;\n        i = newIndices.get(keyVal);\n        newIndicesNext[j] = i === undefined ? -1 : i;\n        newIndices.set(keyVal, j);\n      }\n      for (i = start; i <= end; i++) {\n        item = previous[i];\n        keyVal = key && item ? item[key] : item;\n        j = newIndices.get(keyVal);\n        if (j !== undefined && j !== -1) {\n          temp[j] = previous[i];\n          j = newIndicesNext[j];\n          newIndices.set(keyVal, j);\n        }\n      }\n      for (j = start; j < target.length; j++) {\n        if (j in temp) {\n          setProperty(previous, j, temp[j]);\n          applyState(target[j], previous, j, merge, key);\n        } else setProperty(previous, j, target[j]);\n      }\n    } else {\n      for (let i = 0, len = target.length; i < len; i++) {\n        applyState(target[i], previous, i, merge, key);\n      }\n    }\n    if (previous.length > target.length) setProperty(previous, \"length\", target.length);\n    return;\n  }\n  const targetKeys = Object.keys(target);\n  for (let i = 0, len = targetKeys.length; i < len; i++) {\n    applyState(target[targetKeys[i]], previous, targetKeys[i], merge, key);\n  }\n  const previousKeys = Object.keys(previous);\n  for (let i = 0, len = previousKeys.length; i < len; i++) {\n    if (target[previousKeys[i]] === undefined) setProperty(previous, previousKeys[i], undefined);\n  }\n}\nfunction reconcile(value, options = {}) {\n  const {\n      merge,\n      key = \"id\"\n    } = options,\n    v = unwrap(value);\n  return state => {\n    if (!isWrappable(state) || !isWrappable(v)) return v;\n    const res = applyState(v, {\n      [$ROOT]: state\n    }, $ROOT, merge, key);\n    return res === undefined ? state : res;\n  };\n}\nconst producers = new WeakMap();\nconst setterTraps = {\n  get(target, property) {\n    if (property === $RAW) return target;\n    const value = target[property];\n    let proxy;\n    return isWrappable(value) ? producers.get(value) || (producers.set(value, proxy = new Proxy(value, setterTraps)), proxy) : value;\n  },\n  set(target, property, value) {\n    setProperty(target, property, unwrap(value));\n    return true;\n  },\n  deleteProperty(target, property) {\n    setProperty(target, property, undefined, true);\n    return true;\n  }\n};\nfunction produce(fn) {\n  return state => {\n    if (isWrappable(state)) {\n      let proxy;\n      if (!(proxy = producers.get(state))) {\n        producers.set(state, proxy = new Proxy(state, setterTraps));\n      }\n      fn(proxy);\n    }\n    return state;\n  };\n}\n\nconst DEV = undefined;\n\nexport { $RAW, DEV, createMutable, createStore, modifyMutable, produce, reconcile, unwrap };\n","import { For, onCleanup, onMount } from 'solid-js'\r\nimport { createStore } from 'solid-js/store'\r\nimport type { Game } from '../../Game'\r\nimport type { LoadItem } from '../../Loader'\r\nimport './style.css'\r\n\r\nconst itemTypeGroupName: { [name: string]: string } = {\r\n  replay: 'Replay',\r\n  bsp: 'Map',\r\n  sound: 'Sounds',\r\n  sky: 'Skybox',\r\n  sprite: 'Sprites',\r\n  wad: 'Wads'\r\n}\r\n\r\nexport function Loading(props: { game: Game; visible: boolean }) {\r\n  const [items, setItems] = createStore<{ [name: string]: { name: string; progress: number }[] }>({})\r\n\r\n  onMount(() => {\r\n    const loaderEvents = props.game.loader.events\r\n    const offLoadStart = loaderEvents.on('loadstart', onItemLoad)\r\n    const offProgress = loaderEvents.on('progress', onItemProgress)\r\n    onCleanup(() => {\r\n      offLoadStart?.()\r\n      offProgress?.()\r\n    })\r\n  })\r\n\r\n  const onItemLoad = (item: LoadItem) => {\r\n    const typeItems = items[item.type] ? items[item.type] : []\r\n\r\n    for (let i = 0; i < typeItems.length; ++i) {\r\n      if (typeItems[i] === item) {\r\n        return\r\n      }\r\n    }\r\n\r\n    typeItems.push({\r\n      name: item.name,\r\n      progress: 0\r\n    })\r\n\r\n    setItems(item.type, typeItems)\r\n  }\r\n\r\n  const onItemProgress = (item: LoadItem) => {\r\n    if (!items[item.type]) {\r\n      return\r\n    }\r\n\r\n    const typeItems = items[item.type]\r\n    for (let i = 0; i < typeItems.length; ++i) {\r\n      if (typeItems[i].name === item.name) {\r\n        setItems(item.type, i, { progress: item.progress })\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  const formatItem = (_name: string, progress: number) => {\r\n    let name = _name\r\n    name = itemTypeGroupName[name]\r\n    const status = `${Math.round(progress * 100)}%`\r\n\r\n    let length = 29 - name.length - status.length\r\n    if (length < 2) {\r\n      length = 9 - status.length\r\n    }\r\n\r\n    const dots = Array(length).join('.')\r\n\r\n    return `${name}${dots}${status}`\r\n  }\r\n\r\n  return (\r\n    <div\r\n      classList={{\r\n        'hlv-loading': true,\r\n        visible: props.visible\r\n      }}\r\n    >\r\n      <div class=\"hlv-loading-spinner\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"80px\" height=\"80px\" viewBox=\"0 0 80 80\">\r\n          <title>Loading</title>\r\n          <path\r\n            fill=\"#ffffff\"\r\n            d=\"M40,72C22.4,72,8,57.6,8,40C8,22.4,22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z\"\r\n          />\r\n        </svg>\r\n      </div>\r\n\r\n      <div class=\"hlv-loading-log\">\r\n        <For each={Object.entries(items)}>\r\n          {([name, items]) => (\r\n            <div class=\"hlv-loading-log-item\">\r\n              {formatItem(name, items.reduce((prev, cur) => prev + cur.progress, 0) / items.length)}\r\n            </div>\r\n          )}\r\n        </For>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { createSignal } from 'solid-js'\r\nimport { type Game, PlayerMode } from '../../../Game'\r\nimport './style.css'\r\n\r\nexport function SettingsButton(props: { game: Game }) {\r\n  const [isOpen, setIsOpen] = createSignal(false)\r\n  const hasReplay = !!props.game.player.replay\r\n\r\n  const onFreeModeClick = () => {\r\n    if (props.game.mode === PlayerMode.FREE) {\r\n      return\r\n    }\r\n\r\n    props.game.changeMode(PlayerMode.FREE)\r\n    props.game.player.pause()\r\n  }\r\n\r\n  const onReplayModeClick = () => {\r\n    if (props.game.mode === PlayerMode.REPLAY) {\r\n      return\r\n    }\r\n\r\n    props.game.changeMode(PlayerMode.REPLAY)\r\n  }\r\n\r\n  return (\r\n    <div classList={{ 'hlv-settings': true, open: isOpen() }}>\r\n      <button type=\"button\" class=\"hlv-button\" onClick={() => setIsOpen(!isOpen())}>\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          stroke-width=\"2\"\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n        >\r\n          <title>Toggle</title>\r\n          <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n          <path d=\"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z\" />\r\n          <path d=\"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0\" />\r\n        </svg>\r\n      </button>\r\n\r\n      <div class=\"hlv-settings-menu\">\r\n        <span class=\"hlv-settings-menu-title\">Mode</span>\r\n        {hasReplay ? (\r\n          <button\r\n            type=\"button\"\r\n            classList={{\r\n              'hlv-settings-menu-item': true,\r\n              selected: props.game.mode === PlayerMode.REPLAY\r\n            }}\r\n            onClick={() => onReplayModeClick()}\r\n          >\r\n            Replay\r\n          </button>\r\n        ) : (\r\n          <span />\r\n        )}\r\n        <button\r\n          type=\"button\"\r\n          classList={{\r\n            'hlv-settings-menu-item': true,\r\n            selected: props.game.mode === PlayerMode.FREE\r\n          }}\r\n          onClick={() => onFreeModeClick()}\r\n        >\r\n          Free Move\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","const apis = [\r\n  {\r\n    enabled: 'fullscreenEnabled',\r\n    element: 'fullscreenElement',\r\n    request: 'requestFullscreen',\r\n    exit: 'exitFullscreen',\r\n    change: 'fullscreenchange',\r\n    error: 'fullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'mozFullScreenEnabled',\r\n    element: 'mozFullScreenElement',\r\n    request: 'mozRequestFullScreen',\r\n    exit: 'mozCancelFullScreen',\r\n    change: 'mozfullscreenchange',\r\n    error: 'mozfullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'webkitFullscreenEnabled',\r\n    element: 'webkitCurrentFullScreenElement',\r\n    request: 'webkitRequestFullscreen',\r\n    exit: 'webkitExitFullscreen',\r\n    change: 'webkitfullscreenchange',\r\n    error: 'webkitfullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'msFullscreenEnabled',\r\n    element: 'msFullscreenElement',\r\n    request: 'msRequestFullscreen',\r\n    exit: 'msExitFullscreen',\r\n    change: 'MSFullscreenChange',\r\n    error: 'MSFullscreenError'\r\n  }\r\n]\r\n\r\nlet apiIdx = 0\r\n\r\ninterface Doc {\r\n  [key: string]: any\r\n}\r\nconst doc: Doc = document\r\n\r\nfor (let i = 0; i < apis.length; ++i) {\r\n  if (typeof doc[apis[i].enabled] !== 'undefined') {\r\n    apiIdx = i\r\n    break\r\n  }\r\n}\r\n\r\nexport const Fullscreen = {\r\n  element() {\r\n    return doc[apis[apiIdx].element]\r\n  },\r\n  enabled() {\r\n    return doc[apis[apiIdx].enabled]\r\n  },\r\n  isInFullscreen() {\r\n    return Fullscreen.element() !== null\r\n  },\r\n  enter(node: any) {\r\n    node[apis[apiIdx].request]()\r\n  },\r\n  exit() {\r\n    doc[apis[apiIdx].exit]()\r\n  },\r\n  onChange(callback: () => void) {\r\n    return window.addEventListener(apis[apiIdx].change, callback)\r\n  },\r\n  onChangeRemove(callback: () => void) {\r\n    window.removeEventListener(apis[apiIdx].change, callback)\r\n  },\r\n  onError(callback: () => void) {\r\n    return window.addEventListener(apis[apiIdx].error, callback)\r\n  }\r\n}\r\n","import { createSignal, onCleanup, onMount } from 'solid-js'\r\nimport { Fullscreen } from '../../../Fullscreen'\r\nimport './style.css'\r\n\r\nexport function FullscreenButton(props: { active: boolean; root: Element }) {\r\n  const [isInFullscreen, setIsInFullscreen] = createSignal(Fullscreen.isInFullscreen())\r\n\r\n  onMount(() => {\r\n    Fullscreen.onChange(onFullscreen)\r\n  })\r\n\r\n  onCleanup(() => {\r\n    Fullscreen.onChangeRemove(onFullscreen)\r\n  })\r\n\r\n  const onClick = () => {\r\n    if (Fullscreen.isInFullscreen()) {\r\n      Fullscreen.exit()\r\n    } else {\r\n      Fullscreen.enter(props.root)\r\n    }\r\n  }\r\n\r\n  const onFullscreen = () => {\r\n    setIsInFullscreen(Fullscreen.isInFullscreen())\r\n  }\r\n\r\n  return (\r\n    <button type=\"button\" class=\"hlv-button hlv-fullscreen-button\" onClick={() => onClick()}>\r\n      {isInFullscreen() ? (\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          stroke-width=\"2\"\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n          class=\"icon icon-tabler icons-tabler-outline icon-tabler-minimize\"\r\n        >\r\n          <title>Exit fullscreen</title>\r\n          <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n          <path d=\"M15 19v-2a2 2 0 0 1 2 -2h2\" />\r\n          <path d=\"M15 5v2a2 2 0 0 0 2 2h2\" />\r\n          <path d=\"M5 15h2a2 2 0 0 1 2 2v2\" />\r\n          <path d=\"M5 9h2a2 2 0 0 0 2 -2v-2\" />\r\n        </svg>\r\n      ) : (\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          stroke-width=\"2\"\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n        >\r\n          <title>Fullscreen</title>\r\n          <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n          <path d=\"M4 8v-2a2 2 0 0 1 2 -2h2\" />\r\n          <path d=\"M4 16v2a2 2 0 0 0 2 2h2\" />\r\n          <path d=\"M16 4h2a2 2 0 0 1 2 2v2\" />\r\n          <path d=\"M16 20h2a2 2 0 0 0 2 -2v-2\" />\r\n        </svg>\r\n      )}\r\n    </button>\r\n  )\r\n}\r\n","import type { Game } from '../../Game'\r\nimport { SettingsButton } from '../Buttons/SettingsButton'\r\nimport { FullscreenButton } from '../Buttons/FullscreenButton'\r\n\r\nexport function FreeMode(props: { class: string; game: Game; root: Element }) {\r\n  return (\r\n    <div class={props.class}>\r\n      <div class=\"hlv-buttons\">\r\n        <div class=\"hlv-buttons-left\" />\r\n        <div class=\"hlv-buttons-right\">\r\n          <SettingsButton game={props.game} />\r\n          <FullscreenButton active={false} root={props.root} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { createContext, useContext } from 'solid-js'\r\nimport { PlayerMode } from '../Game'\r\n\r\nexport const GameStateContext = createContext({\r\n  mode: PlayerMode.FREE,\r\n  time: 0,\r\n  volume: 1,\r\n  isPlaying: false,\r\n  isPaused: false\r\n})\r\n\r\nexport function useGameState() {\r\n  return useContext(GameStateContext)\r\n}\r\n","import { formatTime } from '../../Time'\r\nimport type { ReplayPlayer } from '../../ReplayPlayer'\r\nimport { useGameState } from '../GameState'\r\nimport './style.css'\r\n\r\nexport function Time(props: { player: ReplayPlayer }) {\r\n  const gameState = useGameState()\r\n  const current = () => formatTime(gameState.time)\r\n  const total = () => formatTime(props.player.replay.length)\r\n\r\n  return (\r\n    <div class=\"hlv-time\">\r\n      {current()} / {total()}\r\n    </div>\r\n  )\r\n}\r\n","import { createSignal, onCleanup, onMount } from 'solid-js'\r\nimport type { Game } from '../../Game'\r\nimport { formatTime } from '../../Time'\r\nimport './style.css'\r\n\r\nexport function Timeline(props: { game: Game }) {\r\n  const [progress, setProgress] = createSignal(0)\r\n  const [ghostKnobActive, setGhostKnobActive] = createSignal(false)\r\n  const [ghostKnobPos, setGhostKnobPos] = createSignal('0%')\r\n  const [ghostTime, setGhostTime] = createSignal(0)\r\n\r\n  onMount(() => {\r\n    const offPostUpdate = props.game.events.on('postupdate', () => {\r\n      setProgress(props.game.player.currentTime / props.game.player.replay.length)\r\n    })\r\n    onCleanup(() => {\r\n      offPostUpdate?.()\r\n    })\r\n  })\r\n\r\n  const onMouseDown = (e: MouseEvent & { currentTarget: HTMLButtonElement }) => {\r\n    const rects = e.currentTarget.getClientRects()[0]\r\n    const progress = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\r\n    props.game.player.seekByPercent(progress * 100)\r\n    props.game.player.pause()\r\n\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      const progressPos = Math.max(0, Math.min(1 - (rects.right - e.pageX) / (rects.right - rects.left), 1))\r\n      props.game.player.seekByPercent(progressPos * 100)\r\n      props.game.player.pause()\r\n    }\r\n    window.addEventListener('mousemove', onMouseMove)\r\n    window.addEventListener(\r\n      'mouseup',\r\n      () => {\r\n        window.removeEventListener('mousemove', onMouseMove)\r\n      },\r\n      { once: true }\r\n    )\r\n  }\r\n\r\n  const onMouseMove = (e: MouseEvent & { currentTarget: HTMLButtonElement }) => {\r\n    const rects = e.currentTarget.getClientRects()[0]\r\n    const progressPos = Math.max(0, Math.min(1 - (rects.right - e.pageX) / (rects.right - rects.left), 1))\r\n    if (ghostKnobActive()) {\r\n      setGhostKnobPos(`${progressPos * 100}%`)\r\n      setGhostTime(props.game.player.replay.length * progressPos)\r\n    }\r\n  }\r\n\r\n  const onMouseEnter = () => {\r\n    setGhostKnobActive(true)\r\n  }\r\n\r\n  const onMouseLeave = () => {\r\n    setGhostKnobActive(false)\r\n  }\r\n\r\n  const knobOffset = () => {\r\n    const timePos = progress() * 100\r\n    return `${timePos}%`\r\n  }\r\n\r\n  const lineOffset = () => {\r\n    const timePos = progress() * 100\r\n    return `${100 - timePos}%`\r\n  }\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      class=\"hlv-timeline\"\r\n      onMouseDown={(e) => onMouseDown(e)}\r\n      onMouseMove={(e) => onMouseMove(e)}\r\n      onMouseEnter={() => onMouseEnter()}\r\n      onMouseLeave={() => onMouseLeave()}\r\n    >\r\n      <div class=\"hlv-timeline-ghostline\" />\r\n      <div class=\"hlv-timeline-line\" style={{ right: lineOffset() }} />\r\n      <div class=\"hlv-timeline-knob\" style={{ left: knobOffset() }} />\r\n      <div class=\"hlv-timeline-ghosttime\" style={{ left: ghostKnobPos() }}>\r\n        {formatTime(ghostTime())}\r\n      </div>\r\n    </button>\r\n  )\r\n}\r\n","import type { Game } from '../../Game'\r\nimport { useGameState } from '../GameState'\r\nimport './style.css'\r\n\r\nexport function VolumeControl(props: { game: Game }) {\r\n  const gameState = useGameState()\r\n\r\n  const onMouseDown = (e: MouseEvent & { currentTarget: HTMLDivElement }) => {\r\n    const rects = e.currentTarget.getClientRects()[0]\r\n    const volume = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\r\n    props.game.soundSystem.setVolume(volume)\r\n\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      const volume = Math.max(0, Math.min(1 - (rects.right - e.pageX) / (rects.right - rects.left), 1))\r\n      props.game.soundSystem.setVolume(volume)\r\n    }\r\n    window.addEventListener('mousemove', onMouseMove)\r\n    window.addEventListener(\r\n      'mouseup',\r\n      () => {\r\n        window.removeEventListener('mousemove', onMouseMove)\r\n      },\r\n      { once: true }\r\n    )\r\n  }\r\n\r\n  const volumePos = () => gameState.volume * 100\r\n  const knobOffset = () => `${Math.min(95, Math.max(5, volumePos()))}%`\r\n  const lineOffset = () => `${Math.min(95, Math.max(5, 100 - volumePos()))}%`\r\n\r\n  return (\r\n    <div class=\"hlv-volume\" onMouseDown={(e) => onMouseDown(e)}>\r\n      <div class=\"hlv-volume-ghostline\" />\r\n      <div class=\"hlv-volume-line\" style={{ right: lineOffset() }} />\r\n      <div class=\"hlv-volume-knob\" style={{ left: knobOffset() }} />\r\n    </div>\r\n  )\r\n}\r\n","export function PlayButton(props: { onClick(): void }) {\r\n  return (\r\n    <button type=\"button\" class=\"hlv-button\" onClick={() => props.onClick()}>\r\n      <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"24\"\r\n        height=\"24\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        stroke-width=\"2\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n      >\r\n        <title>Play</title>\r\n        <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n        <path d=\"M7 4v16l13 -8z\" />\r\n      </svg>\r\n    </button>\r\n  )\r\n}\r\n","export function PauseButton(props: { onClick(): void }) {\r\n  return (\r\n    <button type=\"button\" class=\"hlv-button\" onClick={() => props.onClick()}>\r\n      <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"24\"\r\n        height=\"24\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        stroke-width=\"2\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n      >\r\n        <title>Pause</title>\r\n        <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n        <path d=\"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z\" />\r\n        <path d=\"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z\" />\r\n      </svg>\r\n    </button>\r\n  )\r\n}\r\n","export function VolumeFull() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <title>Volume Full</title>\r\n      <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n      <path d=\"M15 8a5 5 0 0 1 0 8\" />\r\n      <path d=\"M17.7 5a9 9 0 0 1 0 14\" />\r\n      <path d=\"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5\" />\r\n    </svg>\r\n  )\r\n}\r\n","export function VolumeHalf() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n      class=\"icon icon-tabler icons-tabler-outline icon-tabler-volume-2\"\r\n    >\r\n      <title>Volume Half</title>\r\n      <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n      <path d=\"M15 8a5 5 0 0 1 0 8\" />\r\n      <path d=\"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5\" />\r\n    </svg>\r\n  )\r\n}\r\n","export function VolumeMute() {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n      class=\"icon icon-tabler icons-tabler-outline icon-tabler-volume-3\"\r\n    >\r\n      <title>Volume Mute</title>\r\n      <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n      <path d=\"M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5\" />\r\n      <path d=\"M16 10l4 4m0 -4l-4 4\" />\r\n    </svg>\r\n  )\r\n}\r\n","import { useGameState } from '../../GameState'\r\nimport { VolumeFull } from './VolumeFull'\r\nimport { VolumeHalf } from './VolumeHalf'\r\nimport { VolumeMute } from './VolumeMute'\r\n\r\nexport function VolumeButton(props: { onClick(): void }) {\r\n  const gameState = useGameState()\r\n\r\n  return (\r\n    <button type=\"button\" class=\"hlv-button\" onClick={() => props.onClick()}>\r\n      {gameState.volume === 0 ? <VolumeMute /> : gameState.volume > 0.5 ? <VolumeFull /> : <VolumeHalf />}\r\n    </button>\r\n  )\r\n}\r\n","export function SpeedUpButton(props: { onClick(): void }) {\r\n  return (\r\n    <button type=\"button\" class=\"hlv-button\" onClick={() => props.onClick()}>\r\n      <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"24\"\r\n        height=\"24\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        stroke-width=\"2\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n      >\r\n        <title>Speed Up</title>\r\n        <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n        <path d=\"M3 5v14l8 -7z\" />\r\n        <path d=\"M14 5v14l8 -7z\" />\r\n      </svg>\r\n    </button>\r\n  )\r\n}\r\n","export function SpeedDownButton(props: { onClick(): void }) {\r\n  return (\r\n    <button type=\"button\" class=\"hlv-button\" onClick={() => props.onClick()}>\r\n      <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"24\"\r\n        height=\"24\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        stroke-width=\"2\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n      >\r\n        <title>Speed Down</title>\r\n        <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n        <path d=\"M21 5v14l-8 -7z\" />\r\n        <path d=\"M10 5v14l-8 -7z\" />\r\n      </svg>\r\n    </button>\r\n  )\r\n}\r\n","import { Time } from '../Time'\r\nimport type { Game } from '../../Game'\r\nimport { Timeline } from '../Timeline'\r\nimport { useGameState } from '../GameState'\r\nimport { VolumeControl } from '../VolumeControl'\r\nimport { PlayButton } from '../Buttons/PlayButton'\r\nimport { PauseButton } from '../Buttons/PauseButton'\r\nimport { VolumeButton } from '../Buttons/VolumeButton'\r\nimport { SpeedUpButton } from '../Buttons/SpeedUpButton'\r\nimport { SpeedDownButton } from '../Buttons/SpeedDownButton'\r\nimport { SettingsButton } from '../Buttons/SettingsButton'\r\nimport { FullscreenButton } from '../Buttons/FullscreenButton'\r\n\r\nexport function ReplayMode(props: { class: string; game: Game; root: Element; visible: boolean }) {\r\n  const gameState = useGameState()\r\n\r\n  const onPlayClick = () => {\r\n    props.game.player.play()\r\n  }\r\n\r\n  const onPauseClick = () => {\r\n    props.game.player.pause()\r\n  }\r\n\r\n  const onSpeedDown = () => {\r\n    props.game.player.speedDown()\r\n  }\r\n\r\n  const onSpeedUp = () => {\r\n    props.game.player.speedUp()\r\n  }\r\n\r\n  const onVolumeClick = () => {\r\n    props.game.soundSystem.toggleMute()\r\n  }\r\n\r\n  return (\r\n    <div class={props.class}>\r\n      <Timeline game={props.game} />\r\n\r\n      <div class=\"hlv-buttons\">\r\n        <div class=\"hlv-buttons-left\">\r\n          <SpeedDownButton onClick={() => onSpeedDown()} />\r\n          {gameState.isPaused || !gameState.isPlaying ? (\r\n            <PlayButton onClick={() => onPlayClick()} />\r\n          ) : (\r\n            <PauseButton onClick={() => onPauseClick()} />\r\n          )}\r\n          <SpeedUpButton onClick={() => onSpeedUp()} />\r\n          <div />\r\n          <div />\r\n          <VolumeButton onClick={() => onVolumeClick()} />\r\n          <VolumeControl game={props.game} />\r\n          <Time player={props.game.player} />\r\n        </div>\r\n\r\n        <div class=\"hlv-buttons-right\">\r\n          <SettingsButton game={props.game} />\r\n          <FullscreenButton active={true} root={props.root} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import { createSignal, onCleanup, onMount, Show } from 'solid-js'\r\nimport { createStore } from 'solid-js/store'\r\nimport { Loading } from '../Loading'\r\nimport { FreeMode } from '../FreeMode'\r\nimport { ReplayMode } from '../ReplayMode'\r\nimport { Fullscreen } from '../../Fullscreen'\r\nimport { GameStateContext } from '../GameState'\r\nimport { type Game, PlayerMode } from '../../Game'\r\nimport './style.css'\r\n\r\nexport function App(props: { game: Game; root: Element }) {\r\n  let screen: HTMLButtonElement | null = null\r\n  let fadeOut: ReturnType<typeof setTimeout> | undefined = undefined\r\n\r\n  const [title, setTitle] = createSignal(props.game.title)\r\n  const [isActive, setIsActive] = createSignal(false)\r\n  const [isLoading, setIsLoading] = createSignal(false)\r\n  const [isMouseOver, setIsMouseOver] = createSignal(false)\r\n  const [isVisible, setIsVisible] = createSignal(false)\r\n\r\n  const [gameState, setGameState] = createStore({\r\n    mode: props.game.mode,\r\n    time: props.game.player.currentTime,\r\n    volume: props.game.soundSystem.getVolume(),\r\n    isPlaying: props.game.player.isPlaying,\r\n    isPaused: props.game.player.isPaused\r\n  })\r\n\r\n  onMount(() => {\r\n    if (!screen) {\r\n      return\r\n    }\r\n\r\n    const game = props.game\r\n    const root = props.root\r\n\r\n    screen.appendChild(game.getCanvas())\r\n\r\n    const offLoadStart = game.events.on('loadstart', () => setIsLoading(true))\r\n    const offLoad = game.events.on('load', () => setIsLoading(false))\r\n    const offModeChange = game.events.on('modechange', (mode: PlayerMode) => setGameState({ mode }))\r\n    const offTitleChange = game.events.on('titlechange', (title: string) => setTitle(title))\r\n    const offPlay = props.game.player.events.on('play', () => setGameState({ isPlaying: true, isPaused: false }))\r\n    const offPause = props.game.player.events.on('pause', () => setGameState({ isPlaying: true, isPaused: true }))\r\n    const offStop = props.game.player.events.on('stop', () => setGameState({ isPlaying: false, isPaused: false }))\r\n    const offVolumeChange = props.game.soundSystem.events.on('volumeChange', () => {\r\n      setGameState({ volume: props.game.soundSystem.getVolume() })\r\n    })\r\n\r\n    let interval: number\r\n    const onPlay = () => {\r\n      interval = setInterval(() => {\r\n        setGameState({ time: props.game.player.currentTime })\r\n      }, 100)\r\n    }\r\n    const onPauseOrStop = () => {\r\n      clearInterval(interval)\r\n    }\r\n    const offPlayTimer = props.game.player.events.on('play', onPlay)\r\n    const offPauseTimer = props.game.player.events.on('pause', onPauseOrStop)\r\n    const offStopTimer = props.game.player.events.on('stop', onPauseOrStop)\r\n    const offSeekTimer = props.game.player.events.on('seek', (time) => setGameState({ time }))\r\n\r\n    window.addEventListener('click', onWindowClick)\r\n    window.addEventListener('keydown', onKeyDown)\r\n    document.addEventListener('pointerlockchange', onPointerLockChange, false)\r\n\r\n    root.addEventListener('click', onRootClick)\r\n    root.addEventListener('mouseover', onMouseEnter)\r\n    root.addEventListener('mousemove', onMouseMove)\r\n    root.addEventListener('mouseout', onMouseLeave)\r\n    root.addEventListener('contextmenu', onContextMenu)\r\n\r\n    onCleanup(() => {\r\n      offLoadStart?.()\r\n      offLoad?.()\r\n      offModeChange?.()\r\n      offTitleChange?.()\r\n      offPlay?.()\r\n      offPause?.()\r\n      offStop?.()\r\n      offVolumeChange?.()\r\n      offPlayTimer?.()\r\n      offPauseTimer?.()\r\n      offStopTimer?.()\r\n      offSeekTimer?.()\r\n\r\n      props.root.removeEventListener('click', onRootClick)\r\n      window.removeEventListener('click', onWindowClick)\r\n      window.removeEventListener('keydown', onKeyDown)\r\n      document.removeEventListener('pointerlockchange', onPointerLockChange, false)\r\n\r\n      props.root.removeEventListener('mouseover', onMouseEnter)\r\n      props.root.removeEventListener('mousemove', onMouseMove)\r\n      props.root.removeEventListener('mouseout', onMouseLeave)\r\n      props.root.removeEventListener('contextmenu', onContextMenu)\r\n    })\r\n  })\r\n\r\n  const onPointerLockChange = () => {\r\n    if (document.pointerLockElement === props.root) {\r\n      props.game.pointerLocked = true\r\n    } else {\r\n      props.game.pointerLocked = false\r\n    }\r\n  }\r\n\r\n  const onContextMenu = (e: Event) => {\r\n    e.preventDefault()\r\n  }\r\n\r\n  const onWindowClick = (e: MouseEvent) => {\r\n    const target = e.target as HTMLElement\r\n    if (!target.closest('.hlv-app')) {\r\n      setIsActive(false)\r\n    }\r\n  }\r\n\r\n  const onRootClick = () => {\r\n    setIsActive(true)\r\n    fadeReset()\r\n  }\r\n\r\n  const onKeyDown = (e: KeyboardEvent) => {\r\n    if (!isActive()) {\r\n      return\r\n    }\r\n\r\n    switch (e.code) {\r\n      case 'KeyF': {\r\n        if (Fullscreen.isInFullscreen()) {\r\n          Fullscreen.exit()\r\n        } else {\r\n          Fullscreen.enter(props.root)\r\n        }\r\n        fadeReset()\r\n        break\r\n      }\r\n\r\n      case 'KeyM': {\r\n        props.game.soundSystem.toggleMute()\r\n        fadeReset()\r\n        break\r\n      }\r\n\r\n      case 'ArrowUp': {\r\n        props.game.soundSystem.setVolume(props.game.soundSystem.getVolume() + 0.05)\r\n        fadeReset()\r\n        break\r\n      }\r\n      case 'ArrowDown': {\r\n        props.game.soundSystem.setVolume(props.game.soundSystem.getVolume() - 0.05)\r\n        fadeReset()\r\n        break\r\n      }\r\n\r\n      case 'KeyJ':\r\n      case 'ArrowLeft': {\r\n        props.game.player.seek(props.game.player.currentTime - 5)\r\n        fadeReset()\r\n        break\r\n      }\r\n      case 'KeyL':\r\n      case 'ArrowRight': {\r\n        props.game.player.seek(props.game.player.currentTime + 5)\r\n        fadeReset()\r\n        break\r\n      }\r\n\r\n      case 'KeyK':\r\n      case 'Space': {\r\n        if (gameState.mode !== PlayerMode.REPLAY) {\r\n          return\r\n        }\r\n\r\n        if (!props.game.player.isPlaying || props.game.player.isPaused) {\r\n          props.game.player.play()\r\n        } else {\r\n          props.game.player.pause()\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  const onMouseEnter = () => {\r\n    setIsMouseOver(true)\r\n    fadeReset()\r\n  }\r\n\r\n  const onMouseMove = () => {\r\n    if (isMouseOver() && !Fullscreen.isInFullscreen()) {\r\n      fadeReset()\r\n    }\r\n  }\r\n\r\n  const onMouseLeave = () => {\r\n    setIsMouseOver(false)\r\n    setIsVisible(false)\r\n\r\n    clearTimeout(fadeOut)\r\n    fadeOut = undefined\r\n  }\r\n\r\n  const fadeReset = () => {\r\n    if (!isVisible()) {\r\n      setIsVisible(true)\r\n    }\r\n\r\n    clearTimeout(fadeOut)\r\n    fadeOut = setTimeout(() => {\r\n      setIsVisible(false)\r\n      fadeOut = undefined\r\n    }, 2000)\r\n  }\r\n\r\n  const onScreenClick = () => {\r\n    switch (gameState.mode) {\r\n      case PlayerMode.REPLAY: {\r\n        const player = props.game.player\r\n        if (!player.isPlaying || player.isPaused) {\r\n          player.play()\r\n        } else {\r\n          player.pause()\r\n        }\r\n        break\r\n      }\r\n\r\n      case PlayerMode.FREE: {\r\n        props.root.requestPointerLock()\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  const onScreenDblClick = () => {\r\n    if (Fullscreen.isInFullscreen()) {\r\n      Fullscreen.exit()\r\n    } else {\r\n      Fullscreen.enter(props.root)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <GameStateContext.Provider value={gameState}>\r\n      <div\r\n        classList={{\r\n          'hlv-app': true,\r\n          visible: isVisible(),\r\n          'mode-free': gameState.mode === PlayerMode.FREE,\r\n          'mode-replay': gameState.mode === PlayerMode.REPLAY\r\n        }}\r\n      >\r\n        <div class=\"hlv-title\">{title()}</div>\r\n\r\n        <Loading game={props.game} visible={isLoading()} />\r\n\r\n        <button\r\n          type=\"button\"\r\n          class=\"hlv-screen\"\r\n          ref={(node) => {\r\n            screen = node\r\n          }}\r\n          onClick={() => onScreenClick()}\r\n          onDblClick={() => onScreenDblClick()}\r\n        />\r\n\r\n        <Show when={gameState.mode === PlayerMode.FREE}>\r\n          <FreeMode class=\"hlv-controls\" game={props.game} root={props.root} />\r\n        </Show>\r\n\r\n        <Show when={gameState.mode === PlayerMode.REPLAY}>\r\n          <ReplayMode class=\"hlv-controls\" game={props.game} root={props.root} visible={isMouseOver()} />\r\n        </Show>\r\n      </div>\r\n    </GameStateContext.Provider>\r\n  )\r\n}\r\n","import { render } from 'solid-js/web'\r\nimport type { Game } from '../Game'\r\nimport { App } from './App'\r\n\r\nexport class PlayerInterface {\r\n  private game: Game\r\n  private rootNode: Element\r\n\r\n  constructor(game: Game, rootNode: Element) {\r\n    this.game = game\r\n    this.rootNode = rootNode\r\n  }\r\n\r\n  getRootNode() {\r\n    return this.rootNode\r\n  }\r\n\r\n  draw() {\r\n    render(() => <App game={this.game} root={this.rootNode} />, this.rootNode)\r\n  }\r\n}\r\n","import { Game } from './Game'\r\nimport { Config } from './Config'\r\nimport { PlayerInterface } from './PlayerInterface/index'\r\n\r\ndeclare const VERSION: string\r\n\r\nclass HLV {\r\n  public static readonly VERSION = VERSION\r\n\r\n  private game: Game\r\n\r\n  constructor(game: Game) {\r\n    this.game = game\r\n  }\r\n\r\n  load(name: string) {\r\n    this.game.load(name)\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this.game.setTitle(title)\r\n  }\r\n\r\n  getTitle() {\r\n    return this.game.getTitle()\r\n  }\r\n}\r\n\r\nexport namespace HLViewer {\r\n  export function init(rootSelector: string, params: Config | string) {\r\n    const node = document.querySelector(rootSelector)\r\n    if (!node) {\r\n      return null\r\n    }\r\n\r\n    const config = Config.init(params)\r\n    const result = Game.init(config)\r\n    if (result.status === 'success') {\r\n      const game = result.game\r\n      const ui = new PlayerInterface(game, node)\r\n\r\n      ui.draw()\r\n      game.draw()\r\n\r\n      return new HLV(game)\r\n    }\r\n\r\n    return null\r\n  }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  Object.assign(window, { HLViewer })\r\n}\r\n"],"names":["createNanoEvents","event","args","i","callbacks","length","cb","_a","now","formatTime","seconds","m","mm","ss","audioContext","SoundSystem","__publicField","volume","sound","channel","gain","source","value","current","Sound","buffer","resolve","reject","err","basename","path","extension","extname","slashPos","dotPos","ReaderDataType","Reader","data","offset","r","isLittleEndian","n","charCode","f","type","nstrlen","Tga","name","width","height","header","w","h","pixelCount","imageData","byteCount","temp","j","dst","repCount","bl","gr","rd","paletteToRGBA","pixels","palette","rgba","len","paletteWithLastTransToRGBA","parseDecal","parseCache","_r","metadata","parseTexture","parseFont","rowCount","rowHeight","glyphs","glyphOffset","glyphWidth","parseUnknown","parseEntry","Wad","entries","entryCount","directoryOffset","entriesMetadata","entry","e","ReplayMap","mapFilePath","resources","res","chunk","ReplayChunk","initialState","startTime","ReplayState","obj","frame","readCoord","bs","intFlag","fractionFlag","sign","intValue","fractionValue","DeltaType","readDelta","dd","maskBitCount","maskBits","brk","index","divisor","multiplier","initialDeltaDecoders","getInitialDeltaDecoders","_BitView","_offset","bits","signed","available","remaining","bitOffset","currentByte","read","mask","readBits","BitView","BitStream","val","bytes","utf8","chars","append","c","string","frameReaders","deltaDecoders","events","eventCount","flags","attenuation","entityIndex","soundIndex","xFlag","yFlag","zFlag","xPosition","yPosition","zPosition","pitch","command","arg","func","params","info","fieldCount","clientDataDecoder","clientData","weaponDataDecoder","pings","eventIndex","eventData","delayBit","delay","entities","entityIdx","entityType","entityTypeString","nExtraData","extraData","saveName","mapCount","maps","entityStates","entityNumber","custom","removeEntity","nBits","playerIndex","downloadSize","md5hash","size","frameReadHandlers","readFrame","handler","SVC","checkType","readHeader","readDirectories","count","directories","readFrameData","customMessages","limit","message","FrameData.readFrame","Replay","directoryCount","isFinalMacroReached","macro","msg","frameDataEnd","frameData","currentMap","currentChunk","lastFrame","lastFrameOffset","state","directoryEndOffset","serverInfo","FrameData.SVC","resourceList","timeLength","lastFrameLength","tempOffset","s","sounds","commands","soundName","SpriteType","Sprite","frames","paletteSize","xhr","url","method","isBinary","progressCallback","request","totalStr","total","encoding","loadedPercent","ARRAY_TYPE","degree","toRadian","a","y","create","out","glMatrix.ARRAY_TYPE","identity","translate","v","x","z","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","scale","rotateX","rad","rotateY","rotateZ","perspectiveNO","fovy","aspect","near","far","nf","perspective","clone","fromValues","add","b","distance","dist","vec","stride","fn","vdf","input","key","objects","Bsp","textures","models","lightmap","_BspLightmapParser","faceData","texinfo","rect","lu","lv","minU","minV","maxU","maxV","block","d","p","bestHeight","tentativeHeight","BspLightmapParser","parseModels","faces","edges","surfEdges","vertices","parsedModels","model","_faces","v0","v1","v2","uv0","uv1","uv2","luv0","luv1","luv2","_origin","_","origin","vec3.fromValues","faceTexInfo","faceTexture","faceSurfEdges","v0idx","v1idx","compIndex","v2idx","BspParser","lumps","parsedLightmap","isExternal","offsets","VECTOR_ATTRS","NUMBER_ATTRS","worldSpawn","attr","LoadItemBase","LoadItemReplay","LoadItemBsp","LoadItemSky","LoadItemWad","LoadItemSound","LoadItemSprite","Loader","config","sprites","_1","progress","replayPath","replay","mapsPath","map","pos","arr","skyname","wadPromises","item","sprite","skiesPath","skyImage","wadItem","wadsPath","wad","cmp","texture","soundsPath","Mouse","vec2.create","Touch","Camera","mat4.create","glMatrix.toRadian","vec3.create","mat4.perspective","mat4.identity","mat4.rotateX","mat4.rotateZ","mat4.translate","Keyboard","KEYS","Context","gl","canvas","MESSAGES","program","vertexShader","fragmentShader","reason","attributes","uniforms","uniform","shader","updateGame","game","ReplayPlayer","firstChunk","t","chunks","timeLimit","dt","endTime","hitStop","msgSound","sample","Renderer","context","fragmentSrc","vertexSrc","SkyShader","attributeNames","uniformNames","matrix","SkyScene","bsp","vertexBuffer","indexBuffer","indices","ctx","coords","sky","smc","smctx","side","pixelData","anisotropy","camera","MainShader","RenderMode","resizeTexture","newWidth","newHeight","nc","nctx","cid","isPowerOfTwo","nextPowerOfTwo","_n","WorldScene","INVISIBLE_TEXTURES","sceneInfo","currentVertex","modelInfo","faceInfo","k","sortedSceneInfo","vec3.clone","face","newOffset","newFaces","currentTextureIndex","glTexture","nw","nh","glLightmap","opaqueEntities","transparentEntities","mmx","entity","modelIndex","angles","vec3.add","vec3.scale","mat4.rotateY","mat4.scale","entityDistances","vec3.dist","PlayerMode","Game","loader","skies","skiesValid","parent","pw","ph","currTime","Time.now","touch","renderer","worldScene","skyScene","spawn","mode","title","keyboard","mouse","ds","KEY_W","KEY_S","KEY_A","KEY_D","downKey","upKey","yaw","Config","_b","_c","_d","_e","_f","equalFn","$PROXY","$TRACK","signalOptions","runEffects","runQueue","STALE","PENDING","UNOWNED","Owner","Transition","ExternalSourceConfig","Listener","Updates","Effects","ExecCount","createRoot","detachedOwner","listener","owner","unowned","root","updateFn","untrack","cleanNode","runUpdates","createSignal","options","setter","writeSignal","readSignal","createRenderEffect","createComputation","updateComputation","createEffect","runUserEffects","createMemo","batch","onMount","onCleanup","getListener","createContext","defaultValue","id","createProvider","useContext","children","memo","resolveChildren","updates","lookUpstream","sSlot","node","isComp","TransitionRunning","markDownstream","time","runComputation","nextValue","handleError","init","pure","runTop","ancestors","wait","completeUpdates","queue","userLength","ignore","o","obs","castError","results","result","props","FALLBACK","dispose","mapArray","list","mapFn","items","mapped","disposers","indexes","newItems","newLen","newIndices","newIndicesNext","tempdisposers","tempIndexes","start","end","newEnd","disposer","mapper","set","createComponent","Comp","narrowedError","For","fallback","Show","keyed","condition","child","reconcileArrays","parentNode","bLength","aEnd","bEnd","aStart","bStart","after","sequence","$$EVENTS","render","code","element","insert","template","html","isCE","isSVG","delegateEvents","eventNames","document","l","eventHandler","className","use","accessor","marker","initial","insertExpression","unwrapArray","multi","cleanChildren","array","currentArray","normalizeIncomingArray","appendNodes","normalized","unwrap","dynamic","prev","replacement","inserted","el","isParent","$RAW","$NODE","$HAS","$SELF","wrap$1","proxyTraps$1","keys","desc","prop","isWrappable","proto","unwrapped","getNodes","target","symbol","nodes","getNode","property","proxyDescriptor$1","trackSelf","ownKeys","receiver","tracked","setProperty","deleting","mergeStoreNode","updateArray","next","updatePath","traversed","part","partType","isArray","from","to","by","createStore","store","unwrappedStore","wrappedStore","setStore","itemTypeGroupName","Loading","setItems","loaderEvents","offLoadStart","on","onItemLoad","offProgress","onItemProgress","typeItems","push","formatItem","_name","status","Math","round","dots","Array","join","_el$","_tmpl$","_el$2","firstChild","_el$3","nextSibling","_$createComponent","each","Object","_el$4","_tmpl$2","_$insert","reduce","cur","_$effect","classList","toggle","visible","SettingsButton","isOpen","setIsOpen","hasReplay","player","onFreeModeClick","FREE","changeMode","pause","onReplayModeClick","REPLAY","_el$5","$$click","_el$6","_tmpl$3","_p$","_v$","_v$2","undefined","_$delegateEvents","apis","apiIdx","doc","Fullscreen","callback","FullscreenButton","isInFullscreen","setIsInFullscreen","onChange","onFullscreen","onChangeRemove","onClick","exit","enter","_c$","_$memo","FreeMode","active","_$className","class","GameStateContext","isPlaying","isPaused","useGameState","Time","gameState","Timeline","setProgress","ghostKnobActive","setGhostKnobActive","ghostKnobPos","setGhostKnobPos","ghostTime","setGhostTime","offPostUpdate","currentTime","onMouseDown","rects","currentTarget","getClientRects","right","pageX","left","seekByPercent","onMouseMove","progressPos","max","min","addEventListener","removeEventListener","once","onMouseEnter","onMouseLeave","knobOffset","lineOffset","$$mousemove","$$mousedown","_v$3","style","removeProperty","VolumeControl","soundSystem","setVolume","volumePos","PlayButton","PauseButton","VolumeFull","VolumeHalf","VolumeMute","VolumeButton","_c$2","SpeedUpButton","SpeedDownButton","ReplayMode","onPlayClick","play","onPauseClick","onSpeedDown","speedDown","onSpeedUp","speedUp","onVolumeClick","toggleMute","App","screen","fadeOut","setTitle","isActive","setIsActive","isLoading","setIsLoading","isMouseOver","setIsMouseOver","isVisible","setIsVisible","setGameState","getVolume","appendChild","getCanvas","offLoad","offModeChange","offTitleChange","offPlay","offPause","offStop","offVolumeChange","interval","onPlay","setInterval","onPauseOrStop","clearInterval","offPlayTimer","offPauseTimer","offStopTimer","offSeekTimer","onWindowClick","onKeyDown","onPointerLockChange","onRootClick","onContextMenu","pointerLockElement","pointerLocked","preventDefault","closest","fadeReset","seek","clearTimeout","setTimeout","onScreenClick","requestPointerLock","onScreenDblClick","Provider","$$dblclick","_$use","when","PlayerInterface","constructor","rootNode","getRootNode","draw","_self$","HLV","exports","HLViewer","rootSelector"],"mappings":"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","x_google_ignoreList":[0,20,21,22,23,44,45,46]}